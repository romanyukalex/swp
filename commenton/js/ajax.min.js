var cnjQuery=jQuery.noConflict();(function(a){a(document).ready(function(){var e=a("body");a.ajaxSetup({type:"POST",url:"/commenton/components/ajax.php",dataType:"json",beforeSend:function(){},complete:function(){}});e.on("click","#cn_logout",function(r){r.preventDefault();a.ajax({data:{action:"logout"},success:function(s){if(s===true){document.location.reload()}}})});var p=new Date();var b=p.getFullYear();var f=p.getMonth()+1;var o=p.getDate();var n=p.getHours();var c=p.getMinutes();var k=p.getSeconds();if(o<10){o="0"+o}if(f<10){f="0"+f}if(c<10){c="0"+c}if(k<10){k="0"+k}var q=n+":"+c+":"+k+" "+o+"-"+f+"-"+b;var l=a(".commenton_box").data("timeZone")||a(".cn_panel_block").data("timeZone");if(l===""||l===undefined){a(".cn_date").each(function(t,r){var s=a(r).data("timeSecond");a.ajax({data:{action:"user_time_zone",user_time:q,time_comment:s},success:function(u){a(r).attr("title",u)}})})}e.on("click",".cn_enter_text_submit",function(){var u=a(this);var t=a(".cn_enter_text_input");var v=t.val();hiddenButton(u);var s=document.location.pathname+document.location.search;var r=a("head").find("title").text();if(r===""){r=s}a.ajax({data:{action:"message_submit",message_text:v,page_url:s,page_title:r},success:function(x){if(x[0]===1){var w=a(".cn_comments_block");var z=a(".cn_more_comments");var A=z.data("cnMore");w.prepend(x[1]);t.val("");t.height("auto");a(".cn_count").text(x[2]);z.data("cnMore",A+1);z.attr("data-cn-more",A+1);cnMoreText(w.children().find(".cn_string_2"))}if(x[0]===2||x[0]==="flood"){t.val("");t.height("auto");var y=(x[0]===2)?"success":"error";noticeModal(y,x[1])}if(x[0]==="not_auth"){console.log(x[0]);noticeModal("error",x[1])}if(x[0]==="empty_box"){t.parents(".cn_enter_text_panel").css({"border-color":"red"})}if(x[0]==="error_data"||x[0]==="long_string"){a(".cn_notice_error").remove();u.parent().append('<div class="cn_notice_error">'+x[1]+"</div>");t.parents(".cn_enter_text_panel").css({"border-color":"red"})}}});t.focus(function(){t.parents(".cn_enter_text_panel").removeAttr("style");a(".cn_notice_error").remove()})});e.on("click",".cn_enter_answer_submit",function(){var B=a(this);var w=(CN_ANSWER_UNDER_BLOCK)?B.parents(".cn_comment_box").find(".cn_enter_answer_input"):a(".cn_enter_answer_input");var t=B.data("cnArea");var z=w.val();hiddenButton(B);var x=a(this).parents(".cn_answer_input_box").data("cnPageUri");var u=a(this).parents(".cn_answer_input_box").data("cnPageTitle");var y=a(this).parents(".cn_answer_input_box").data("cnParentId");var A=a(this).parents(".cn_answer_input_box").data("cnMainCommentId");var s=a(this).parents(".cn_answer_input_box").data("cnCommentType");var r=1;if(s==="answer"){var v=a("#"+y);if(v.parents("#cnab-"+A).length!==0){while(v.attr("id")!=="cnab-"+A){v=v.parent();r++}}}if(u===""){u=x}a.ajax({data:{action:"answer_submit",message_text:z,page_url:x,page_title:u,parent_id:y,main_id:A,comment_type:s,level:r},success:function(E){if(E[0]===1){if(t==="panel"){a(".cn_panel_block").load(location.href+" .cn_panel_block>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}else{var D=a("#"+y);if(D.next(".cn_comments_answer_block").length>0){D=D.next(".cn_comments_answer_block")}else{if(D.next().next().next(".cn_comments_answer_block").length>0){D.next().click();D=D.next().next().next(".cn_comments_answer_block")}else{D=D.parent(".cn_comments_answer_block")}}D.append(E[1]);w.val("");w.height("auto");if(CN_ANSWER_UNDER_BLOCK){B.parents(".cn_comment_box").find(".cn_answer_close").click()}else{a(".cn_answer_close").click()}a(".cn_count").text(E[2]);var C=a("#cna-"+E[3]).offset().top-200;a("html,body").stop().animate({scrollTop:C},1000);cnMoreText(D.find(".cn_string_2"))}}if(E[0]===2||E[0]==="flood"){w.val("");w.height("auto");if(CN_ANSWER_UNDER_BLOCK){B.parents(".cn_comment_box").find(".cn_answer_close").click()}else{a(".cn_answer_close").click()}var F=(E[0]===2)?"success":"error";noticeModal(F,E[1])}if(E[0]==="not_auth"){console.log(E[0]);noticeModal("error",E[1])}if(E[0]==="empty_box"){w.parents(".cn_enter_answer_panel").css({"border-color":"red"})}if(E[0]==="error_data"||E[0]==="long_string"){a(".cn_notice_error").remove();B.parent().append('<div class="cn_notice_error">'+E[1]+"</div>");w.parents(".cn_enter_answer_panel").css({"border-color":"red"})}}});w.focus(function(){w.parents(".cn_enter_answer_panel").removeAttr("style");a(".cn_notice_error").remove()})});e.on("click",".cn_delete_confirm_submit",function(){var v=a(this);var t=v.parents(".cn_delete_confirm_block").data("cnCommentId");var w=v.parents(".cn_delete_confirm_block").data("cnCommentType");var r=v.parents(".cn_delete_confirm_block").data("cnMainCommentId");var u=v.data("cnArea");var s=document.location.pathname+document.location.search;a.ajax({data:{action:"delete_comment",comment_id:t,comment_type:w,page_url:s},success:function(x){if(x[0]===1){if(u==="panel"){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}else{if(w==="main"){var A=a(".cn_more_comments");var B=A.data("cnMore");A.data("cnMore",B-1);A.attr("data-cn-more",B-1);a('[data-cn-main-comment-id="'+r+'"]').remove()}if(w==="answer"){var z=a("#"+t);if(z.next(".cn_comments_answer_block").length>0){z.next(".cn_comments_answer_block").remove();z.remove()}else{for(var y=0;y<x[1].length;y++){a("#cna-"+x[1][y]).remove()}}}a(".cn_delete_confirm_cancel").click();a(".cn_count").text(x[2])}}if(x[0]==="no_more"){a(".commenton").load(location.href+" .commenton>*",function(){})}if(x[0]==="error_mysql"||x[0]==="error_data"){console.log(x[0])}if(x[0]==="not_auth"){console.log(x[0]);noticeModal("error",x[1])}}})});e.on("click",".cn_sort_point",function(){var s=a(this).data("cnSort");var r=document.location.pathname+document.location.search;a.ajax({data:{action:"sort",sort:s,page_url:r},success:function(t){if(t[0]===1){a(".cn_sort").html(t.sort);a(".cn_comments_block").html(t.content)}if(t[0]==="error_data"){console.log(t[0])}}})});e.on("click",".cn_like, .cn_dislike",function(){var t=a(this).data("cnHype");var s=a(this).parents(".cn_comment_box").attr("id");var r=a(this).parents(".cn_comment_box").data("cnCommentType");a.ajax({data:{action:"hype",hype_type:t,comment_id:s,comment_type:r},success:function(v){if(v[0]===1){if(v[1]!==undefined&&v[1]!=null){var w;var u=a("#"+s);if(+v[1]>0){w='<div class="cn_like_cool">'+v[1]+"</div>"}if(+v[1]<0){w='<div class="cn_like_bad">'+v[1]+"</div>"}if(+v[1]===0){w=""}if(t==="like"){u.find(".cn_like").css({opacity:"0.5"});u.find(".cn_dislike").removeAttr("style")}if(t==="dislike"){u.find(".cn_dislike").css({opacity:"0.5"});u.find(".cn_like").removeAttr("style")}u.find(".cn_like_meter").html(w)}}if(v[0]==="no_more"){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreText(a(".cn_string_2"))})}if(v[0]==="guest_auth"){noticeModal("error",v[1])}if(v[0]==="error_model"||v[0]==="error_data"){console.log(v[0])}if(v[0]==="not_auth"){console.log(v[0]);noticeModal("error",v[1])}}})});e.on("click",".cn_more_comments",function(){var s=a(this);var r=s.data("cnMore");var t=document.location.pathname+document.location.search;a.ajax({data:{action:"more_comments",limit:r,page_url:t},beforeSend:function(){s.removeClass("cn_more_comments");s.addClass("cn_loading_block");s.html('<div class="cn_loading"></div>')},complete:function(){s.removeClass("cn_loading_block");s.addClass("cn_more_comments");s.html("")},success:function(u){if(u.limit==="cancel"){s.remove()}else{s.data("cnMore",u.limit);s.attr("data-cn-more",u.limit)}a(".cn_comments_block").append(u.data);cnMoreText(a(".cn_string_2"));sortAnswer()}})});e.on("click",".cn_complain_submit",function(){var u=a(this);var v=a(".cn_complain_input");var t=v.val();var s=a(this).parents(".cn_complain_box").data("cnParentId");var r=a(this).parents(".cn_complain_box").data("cnCommentType");a.ajax({data:{action:"complaint_submit",message:t,comment_id:s,comment_type:r},success:function(w){if(w[0]===1){v.val("");v.height("auto");a(".cn_complain_close").click();noticeModal("success",w[1])}if(w[0]==="no_more"){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreText(a(".cn_string_2"));noticeModal("error",w[1])})}if(w[0]==="error_mysql"||w[0]==="error_data"){console.log(w[0])}if(w[0]==="not_auth"){console.log(w[0]);noticeModal("error",w[1])}if(w[0]==="empty_box"||w[0]==="long_string"){a(".cn_notice_error").remove();u.before('<div class="cn_notice_error" style="float: left;">'+w[1]+"</div>")}}});v.focus(function(){a(".cn_notice_error").remove()})});e.on("click",".cn_clean_complain_button",function(){var s=a(this).parents(".cn_comment_box").attr("id");var r=a(this).parents(".cn_comment_box").data("cnCommentType");a.ajax({data:{action:"clean_complaints",comment_id:s,comment_type:r},success:function(t){if(t[0]===1){a(".cn_panel_block").load(location.href+" .cn_panel_block>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(t[0]==="error_mysql"||t[0]==="error_data"){console.log(t[0])}if(t[0]==="not_auth"){console.log(t[0]);noticeModal("error",t[1])}}})});e.on("click",".cn_authorize_guest_submit",function(){var x=a(this).parents(".cn_authorize_guest").children(".cn_guest_name_input");var w=a(this).parents(".cn_authorize_guest").children(".cn_guest_email_input");var t=a(this).parents(".cn_authorize_guest").children(".cn_recaptcha");var v=x.val();var s="";var r="";if(w.length!==0){s=w.val()}if(t.length!==0){try{r=grecaptcha.getResponse()}catch(u){return false}}a.ajax({data:{action:"login_guest",guest_name:v,guest_email:s,g_recaptcha_response:r},success:function(y){if(y[0]===1){document.location.reload()}else{if(y[0]==="empty_email_box"||y[0]==="error_email"){a(".cn_notice_error").remove();w.after('<div class="cn_notice_error">'+y[1]+"</div>")}else{if(y[0]==="empty_box"||y[0]==="reserved_name"||y[0]==="small_name"||y[0]==="long_name"||y[0]==="unresolved_char"){a(".cn_notice_error").remove();x.after('<div class="cn_notice_error">'+y[1]+"</div>")}else{if(y[0]==="error_auth"||y[0]==="error_recaptcha"||y[0]==="error_login"){a(".cn_notice_error").remove();t.after('<div class="cn_notice_error">'+y[1]+"</div>")}else{if(y[0]==="error_data"){console.log(y[1])}}}}}}});x.focus(function(){a(".cn_notice_error").remove()})});e.on("click",".cn_login_submit",function(u){u.preventDefault();var t=a(this);var r=a("#cn_login").val();var s=a("#cn_password").val();a.ajax({data:{action:"login_admin",login:r,password:s},success:function(v){if(v[0]===1){document.location.reload()}if(v[0]==="error_login"){a(".cn_notice_error").remove();t.after('<b class="cn_notice_error" style="margin-left: 10px;color:red;font-size: 14px;">'+v[1]+"</b>")}if(v[0]==="error_data"){console.log(v[1])}}});a("#cn_login, #cn_password").focus(function(){a(".cn_notice_error").remove()})});e.on("click",".cn_approve_button",function(){var s=a(this).parents(".cn_comment_box").attr("id");var r=a(this).parents(".cn_comment_box").data("cnCommentType");a.ajax({data:{action:"approve",comment_id:s,comment_type:r},success:function(t){if(t[0]===1){a(".cn_panel_block").load(location.href+" .cn_panel_block>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(t[0]==="error_mysql"||t[0]==="error_data"){console.log(t[1])}if(t[0]==="not_auth"){console.log(t[0]);noticeModal("error",t[1])}}})});e.on("click",".cn_trash_button",function(){var w=a(this);var u=w.parents(".cn_comment_box").attr("id");var s=w.parents(".cn_comment_box").data("cnCommentType");var r=w.parents(".cn_main_comment_block").data("cnMainCommentId")||w.parents(".cn_comment_box").data("cnMainCommentId");var v=w.data("cnArea");var t=document.location.pathname+document.location.search;a.ajax({data:{action:"trash",comment_id:u,comment_type:s,page_url:t},success:function(x){if(x[0]===1){if(v==="panel"){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}else{if(s==="main"){a('[data-cn-main-comment-id="'+r+'"]').remove()}if(s==="answer"){var z=a("#"+u);if(z.next(".cn_comments_answer_block").length>0){z.next(".cn_comments_answer_block").remove();z.remove()}else{for(var y=0;y<x[1].length;y++){a("#cna-"+x[1][y]).remove()}}}a(".cn_count").text(x[2])}}if(x[0]==="no_more"){a(".commenton").load(location.href+" .commenton>*",function(){if(v==="panel"){cnMoreTextPanel(a(".cn_content_comment"))}else{cnMoreText(a(".cn_string_2"))}})}if(x[0]==="error_mysql"||x[0]==="error_data"){console.log(x[0])}if(x[0]==="not_auth"){console.log(x[0]);noticeModal("error",x[1])}}})});e.on("click",".cn_recover_button",function(){var t=a(this);var s=t.parents(".cn_comment_box").attr("id");var r=t.parents(".cn_comment_box").data("cnCommentType");a.ajax({data:{action:"recover",comment_id:s,comment_type:r},success:function(u){if(u[0]===1){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(u[0]==="error_mysql"||u[0]==="error_data"){console.log(u[0])}if(u[0]==="not_auth"){console.log(u[0]);noticeModal("error",u[1])}}})});e.on("change",".cn_setting_section input, .cn_setting_section select, .cn_limit_admin select",function(){var r=a("form[name='cn_form_common']").serializeArray();var w=a("form[name='cn_form_admin']").serializeArray();var s=a("form[name='cn_form_social']").serializeArray();var v=a("form[name='cn_form_guest']").serializeArray();var u=a("form[name='cn_form_limit_admin']").serializeArray();var t=a("form[name='cn_form_limit_users']").serializeArray();a.ajax({data:{action:"setting",form_common:r,form_admin:w,form_social:s,form_guest:v,form_limit_admin:u,form_limit_users:t},success:function(x){if(x[1]==="reload_comments"){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(x[1]==="reload_users"){a(".cn_users_block").load(location.href+" .cn_users_block>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(x==="error_write"){console.log(x)}if(x[0]==="not_auth"){console.log(x[0]);noticeModal("error",x[1])}}})});e.on("change","#cn_set_admin_avatar",function(){a(".cn_set_ava_admin").attr("src",a(this).val())});e.on("change","#cn_set_admin_avatar_upload",function(){var r=new FormData();a.each(this.files,function(s,t){r.append("ava_admin_upload",t)});a.ajax({data:r,cache:false,processData:false,contentType:false,success:function(s){if(s[0]===1){a(".cn_set_ava_admin").attr("src",s[1]);a("#cn_set_admin_avatar").val(s[1])}if(s[0]==="error_preload"||s[0]==="error_type"||s[0]==="error_size"||s[0]==="error_upload"){console.log(s[0])}if(s[0]==="not_auth"){console.log(s[0]);noticeModal("error",s[1])}}})});e.on("click",".cn_user_ban_table",function(){var r=a(this).parents(".cn_user_str_table").data("cnUserId");a.ajax({data:{action:"user_ban",user_id:r},success:function(s){if(s[0]===1){a(".cn_users_block").load(location.href+" .cn_users_block>*",function(){})}if(s[0]==="error_mysql"||s[0]==="error_data"){console.log(s[0])}if(s[0]==="not_auth"){console.log(s[0]);noticeModal("error",s[1])}}})});e.on("click",".cn_user_delete_confirm_submit",function(){var r=a(this).parents(".cn_user_delete_confirm_block").data("cnUserId");a.ajax({data:{action:"user_delete",user_id:r},success:function(s){if(s[0]===1){a(".cn_users_block").load(location.href+" .cn_users_block>*",function(){})}if(s[0]==="error_mysql"||s[0]==="error_data"){console.log(s[0])}if(s[0]==="not_auth"){console.log(s[0]);noticeModal("error",s[1])}}})});e.on("click",".cn_all_read",function(){a.ajax({data:{action:"all_read"},success:function(r){if(r===1){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(r[0]==="not_auth"){console.log(r[0]);noticeModal("error",r[1])}}})});e.on("click",".cn_read_button",function(){var t=a(this);var s=t.parents(".cn_comment_box").attr("id");var r=t.parents(".cn_comment_box").data("cnCommentType");a.ajax({data:{action:"read_once",comment_id:s,comment_type:r},success:function(u){if(u[0]===1){a(".commenton").load(location.href+" .commenton>*",function(){cnMoreTextPanel(a(".cn_content_comment"))})}if(u[0]==="error"){console.log(u[0])}if(u[0]==="not_auth"){console.log(u[0]);noticeModal("error",u[1])}}})});e.on("click",".cn_action_point",function(){var s=a("form[name='cn_comment_select_form']").serializeArray();var r=a(this).data("actionType");a.ajax({data:{action:"action_selected",action_type:r,selected_comments:s},beforeSend:function(){var u='<div class="cn_block_loading"><div class="cn_loading"></div></div>';var t=a(".cn_loading");if(a(".cn_block_loading").length===0){a("body").prepend(u)}t.stop();t.animate({width:"70%"})},complete:function(){var t=a(".cn_loading");t.stop();t.animate({width:"100%"});setTimeout(function(){a(".cn_block_loading").remove()},800)},success:function(t){if(t[0]===1){a(".cn_panel_block").load(location.href+" .cn_panel_block>*",function(){a(".cn_select_all").prop("checked",false);cnMoreTextPanel(a(".cn_content_comment"))})}if(t[0]==="error"){console.log(t[0])}if(t[0]==="not_auth"){console.log(t[0]);noticeModal("error",t[1])}}})});if(location.hash){var g=location.hash;var d=location.pathname;if(a(g).length>0){var m=a(g).data("cnCommentType");if(m==="answer"){var j=a(g).parents(".cn_main_comment_block");if(j.length>0){j.find(".cn_show_answer_button").click()}}var h=a(g).offset().top-200;a(g).addClass("cn_animate");a(g).css({"border-left-color":"#ffc004"});a("html,body").stop().animate({scrollTop:h},1000);setTimeout(function(){a(g).removeAttr("style")},2000)}else{a.ajax({data:{action:"load_by_link",hash:g,pathname:d+document.location.search},success:function(s){if(s.link_locate!=null){window.location.replace(s.link_locate)}if(s.data!=null){a(".cn_comments_block").prepend('<div class="cn_loaded_by_link_end">* * *</div>').prepend(s.data).prepend(a(".cn_loaded_by_link").detach().css({display:"block"}));cnMoreText(a(".cn_string_2"));var r=a(g).offset().top-200;a(g).addClass("cn_animate");a(g).css({"border-left-color":"#ffc004"});a("html,body").stop().animate({scrollTop:r},1000);setTimeout(function(){a(g).removeAttr("style")},2000)}}})}}e.on("input",".cn_enter_text_input",function(){var r=a(this);var s=document.location.pathname+document.location.search;a.ajax({data:{action:"save_text_entered",page_url:s,text:r.val()}})});e.on("click",".cn_pid_edit",function(){var r=a(this).data("pid")||"";var s=prompt(a(this).data("alert"),r);a.ajax({data:{action:"pid_edit",old_pid:r,new_pid:s},success:function(t){function v(y,C){var x=window.location.search;var B=[];var w=[];var A=[];var z="";B=(x.substr(1)).split("&");if(B[0]===""){return false}for(i=0;i<B.length;i++){w=B[i].split("=");if(w[0]===y){A[i]=w[0]+"="+C}else{A[i]=w[0]+"="+w[1]}}return A}var u=v("f",s);if(t===1){window.location.href=window.location.origin+location.pathname+"?"+u.join("&")}}})})})})(cnjQuery);