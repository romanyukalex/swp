function orderMail(formId,btnId,typeId){orderMail=this;orderMail.ajaxUrl="/ajax/ordermail";orderMail.formId=formId||"#mailOrderForm";orderMail.sendBtn=btnId||"#mailOrderFormSend";orderMail.garbageClass=".js-mail-order-field";orderMail.dontGarbageClass="js-mail-order-not";orderMail.disabledClass="js-disabled-field";orderMail.nonResetClass="js-non-reset-field";orderMail.mailOrderType=typeId||"#mailOrderType";orderMail.cityName=(window.adrMgr.other||window.adrMgr.selectedCity).name;orderMail.regionName=window.adrMgr.selectedRegion.name;orderMail.beforeSend=null;orderMail.afterSend=null;var orderMail;var regexp_array=/(?:\[\])+$/gi;$(orderMail.formId).find(orderMail.sendBtn).on("click",function(){orderMail.params={};orderMail.params.mailOrderType=$(orderMail.mailOrderType).val();orderMail.params.cityName=orderMail.cityName;orderMail.params.regionName=orderMail.regionName;orderMail.params.const_region=window.adrMgr.selectedRegion.synonym;orderMail.params.const_city=window.adrMgr.other?"other/":(window.adrMgr.selectedRegion.synonym===window.adrMgr.selectedCity.synonym?"":window.adrMgr.selectedCity.synonym+"/");var $btn=$(this),strBtnId=$btn[0].id;if(!utils.buttonLoader(strBtnId)){return}if(orderMail.beforeSend&&!orderMail.beforeSend()){utils.buttonUnLoader(strBtnId);return false}$.extend(true,orderMail.params,orderMail.gather());var goal=$btn.data("stat-goal")||(window.statistic?window.statistic.goal:null);var clickStats=($btn.data("click-stats")||"").split(",");var doneStats=($btn.data("done-stats")||"").split(",");if($btn.hasClass("js-need-send-stat")){var _goal=$btn.data("stat-goal");if(utils.isEmpty(_goal)&&window.location.pathname.split("/").length>0){var cnt=window.location.pathname.split("/").length-1;_goal=window.location.pathname.split("/")[cnt]}if(!utils.isEmpty(_goal)){stat.sendCustomStat(_goal,"click")}goal=null}if(goal){$.each(clickStats,function(i,item){if(item=="click"){stat.sendCustomStat(goal,"_"+item)}else{stat.sendCustomStat(item)}})}if(window.docContext){orderMail.params.files=window.docContext.callback_files}$.ajax({url:orderMail.ajaxUrl,type:"POST",dataType:"json",async:true,cache:false,data:orderMail.params,success:function(resp){if(resp.isError==0){try{$.getScript(("https:"==document.location.protocol?"https://":"http://")+"config1.veinteractive.com/tags/76CE1CFF/B359/4669/BFCB/3D3B651B9A02/tag.js");$("#request-accepted").prepend('<img src="//drs2.veinteractive.com/DataReceiverService.asmx/Pixel?journeycode=76CE1CFF-B359-4669-BFCB-3D3B651B9A02" width="1" height="1"/>')}catch(error){}if(goal){$.each(doneStats,function(i,item){if(item=="done"){stat.sendCustomStat(goal,"_"+item)}else{stat.sendCustomStat(item)}})}orderMail.reset();$.magnificPopup.close();utils.Error((!!$(orderMail.formId).data("text")?$(orderMail.formId).data("text"):"Благодарим за обращение. Наш специалист свяжется с Вами в ближайшее время."),(!!$(orderMail.formId).data("title")?$(orderMail.formId).data("title"):"Ваша заявка принята!"))}else{if(resp.errorMsg){utils.Notice(resp.errorMsg,"Обратная связь")}else{utils.Error("Сервис временно не доступен","Внимание")}}},error:function(){utils.Error("Сервис временно не доступен","Внимание")},complete:function(){utils.buttonUnLoader(strBtnId);if(orderMail.afterSend){orderMail.afterSend()}}})});orderMail.gather=function(){var options={};$(orderMail.formId).find(orderMail.garbageClass).each(function(){var $this=$(this);if(!canAccess(this,orderMail.dontGarbageClass)){return}if((this.type=="checkbox"||this.type=="radio")&&!this.checked){return}var name=(this.name||$this.attr("name")).replace(regexp_array,"");var multi=!!name.match(regexp_array);var exist=utils.isset(options[name]);var value;if(this.tagName=="DIV"&&$this.hasClass("form-slider")){value=$this.closest(".form-slider__wrap-slider").find(".form-slider__input").val()}else{if(this.tagName=="SPAN"){value=$this.text()}else{value=$this.val()}}if($this.data("upper")){value=value.toUpperCase()}if((multi||exist)&&!utils.isArray(value)){value=[value]}else{if(utils.isEmpty(value)){return}}if(exist){if(!utils.isArray(options[name])){options[name]=[options[name]]}$.each(value,function(i,item){options[name].push(item)})}else{options[name]=value}});return options};var selectric_nums=["0","1","2"];function getSelectricNum($select){for(var i in selectric_nums){var num=selectric_nums[i];if($select.hasClass("js-selectric"+num)){return num}}return null}orderMail.reset=function($form){var $context=$form||$(document);var $fields=$context.find(orderMail.garbageClass);$fields.each(function(){if(!canAccess(this,orderMail.dontGarbageClass)){return}var $this=$(this);if($this.hasClass(orderMail.nonResetClass)){return}if(this.type=="checkbox"||this.type=="radio"){this.checked=!!$(this).data("default-value");return}if(this.disabled){return}if(this.tagName=="SELECT"){$this.find("option").attr("selected",false);if(!this.multiple){$this.find("option").eq(0).attr("selected",true)}var num=getSelectricNum($this);if(num){var $wrapper=$this.closest(".selectric"+num+"-wrapper"),$label=$wrapper.closest(".selectric"+num+"-wrapper").find(".label"),$items=$wrapper.find(".selectric"+num+"-items").find("li");$label.html($this.find("option:first").html());$items.removeClass("selected").first().addClass("selected");utils.resetSelectric($this)}}else{$this.val($this.data("default-value")||"");if(!utils.isEmpty($this.attr("placeholder"))){$this.trigger("change.placeholder")}}if($this.hasClass("validator-filtered")){$this.validatorFilter("reinit")}});if(window.docContext&&window.docContext.callback_files){var params={};params.destroy=1;params.files=window.docContext.callback_files;$.ajax({url:"/ajax/fileUploadRedis",type:"post",dataType:"json",data:params,async:true,cache:false,success:function(resp){}})}};function canAccess(item,clazz){var $item=$(item);if(!item.tagName||(!item.name&&!$item.attr("name"))){return false}if(clazz&&$item.hasClass(clazz)||$item.hasClass(orderMail.disabledClass)||$item.prop("disabled")){return false}return true}$(orderMail.formId).find('input[name="city"]').val(orderMail.cityName).prop("disabled",true)};