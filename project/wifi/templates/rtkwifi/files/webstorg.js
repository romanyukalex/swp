(function(){WebstoreCart=function(options){this.id="webstore-cart";this.show_mode="partial";this.tagid=189;this["class"]="";this.plan=null;this.tariff_id=null;this.tariff=null;this.mode="singleplay";this.show_mode="full";this.i_have_phone=false;this.i_have_shpd=false;this.has_shpd=false;this.has_iptv=false;this.has_pstn=false;this.has_iptv_max=false;this.basic_iptv=[];this.prices={};this.discounts={};this.packages=[];this.all_plans=[];this.all_options=[];this.all_packages=[];this.all_choices=[];this.all_devices=[];this.all_subscriptions=[];this.all_phones=[];this.cache_opt={};this.cache_pkg={};this.cache_chs={};this.cache_subs={};this.cache_dev={};this.tags=[];this.channels=[];this.cache_channels={};this.plan_tag_id=0;this.rendered=false;this.renderTOut=null;this.all_options_aliases=[];this.all_packages_aliases=[];this.all_choices_aliases=[];this.all_subs_aliases=[];this.enb_options_aliases=[];this.dis_options_aliases=[];this.enb_packages_aliases=[];this.dis_packages_aliases=[];this.enb_choices_aliases=[];this.dis_choices_aliases=[];this.enb_subs_aliases=[];this.dis_subs_aliases=[];this.dis_options=["iptv_file_quote"];this.dis_choices=["iptv_file_quote"];this.device_ids={main:"iptv_device_standard",premium:"iptv_device_premium",sender:"iptv_videosender"};this.multiroom={is_on:false,stb_main_id:"iptv_device_standard",stb_prm_id:"iptv_device_premium",stb_dvc_id:["iptv_device_standard","iptv_device_premium"],stb_dvc:0,stb_dvc_min:1,stb_dvc_max:3,vsender_dvc_id:["iptv_videosender"],vsender_dvc:0,vsender_dvc_max:3};this.order={};this.data={services:[],choice_options:[],choice_packages:[],choice_choices:[],choice_subscriptions:[],choice_phone:[],choice_devices:[],discount:0};this.tpl=new TemplateClass("/tpls/tariff_cart_item.hbs");this.tpl.load();this.declOfNum=function(number,titles){cases=[2,0,1,1,1,2];return titles[(number%100>4&&number%100<20)?2:cases[(number%10<5)?number%10:5]]};this.loadPackageChannels=function(pckg,versionId){var _this=this;var get_channels="/pages/proxy.jsp?proxyType=agent&proxyMethod=GET&urlCode=get_channels&tariff_version="+versionId+"&package_id="+pckg.altName+"&__callback=?";$.ajax(get_channels).done(function(data){if(typeof _this.cache_pkg[pckg.altName]!=="undefined"){_this.cache_pkg[pckg.altName].renderChannels(eval(data))}}).always(function(){_this.loadedToChannels--;if(_this.loadedToChannels==0){window.construct.initConfigurator()}})};this.loadAllChannels=function(){var _this=this;var get_channels="/pages/proxy.jsp?proxyType=agent&proxyMethod=GET&urlCode=get_all_channels&tag="+_this.tag_id+"&region="+_this.reg_id+"&addr_code="+adrMgr.selectedCity.klCode+"&addr_level="+adrMgr.selectedCity.klLvl;$.ajax(get_channels,{dataType:"json"}).done(function(data){if(!!data){utils.log("loaded");initView.init(data)}})};this.loadChannels=function(){var _this=this;if(_this.plan){if(_this.plan.data.load_ch==false){_.each(_this.tariff.services,function(srv,idx){if(srv.type=="iptv"){if(typeof srv.packages!=="undefined"&&srv.packages.packages!=="undefined"){_this.loadedToChannels=srv.packages.packages.length;_.each(srv.packages.packages,function(pckg){_this.loadPackageChannels(pckg,srv.versionId)})}}});_this.plan.data.load_ch=true}}};this.choicePlan=function(plan){var _this=this;var trf_id=plan.el.find("select.unit-tariff__sel").val();if(typeof trf_id==="undefined"&&plan.tariffs.length!=0){trf_id=plan.tariffs[0].id}_this.choiceTariff(plan,trf_id,true)};this.updateOptions=function(){var _this=this;_this.rendered=false;_.each(_this.data.choice_options,function(opt){if(typeof opt.alias!=="undefined"&&typeof _this.cache_opt[opt.alias]!=="undefined"){_this.cache_opt[opt.alias].disable()}});_.each(_this.data.choice_packages,function(opt){if(typeof opt.alias!=="undefined"&&typeof _this.cache_opt[opt.alias]!=="undefined"){_this.cache_pkg[opt.alias].disable()}});_.each(_this.data.choice_choices,function(opt){if(typeof opt.alias!=="undefined"&&typeof _this.cache_opt[opt.alias]!=="undefined"){_this.cache_chs[opt.alias].disable()}});_.each(_this.data.choice_subscriptions,function(opt){if(typeof opt.alias!=="undefined"&&typeof _this.cache_opt[opt.alias]!=="undefined"){_this.cache_subs[opt.alias].disable()}});_.each(_this.data.choice_devices,function(dvs){if(typeof dvs.alias!=="undefined"&&typeof _this.cache_dev[dvs.alias]!=="undefined"){_this.cache_dev[dvs.alias].disable()}});_this.data.choice_options=[];_this.data.choice_packages=[];_this.data.choice_subscriptions=[];_this.data.choice_choices=[];_this.data.choice_devices=[];_this.all_options_aliases=_.map(_this.all_options,function(opt){return opt.data.alias});_this.all_packages_aliases=_.map(_this.all_packages,function(opt){return opt.data.alias});_this.all_choices_aliases=_.map(_this.all_choices,function(opt){return opt.data.alias});_this.all_subs_aliases=_.map(_this.all_subscriptions,function(opt){return opt.data.alias});_.each(_this.plan.tariffs,function(trf,idx){if(trf.id==_this.tariff_id){trf.choice=true;_this.tariff=trf;_.each(_this.tariff.services,function(srv,idx){if(srv!=null&&(srv.type=="iptv"||idx=="iptv")){_this.has_iptv=true;_this.prices=srv.packages.prices;_this.discounts=srv.packages.discounts;_this.packages=srv.packages.packages}if(srv!=null&&(srv.type=="shpd"||idx=="shpd")){_this.has_shpd=true}if(srv!=null&&(srv.type=="pstn"||idx=="pstn")){_this.has_pstn=true}});if(_this.has_iptv){_this.loadChannels();_this.loadAllChannels()}else{window.construct.initConfigurator()}_this.checkPlay()}else{trf.choice=false}})};this.choiceTariff=function(plan,tariff_id,change_plan){if(adrMgr.selectedRegion.klRegion==50&&this.tag_id==289){this.tag_id=312}var _this=this;_this.plan=plan;_this.has_iptv=false;_this.has_shpd=false;_this.tariff_id=tariff_id;change_plan=(typeof change_plan!=="undefined")?change_plan:false;_this.rendered=false;if(this.show_mode=="partial"&&change_plan==true){change_plan=false}else{if(typeof _this.plan!=="undefined"&&_this.plan!=null&&typeof _this.plan.tariffs!=="undefined"){_.each(plan.tariffs,function(trf){if(trf.id==_this.tariff_id){_this.tariff=trf;trf.choice=true;_.each(trf.tags,function(tag){if(_this.tags.indexOf(tag.id)!==-1){if(change_plan){_this.tag_id=tag.id}if(_this.tag_id!==0&&_this.tag_id==tag.id){change_plan=true}}})}else{trf.choice=false}})}}if(change_plan){_this.rendered=false;_this.has_iptv_max=false;$("#apack").addClass("none-elem").removeClass("is-visible");$("#internet-1-desc .more-link").removeClass("is_open").html($("#internet-1-desc .more-link").attr("data-active-text"));if(_this.plan.data.is_load==false){_this.plan.loadTariffs()}else{_this.renderOptions();_this.updateOptions();_this.initDefaultOptions()}$(".p-section-basket,.p-section-info").show()}else{if(this.show_mode!="partial"){_this.render()}}};this.initDefaultOptions=function(){var _this=this;var isCorrectPrice=false;var correctPriceTag=0;if(typeof _this.plan!=="undefined"){if(typeof _this.plan.isCorrectPrice!=="undefined"&&_this.plan.isCorrectPrice){isCorrectPrice=true;correctPriceTag=_this.plan.correctPriceTag}}_.each(_this.cache_opt,function(opt){opt.is_visible=true;opt.required=opt.data.required;if(opt.required){opt.enable();opt.off()}});_.each(_this.cache_chs,function(opt){opt.is_visible=true;try{if(opt.data.options[0].required){opt.required=true;opt.enable();opt.off()}}catch(error){}});if(_this.plan.options.tag_id==141){_.each(["speed_night_x2","parent_control","safe_internet","stat_ip","zabava_tv_online","antivirus","traffic_max","torrent","social_networks","surfing"],function(alias){if(typeof _this.cache_opt[alias]!=="undefined"){_this.cache_opt[alias].disable();_this.cache_opt[alias].is_visible=false}if(typeof _this.cache_chs[alias]!=="undefined"){_this.cache_chs[alias].disable();_this.cache_chs[alias].is_visible=false}});_this.rendered=false}if(this.plan.hasIptv){if(this.plan.options.tag_id==312){if(this.basic_iptv.length>=2){for(var i=0;i<2;i++){this.cache_pkg[this.basic_iptv[i]].enable()}}else{this.cache_pkg[this.basic_iptv[0]].enable()}}if(mrf.isDv(adrMgr.selectedRegion.klRegion)){if(app.wi.cart.basic_iptv.length==1){$(".promo-action__text.autumn_mix").text("Выгодная цена на основной пакет телеканалов!");$(".config-choise__head.autumn_mix").text("Выгодная цена на основной пакет телеканалов!");$(".content-p-0.content-p-0_last.autumn_mix").text("Подключитесь по акции и четыре месяца платите за основной пакет телеканалов всего 250 рублей в месяц.")}}if(isCorrectPrice){var packCnt=1;switch(correctPriceTag){case 329:case 330:break;case 331:packCnt=2;break;case 332:packCnt=3;break}if(app.wi.cart.basic_iptv.length>=packCnt){for(var i=0;i<packCnt;i++){app.wi.cart.cache_pkg[app.wi.cart.basic_iptv[i]].enable()}}}if([110,223,224,282,287].indexOf(this.plan.options.tag_id)!=-1){if(typeof this.cache_pkg.iptv_popular!=="undefined"){this.cache_pkg.iptv_popular.enable()}}if(typeof this.cache_pkg.iptv_hd!=="undefined"){this.cache_pkg.iptv_hd.enable()}if(typeof this.cache_dev[this.multiroom.stb_main_id]!=="undefined"){this.cache_dev[this.multiroom.stb_main_id].enable()}if(this.plan.options.tag_id==282){if(mrf.isSibir(adrMgr.selectedRegion.klRegion)||mrf.isDv(adrMgr.selectedRegion.klRegion)||mrf.isSouth(adrMgr.selectedRegion.klRegion)){this.cache_pkg.iptv_cinema.enable()}}this.rendered=false}if(!!app.wi.cart.cache_opt.wi_fi_router){this.cache_opt.wi_fi_router.enable()}else{$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().find("li").each(function(){if($(this).text().indexOf("Аренда")==0){$(this).click()}})}_this.checkOptions()};this.choiceDevice=function(device){var _this=this;var add_or_remove=device.el.find(".unit-equipment__switch").is(":checked");var quantity=parseInt(device.el.find(".unit-equipment__number").html());var tariff_id=parseInt(device.el.find("select.unit-equipment__select").val());var dvs=_.find(this.data.choice_devices,function(dvs){return(dvs.id==device.data.id)});if(typeof dvs==="undefined"&&add_or_remove){device.data.quantity=quantity;this.data.choice_devices.push(device.data);this.choiceDevicePayType(device,tariff_id)}if(!add_or_remove){this.data.choice_devices=_.filter(this.data.choice_devices,function(dvs){return(dvs.id!=device.data.id)})}this.validateMultiroom(device);_this.rendered=false;this.render()};this.disableMultiroom=function(){var _this=this;_this.multiroom.stb_dvc_max=3;_this.multiroom.vsender_dvc_max=3;_.each(this.cache_dev,function(dvs){if(dvs.isStb()){if(dvs.isEnable()){dvs.setQuantity(1);dvs.disableMinus();if(dvs.isPremiumStb()){_this.cache_dev[_this.multiroom.stb_main_id].disable()}}}if(dvs.isSender()){dvs.setQuantity(1);if(dvs.isEnable()){dvs.disableMinus()}}});_this.validateMultiroom()};this.validateMultiroom=function(device){var _this=this;_this.multiroom.stb_dvc=0;_this.multiroom.vsender_dvc=0;_.each(_this.data.choice_devices,function(dvs){if(_this.multiroom.stb_dvc_id.indexOf(dvs.alias)!==-1){_this.multiroom.stb_dvc+=dvs.quantity}if(_this.multiroom.vsender_dvc_id.indexOf(dvs.alias)!==-1){_this.multiroom.vsender_dvc+=dvs.quantity}});if(typeof device!=="undefined"){if(_this.multiroom.stb_dvc>1){if(_this.multiroom.is_on==false){utils.Message('<div style="max-width: 350px;"><p class="content-p-0 r-12">Вам будет включена дополнительная услуга &laquo;Мультирум&raquo;</p></div>',"","Внимание",function(){_this.cache_chs.iptv_multiroom.enable()})}if(_this.multiroom.stb_dvc==2){_this.cache_chs.iptv_multiroom.setOption(0);_this.multiroom.stb_dvc_max=3;if(device){_this.cache_chs.iptv_multiroom.data.current_tariff=_this.cache_chs.iptv_multiroom.data.options[0];_this.choiceOptionTariff(null,_this.cache_chs.iptv_multiroom);_this.cache_chs.iptv_multiroom.el.find(".cost-rubmonth-2rows").html(_this.cache_chs.iptv_multiroom.data.current_tariff.fee)}}if(_this.multiroom.stb_dvc==3){_this.cache_chs.iptv_multiroom.setOption(1);if(device){_this.cache_chs.iptv_multiroom.data.current_tariff=_this.cache_chs.iptv_multiroom.data.options[1];_this.choiceOptionTariff(null,_this.cache_chs.iptv_multiroom);_this.cache_chs.iptv_multiroom.el.find(".cost-rubmonth-2rows").html(_this.cache_chs.iptv_multiroom.data.current_tariff.fee)}_this.multiroom.stb_dvc_max=3}}else{if(!_this.cache_chs.iptv_multiroom.required){_this.cache_chs.iptv_multiroom.setOption(0);_this.cache_chs.iptv_multiroom.disable()}}if(_this.multiroom.stb_dvc==_this.multiroom.stb_dvc_min){device.disableMinus()}else{device.enableMinus()}if(_this.multiroom.stb_dvc>=_this.multiroom.stb_dvc_max){var q=_this.multiroom.stb_dvc-_this.multiroom.stb_dvc_max;if(q>0){if(_this.multiroom.stb_dvc_id.indexOf(device.data.alias)!==-1){var dvc_id=(device.data.alias==_this.device_ids.premium)?_this.device_ids.main:_this.device_ids.premium;if(_this.cache_dev[dvc_id].enableD){var cur_q=_this.cache_dev[dvc_id].getQuantity();var set_q=cur_q-q;if(cur_q==1&&q>0){_this.cache_dev[dvc_id].setQuantity(1);_this.cache_dev[dvc_id].disable()}else{if(set_q>0){_this.cache_dev[dvc_id].setQuantity(cur_q-q)}else{_this.cache_dev[dvc_id].setQuantity(1);_this.cache_dev[dvc_id].disable()}}}}}}if(device.getQuantity()>=_this.multiroom.stb_dvc_max){if(_this.multiroom.stb_dvc_max==2){_this.cache_chs.iptv_multiroom.setOption(0);_this.multiroom.stb_dvc_max=3}}else{device.enablePlus()}if(device.getQuantity()==3){device.disablePlus()}if(device.alias==_this.device_ids.sender&&device.getQuantity()>=app.wi.cart.multiroom.stb_dvc){device.disablePlus()}if(_this.multiroom.stb_dvc<_this.multiroom.stb_dvc_min){utils.Error("Пользоваться услугой Интерактивное ТВ можно только при наличии ТВ-приставки.</br>Вам необходимо выбрать либо ТВ-приставку «Стандарт», либо ТВ-приставку «Премиум».","Внимание",function(){var main_dvs=_this.cache_dev[_this.multiroom.stb_main_id];main_dvs.setQuantity(_this.multiroom.stb_dvc_min);main_dvs.disableMinus();main_dvs.enable()})}if(_this.multiroom.vsender_dvc>=3){_this.cache_dev[_this.multiroom.vsender_dvc_id[0]].disablePlus()}if(_this.multiroom.vsender_dvc>_this.multiroom.stb_dvc&&_this.multiroom.stb_dvc>0){_this.cache_dev[_this.multiroom.vsender_dvc_id[0]].setQuantity(_this.multiroom.stb_dvc)}}else{if(_this.multiroom.stb_dvc>_this.multiroom.stb_dvc_max){var q=_this.multiroom.stb_dvc-_this.multiroom.stb_dvc_max;var prm_dvc=_this.cache_dev[_this.multiroom.stb_prm_id];if(prm_dvc.enableD){var qp=prm_dvc.getQuantity();var qd=qp-q;if(qd>0){prm_dvc.setQuantity(qd)}else{prm_dvc.disable()}}else{var main_dvs=_this.cache_dev[_this.multiroom.stb_main_id];main_dvs.setQuantity(_this.multiroom.stb_dvc_max);main_dvs.disableMinus();main_dvs.enable(false)}}_.each(_this.cache_dev,function(dvs){if(dvs.enableD){dvs.enableMinus();dvs.enablePlus()}})}};this.choiceDevicePayType=function(device,tariff_id){var _this=this;_.each(this.all_devices,function(dvs,idx){if(dvs.data.id==device.data.id){_this.rendered=false;var price=dvs.data.prices[tariff_id];dvs.tariff_id=tariff_id;dvs.saleType=price.saleType;dvs.fee=price.fee;dvs.cost=price.cost;if(dvs.data.alias=="iptv_device_standard"&&dvs.saleType=="RENT"&&dvs.isAction==true){$("#device_action_block").show();if(app.wi.cart.cache_dev[_this.device_ids.main].enableD){$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().parent().find(".unit-equipment__btn_plus").removeClass("unit-equipment__btn_passive").addClass("unit-equipment__btn_active");$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().parent().find(".unit-equipment__btn_minus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive");$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().parent().find(".unit-equipment__number").text("1")}dvs.afterFee=price.afterFee}else{$("#device_action_block").hide()}if(dvs.data.alias=="iptv_device_premium"&&dvs.saleType=="SALE"&&mrf.isSibir(adrMgr.selectedRegion.klRegion)&&adrMgr.selectedCity.klRegion!="42"){$("#premium_device_action_block").show();$("#premium_device_past_cost").show()}else{$("#premium_device_action_block").hide();$("#premium_device_past_cost").hide()}}});this.render()};this.choiceOptionTariff=function(e,option,tariff_id){var _this=this;option.data.fee=option.data.current_tariff.fee;if(option.alias=="iptv_multiroom"){var s=option.data.current_tariff.altName.replace(/[^0-9]/g,"");var q=parseInt(s);_this.multiroom.stb_dvc_max=q;_this.validateMultiroom()}_this.rendered=false;_this.checkOptions()};this.addOption=function(option){var _this=this;if(typeof option.data!=="undefined"&&typeof option.data.mode!=="undefined"){var group_name="";if(option.data.mode=="option"){group_name="choice_options"}if(option.data.mode=="package"){group_name="choice_packages"}if(option.data.mode=="subscription"){group_name="choice_subscriptions"}if(option.data.mode=="choice"){group_name="choice_choices"}if(group_name!=""){var fi=-1;_.each(_this.data[group_name],function(opt,idx){if(opt.alias==option.data.alias){fi=idx}});if(fi==-1){_this.data[group_name].push(option.data)}}}option.enable(false)};this.removeOption=function(option){var _this=this;if(typeof option.data!=="undefined"&&typeof option.data.mode!=="undefined"){var group_name="";if(option.data.mode=="option"){group_name="choice_options"}if(option.data.mode=="package"){group_name="choice_packages"}if(option.data.mode=="subscription"){group_name="choice_subscriptions"}if(option.data.mode=="choice"){group_name="choice_choices"}if(group_name!=""){var fi=-1;_.each(_this.data[group_name],function(opt,idx){if(opt.alias==option.data.alias){fi=idx}});if(fi!=-1){if(fi==_this.data[group_name].length){_this.data[group_name].shift()}else{_this.data[group_name].splice(fi,1)}}}}option.disable(false)};this.checkOptions=function(){var _this=this;var changed=false;var opt_len=0;opt_len=_this.data.choice_packages.length;_.each(_this.cache_pkg,function(opt){var add=opt.el.find(".config-choise__checkbox").is(":checked");if(add){_this.addOption(opt)}else{_this.removeOption(opt)}});if(opt_len!=_this.data.choice_packages.length){changed=true}opt_len=_this.data.choice_options.length;_.each(_this.cache_opt,function(opt){var add=opt.el.find(".config-choise__checkbox").is(":checked");if(add){_this.addOption(opt)}else{_this.removeOption(opt)}if(opt.is_visible==false){opt.el.hide()}});if(opt_len!=_this.data.choice_options.length){changed=true}opt_len=_this.data.choice_choices.length;_.each(_this.cache_chs,function(opt){var add=opt.el.find(".config-choise__checkbox").is(":checked");if(add){_this.addOption(opt)}else{_this.removeOption(opt)}if(opt.is_visible==false){opt.el.hide()}});if(opt_len!=_this.data.choice_choices.length){changed=true}if(changed||_this.rendered==false){_this.render()}};this.choiceOption=function(e,option){var _this=this;var add_or_remove=$(e.currentTarget).find(".config-choise__checkbox").is(":checked");var find=-1;if(typeof _this.plan!=="undefined"&&_this.plan!=null){_this.rendered=false;if(option.required){add_or_remove=true}if(option.alias=="iptv_multiroom"){_this.multiroom.is_on=add_or_remove;if(add_or_remove){var id=parseInt(option.el.find("select.config-choise__sel").val());_.each(option.data.options,function(opt){if(opt.id==id){option.data.current_tariff=opt}});if(typeof option.data.current_tariff!=="undefined"){var s=option.data.current_tariff.altName.replace(/[^0-9]/g,"");var q=parseInt(s);_this.multiroom.stb_dvc_max=q;_this.multiroom.vsender_dvc_max=q;_this.validateMultiroom()}}else{_this.disableMultiroom()}}var disabled_opts={safe_internet:["parent_control"],parent_control:["safe_internet"],speed_night_x2:["torrent","social_networks","surfing"],torrent:["speed_night_x2","social_networks","surfing","plus100mbs"],social_networks:["speed_night_x2","torrent","surfing","plus100mbs"],surfing:["speed_night_x2","social_networks","torrent","plus100mbs"],plus100mbs:["social_networks","surfing","torrent"]};if(typeof disabled_opts[option.alias]!=="undefined"){_.each(disabled_opts[option.alias],function(als){if(typeof _this.cache_chs[als]!=="undefined"){_this.removeOption(_this.cache_chs[als])}if(typeof _this.cache_opt[als]!=="undefined"){_this.removeOption(_this.cache_opt[als])}})}if(option.alias=="iptv_max"){if(add_or_remove){_this.has_iptv_max=true;_this.addOption(_this.cache_pkg.iptv_adult);_.each(_this.basic_iptv,function(als){if(typeof _this.cache_pkg[als]!=="undefined"){_this.addOption(_this.cache_pkg[als])}})}else{_this.has_iptv_max=false;_this.removeOption(_this.cache_pkg.iptv_adult);_.each(_this.basic_iptv,function(als){if(typeof _this.cache_pkg[als]!=="undefined"){_this.removeOption(_this.cache_pkg[als])}});var isCorrectPrice=false;var correctPriceTag=0;if(typeof this.plan.isCorrectPrice!=="undefined"&&this.plan.isCorrectPrice){isCorrectPrice=true;correctPriceTag=this.plan.correctPriceTag}if(isCorrectPrice){var packCnt=1;switch(correctPriceTag){case 329:case 330:break;case 331:packCnt=2;break;case 332:packCnt=3;break}if(this.basic_iptv.length>=packCnt){for(var i=0;i<packCnt;i++){this.cache_pkg[this.basic_iptv[i]].enable()}}}else{this.cache_pkg.iptv_popular.enable()}}_this.checkOptions()}else{if(_this.basic_iptv.indexOf(option.alias)!=-1||["iptv_adult"].indexOf(option.alias)!=-1){if(add_or_remove==false&&_this.has_iptv_max){_this.has_iptv_max=false;_this.cache_pkg.iptv_max.disable(false)}_this.checkOptions()}}}if(option.mode=="package"&&!add_or_remove){var cnt=0;for(var i=0;i<_this.data.choice_packages.length;i++){var __this=_this.data.choice_packages[i];if(__this.packgeType===26){cnt++}}if(cnt==0){var message=(_this.dis_options.indexOf("iptv_max")!==-1)?"Необходимо выбрать один основной пакет":"Необходимо выбрать один основной пакет или пакет &laquo;Максимальный&raquo;";utils.Error(message,"Внимание!",function(){option.enable()})}}if(add_or_remove){_this.addOption(option)}else{if(option.required!=true){_this.removeOption(option)}}_this.checkOptions();if(this.tag_id!=312){if(option.alias=="amedia"&&add_or_remove){var selPacks=[];for(var obj in _this.tariff.services.iptv.choice_packages){selPacks.push(_this.tariff.services.iptv.choice_packages[obj].alias)}if($.inArray("iptv_amedia",selPacks)==-1){utils.Error("Подключение подписки «AMEDIA Premium» возможно только при условии выбора пакета телеканалов «AMEDIA Premium»","Внимание",function(){_this.cache_subs.amedia.disable()})}}if(option.alias=="iptv_amedia"&&!add_or_remove){_this.cache_subs.amedia.disable()}}if(option.alias=="viaplay"&&add_or_remove){var selPacks=[];for(var obj in _this.tariff.services.iptv.choice_packages){selPacks.push(_this.tariff.services.iptv.choice_packages[obj].alias)}if($.inArray("iptv_hd_premium",selPacks)==-1){utils.Error("Подключение подписки «TV1000PLAY» возможно только при условии выбора пакета телеканалов «Viasat Премиум HD»","Внимание",function(){_this.cache_subs.viaplay.disable()})}}if(option.alias=="iptv_hd_premium"&&!add_or_remove){_this.cache_subs.viaplay.disable();_this.cache_subs.viaplay.on()}if(option.alias=="iptv_hd_premium"&&add_or_remove){utils.Error("Вам будет включена подписка «TV1000PLAY»","Внимание",function(){_this.cache_subs.viaplay.enable();_this.cache_subs.viaplay.off()})}if(option.alias=="wi_fi_router"){if(this.has_iptv){if(add_or_remove){$("#tariff-device-2").find(".unit-equipment__select").eq(0).hide();$("#tariff-device-2").find(".unit-equipment__bottom").prepend('<span class="basket__data-row-item_color-orange">Аренда на 12 месяцев по акции «Выгодное оборудование»</span>');$($("#device-choice-2, #device-choice-iptv_device_standard").children()).each(function(){if($(this).text().indexOf("Аренда")==0){$(this).removeAttr("disabled").show();$("#device-choice-2, #device-choice-iptv_device_standard").val($(this).val()).selectric("refresh").change();$("#arenda").hide()}});app.wi.cart.cache_chs.iptv_multiroom.disable();$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().parent().find(".unit-equipment__btn_plus").removeClass("unit-equipment__btn_passive").addClass("unit-equipment__btn_active");$("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().parent().find(".unit-equipment__btn_minus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive");app.wi.cart.cache_dev[_this.device_ids.main].enable();$($("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().find("li")).each(function(){if($(this).text().indexOf("Аренда")==0){$(this).attr("disabled","disabled").hide()}});$($("#device-choice-2, #device-choice-iptv_device_standard").children()).each(function(){if($(this).text().indexOf("Аренда")==0){$(this).attr("disabled","disabled").hide()}})}else{$("#tariff-device-2").find(".unit-equipment__bottom").children().first().remove();$("#tariff-device-2").find(".unit-equipment__select").eq(0).show();var selItemCnt=0;$("#device-choice-2, #device-choice-iptv_device_standard").find("option").each(function(){if($(this).text().indexOf("36")>-1){selItemCnt=parseInt($(this).val())}});$("#device-choice-2, #device-choice-iptv_device_standard").val(selItemCnt).selectric("refresh").change();$($("#device-choice-2, #device-choice-iptv_device_standard").parent().parent().find("li")).each(function(){if($(this).text().indexOf("Аренда")==0){$(this).attr("disabled","disabled").hide()}});$($("#device-choice-2, #device-choice-iptv_device_standard").children()).each(function(){if($(this).text().indexOf("Аренда")==0){$(this).hide()}});$("#arenda").attr("disabled","disabled").show()}}}};this.checkPlay=function(){var _this=this;var _mode=this.mode;var svc=0;_this.mode="singleplay";if(_this.has_iptv||_this.plan.hasIptv){svc++}if(_this.plan.hasShpd||_this.i_have_shpd){svc++}if(_this.plan.hasPhone||_this.i_have_phone){svc++}if(svc==2){_this.mode="doubleplay"}if(svc==3){_this.mode="tripleplay"}if(_this.has_iptv){if(_this.tag_id==312){_this.mode="tripleplay"}var list=$(".package-tvchannel__cost-list");list.empty();if(typeof _this.prices!=="undefined"){for(var i=1;i<=_this.basic_iptv.length;i++){var p=_this.prices.singlepay[i]/100;if(_this.mode=="doubleplay"&&_this.prices.discount_doubleplay){p+=_this.prices.discount_doubleplay[i]/100}if(_this.mode=="tripleplay"&&_this.prices&&_this.prices.discount_tripleplay){p+=_this.prices.discount_tripleplay[i]/100}var el='<p class="row-brd-dotted package-tvchannel__cost-item"><span class="row-brd-dotted__cnt package-tvchannel__cost-item-name">'+i+'-й пакет</span><span class="row-brd-dotted__cnt package-tvchannel__cost-item-price"><span class="cost-rubmon">'+p+"</span></span></p>";if(_this.tag_id==312){if(i<3){el=""}if(i==1){if(_this.basic_iptv.length>1){el='<p class="content-head-18 color-orange-dark">2 любых основных пакета входят в&nbsp;стоимость «Комплект&nbsp;3&nbsp;в&nbsp;1»</p>'}else{el='<p class="content-head-18 color-orange-dark">1 основной пакет входит в&nbsp;стоимость «Комплект&nbsp;3&nbsp;в&nbsp;1»</p>'}}}list.append(el)}}}if(_mode!=_this.mode){_this.rendered=false;_this.render()}};this.getOrder=function(){var _this=this;var phone="";var firstName="";var lastName="";var middleName="";var email="";_this.order={order:{packetId:null,packetStateId:null,firstName:firstName,lastName:lastName,middleName:middleName,homePhone:phone,cellPhone:phone,dopInfo:"",email:email,notifyByEmail:0,notifyBySMS:0,orderChannel:31,region:_this.reg_id,tabCount:0},tabs:[],url:"/ajax/packetOrder/save.jsp"};var form=$(".order-now");_.each(_this.tariff.services,function(srv,type){_this.order.order.tabCount++;var tab={tarPlan:srv.id,svcClassId:(type=="iptv")?2:1,city:"",streetId:"",street:"",cityId:parseInt(_this.addr_code),flat:"",houseId:"",house:"",instPhone:phone,params:{form_name:"tvin_fast"},options:[]};if(window.location.pathname.split("/").length>0){var cnt=window.location.pathname.split("/").length-1;tab.params.form_name=window.location.pathname.split("/")[cnt]}if(type=="shpd"){tab.domominimum=_this.tariff.techId}if(type=="pstn"){var selectedId=$("#phoneSelect").val();for(var s in srv){if(srv[s].id==selectedId){tab.tarPlan=srv[s].id;tab.svcClassId=3;for(var o in srv[s].options){if(srv[s].options[o].altName=="base_personal"){tab.options.push(srv[s].options[o].altName);break}}break}}}if(typeof srv.base!=="undefined"&&srv.base.required==true){tab.options.push("base")}_.each(srv.choice_options,function(opt){if(!(tab.svcClassId==2&&(opt.alias==="zabava_tv_online"||opt.alias==="multiscreen"))){if(opt.alias==="wi_fi_router"){_this.order.order.dopInfo+="Wi-Fi роутер/модем по акции «Выгодное оборудование» 1 руб./мес."}else{tab.options.push(opt.alias)}}});_.each(srv.choice_choices,function(opt){tab.options.push(opt.current_tariff.altName)});_.each(srv.choice_subscriptions,function(opt){tab.options.push(opt.alias)});_.each(srv.choice_packages,function(opt){tab.options.push(opt.alias)});if(tab.svcClassId==2){tab.devices=[];_.each(srv.choice_devices,function(dvs){if(typeof dvs.current_tariff!=="undefined"){for(var i=1;i<=dvs.quantity;i++){tab.devices.push(dvs.alias+":"+dvs.current_tariff.saleSchem)}}});if(srv.inPkg==false){if(_this.mode=="tripleplay"){tab.options.push("discount_tripleplay")}if(_this.mode=="doubleplay"){tab.options.push("discount_doubleplay")}}}_this.order.tabs.push(tab)});return _this.order};this.choiceMode=function(e){var _this=this;var chb=$(e.currentTarget);var on_off=chb.is(":checked");var prt=chb.parents("section");var ico=prt.find(".config-choise-mini__icon .choise-ico");if(on_off){ico.addClass("config-choise-mini__icon_choise-checked")}else{ico.removeClass("config-choise-mini__icon_choise-checked")}if(chb.hasClass("modeplay-shpd")){_this.i_have_shpd=on_off}if(chb.hasClass("modeplay-phone")){_this.i_have_phone=on_off}_this.checkPlay()};this.renderAlert=function(header,message){this.renderError(header,message)};this.renderError=function(header,message){utils.Notice(message,header)};this.renderOptions=function(){var _this=this;if(_this.plan){var isCorrectPrice=false;var correctPriceTag=0;if(typeof _this.plan.isCorrectPrice!=="undefined"&&_this.plan.isCorrectPrice){isCorrectPrice=true;correctPriceTag=_this.plan.correctPriceTag}_.each(_this.plan.tariffs,function(trf){if(typeof trf.services!=="undefined"){if(typeof trf.services.iptv!=="undefined"){_this.has_iptv=true}if(typeof trf.services.shpd!=="undefined"){_this.has_shpd=true}}_.each(trf.services,function(srv){if(typeof srv.type=="undefined"){if(srv.length>0){var data=[];for(var s in srv){_this.all_phones.push(srv[s])}}}var type=srv.type;if(typeof trf.techId==="undefined"&&typeof trf.services.shpd!=="undefined"){trf.techId=trf.services.shpd.techId}_.each(srv.options,function(opt){var enableByTech=true;if(opt.required){enableByTech=true}if(typeof trf.techId!=="undefined"&&typeof opt.techId!=="undefined"&&trf.techId!=opt.techId){enableByTech=false}if(_this.dis_options.indexOf(opt.altName)==-1&&enableByTech){opt.type=type;opt.mode="option";if(opt.altName!=="base"){var findOpt=_.where(_this.all_options,{alias:opt.altName});if(findOpt.length==0){opt.fee=((opt.fee||0)/100);opt.alias=opt.altName;var to=new TariffOption({id:"tariff-option-"+opt.alias,mode:opt.mode,alias:opt.alias,"class":"config-choise",data:opt,tpl:_this.to_tpl});_this.all_options.push(to);_this.cache_opt[opt.alias]=to}}}});if(typeof srv.packages!=="undefined"){_.each(srv.packages.packages,function(pckg){if(_this.dis_options.indexOf(pckg.altName)==-1){pckg.type=type;pckg.tag=_this.tag_id;pckg.mode="package";var findPckg=_.where(_this.all_packages,{alias:pckg.altName});if(findPckg.length==0){pckg.fee=(pckg.fee/100);pckg.alias=pckg.altName;if(typeof _this.cache_channels[pckg.altName]!=="undefined"){pckg.channels=_this.cache_channels[pckg.altName];pckg.channels_label=_this.wc.declOfNum(pckg.channels.length,["Канал","Канала","Каналов"])}if(typeof pckg.packgeType!=="undefined"&&pckg.packgeType==26){_this.basic_iptv.push(pckg.alias)}var to=new TariffOption({id:"tariff-package-"+pckg.alias,mode:pckg.mode,alias:pckg.alias,"class":"config-choise js-config-choise",data:pckg,tpl:_this.to_tpl});_this.all_packages.push(to);_this.cache_pkg[pckg.alias]=to}}})}if(typeof srv.choices!=="undefined"){_.each(srv.choices,function(chs){var enableByTech=true;var enableByTechOpts=-1;_.each(chs.options,function(opt,idx){if(typeof trf.techId!=="undefined"&&typeof opt.techId!=="undefined"&&enableByTechOpts==-1){enableByTechOpts=0}if(typeof trf.techId!=="undefined"&&typeof opt.techId!=="undefined"&&trf.techId==opt.techId){enableByTechOpts++}});if(enableByTechOpts==0){enableByTech=false}chs.type=type;chs.alias=chs.name;chs.mode="choice";chs.tag=app.wi.cart.tag_id;if(_this.dis_choices.indexOf(chs.alias)==-1&&enableByTech){var findChs=_.where(_this.all_choices,{alias:chs.alias});if(findChs.length==0){if(chs.alias=="parent_control"){var opt_filter=_.where(chs.options,{altName:"parent_control_block_filter"});if(opt_filter.length!=0){chs.options=opt_filter}}if(chs.alias=="safe_internet"){var opt_filter=_.where(chs.options,{altName:"safe_internet_base"});if(opt_filter.length!=0){chs.options=opt_filter}}_.each(chs.options,function(opt,idx){opt.id=(typeof opt.id!=="undefined")?opt.id:idx;opt.fee=(opt.fee/100);if(idx==0||chs.options.length==1){chs.current_tariff=opt}});if(typeof chs.current_tariff!=="undefined"){chs.fee=chs.current_tariff.fee}var to=new TariffOption({id:"tariff-choice-"+chs.alias,mode:chs.mode,alias:chs.alias,"class":"config-choise",data:chs,tpl:_this.to_tpl});if(chs.options.length==1){to.enable_options=false}_this.all_choices.push(to);_this.cache_chs[chs.alias]=to}}})}if(typeof srv.subsPack!=="undefined"&&typeof srv.subsPack.subscriptions!=="undefined"){_.each(srv.subsPack.subscriptions,function(opt){opt.type=type;opt.alias=opt.id;opt.mode="subscription";var find=_.where(_this.all_subscriptions,{alias:opt.alias});if(find.length==0){if(typeof opt.fee!=="undefined"){opt.fee=(opt.fee/100)}if(typeof opt.cost!=="undefined"){opt.cost=(opt.cost/100)}if(typeof opt.fee==="undefined"&&typeof opt.cost==="undefined"){opt.fee=0}var to=new TariffOption({id:"tariff-subscription-"+opt.alias,mode:opt.mode,alias:opt.alias,"class":"config-choise",data:opt,tpl:_this.to_tpl});_this.all_subscriptions.push(to);_this.cache_subs[opt.alias]=to}})}if(typeof srv.devices!=="undefined"){_.each(srv.devices,function(dvs,idx){dvs.alias=dvs.id;dvs.id=idx;dvs.type=type;dvs.quantity=0;if(_this.multiroom.stb_main_id==dvs.id&&typeof mrf!=="undefined"&&typeof adrMgr!=="undefined"){}var findDvs=_.where(_this.all_devices,{alias:dvs.alias});var hasDefaultPrice=false;if(findDvs.length==0){dvs.prices=_.map(dvs.prices,function(price,idx){price.id=idx;price.fee=(price.fee/100);price.cost=(price.cost/100);price.is_visible=true;if(!hasDefaultPrice&&price.is_visible){price["default"]=true;dvs.fee=price.fee;hasDefaultPrice=true}return price});var td=new TariffDevice({id:"tariff-device-"+idx,alias:dvs.alias,"class":dvs.alias!=_this.device_ids.sender?"unit-equipment unit-equipment_passive unit-content-2_3 unit-content":"unit-equipment unit-equipment_passive unit-content",data:dvs,tpl:_this.td_tpl});if(dvs.alias==_this.device_ids.main){td.order=0}if(dvs.alias==_this.device_ids.premium){td.order=1}if(dvs.alias==_this.device_ids.sender){td.order=2}_this.all_devices.push(td);_this.cache_dev[dvs.alias]=td}})}})});_.each(_this.all_options,function(opt){opt.is_enable=true;var el_desc=$('<div class="item-desc js-item-desc js-desctop-scrolled-block"></div>').attr("id",opt.mode+"-"+opt.alias);el_desc.html(_this.tod_tpl.render({mode:opt.mode,alias:opt.alias,title:opt.data.title,description:opt.data.description}));$("#internet-1-desc").append(el_desc);if(opt.alias=="wi_fi_router"){if(_this.has_iptv){opt.data.packet=true}else{opt.data.packet=false}$("#fake_device").append(opt.render().el);$(".p-section-fake_device").show()}else{if((_this.tag_id!=312&&!app.wi.cart.tariff.inPkg&&!isCorrectPrice)&&$("#internet-1").find("section").length<4){$("#internet-1").append(opt.render().el)}else{if(opt.data.required!=="undefined"&&opt.data.required==true){$("#internet-1").append(opt.render().el)}else{$("#apack").append(opt.render().el)}}if(["zabava_tv_online","multiscreen"].indexOf(opt.alias)!==-1){$("#iptv-3").append(opt.render().el)}}opt.el.on("choice",function(e,option){_this.choiceOption(e,option)})});if(_this.tag_id==312||app.wi.cart.tariff.inPkg||isCorrectPrice){var speedText="Скорость до "+app.wi.cart.tariff.speed/1024+" Мбит/с ";var isTwoTypeTech=false;if(app.wi.cart.tariff.technology.indexOf(1)>=1&&app.wi.cart.tariff.technology.length>1){isTwoTypeTech=true}if(app.wi.cart.tariff.techId>=2){speedText+="по "+(isTwoTypeTech?"телефонной или выделенной":"выделенной")+" линии ("+app.wi.cart.tariff.techComment+")"}else{speedText+="по телефонной линии (технология ADSL)"}var title="Максимальный";if(app.wi.cart.tariff.title.toLowerCase().indexOf("оптимальный")>=0){title="Оптимальный"}if(_this.tag_id!=312){title=_this.getTariffTitle(app.wi.cart.tariff)}_html='<section class="config-choise">';if(_this.tag_id==312){_html+='<div class="js-promo-action promo-action package-tvchannel__promo-action promo-action_passive">';_html+='<span class="promo-action__hovering">';_html+='<i class="promo-action__orange-triangle"><span class="promo-action__lbl-a promo-action__lbl_txt-small">3в1</span></i></span>';_html+='<div class="promo-action__wrap"><h3 class="promo-action__title">Акция!</h3><p class="promo-action__text">Комплект 3 в 1&nbsp;&mdash;<br>вместе выгоднее</p></div>';_html+="</div>"}_html+='<div class="config-choise__desc">';_html+='<div class="config-choise__icon config-choise__icon_choise-checked">';_html+='<div class="choise-ico choise-content-ico choise-ico_small '+utils.getTariffSpeedIco(app.wi.cart.tariff.speed)+'">';_html+='<span class="choise-content-ico__txt">'+app.wi.cart.tariff.speed/1024+" Мб/с</span>";_html+="</div>";_html+="</div>";_html+='<h1 class="config-choise__head">Тариф «'+title+(isCorrectPrice?" "+app.wi.cart.tariff.speed/1024:"")+'»</h1><p class="content-p-0 content-p-0_last">'+speedText+"</p></div></section>";$("#internet-1").prepend(_html);$("#user-opts").find(".options__head").text("Домашний Интернет");$("#show_more_shpd").text("Показать дополнительные опции Домашнего Интернета");$("#opt-promo").show();$("#show_more_shpd").on("click",function(){$("#opt-promo").hide();if(app.wi.cart.tag_id==287){$("#show_more_shpd-desc").removeClass();$("#show_more_shpd-desc").addClass("options__desc b-4_tablet-hidden js-desctop-scrolled-block")}$("#standart-promo").show()})}else{$("#standart-promo").show()}_.each(_this.all_choices,function(chs){if(["safe_internet","parent_control","antivirus"].indexOf(chs.alias)!==-1){var el_desc=$('<div class="item-desc js-item-desc"></div>').attr("id",chs.mode+"-"+chs.alias);el_desc.html(_this.tod_tpl.render({mode:chs.mode,alias:chs.alias,title:chs.data.title,description:chs.data.description}));$("#internet-1-desc").append(el_desc);var isCorrectPrice=false;if(typeof _this.plan.isCorrectPrice!=="undefined"){isCorrectPrice=_this.plan.isCorrectPrice}if((_this.tag_id!=312&&!app.wi.cart.tariff.inPkg&&!isCorrectPrice)&&$("#internet-1").find("section").length<4){$("#internet-1").append(chs.render().el)}else{$("#apack").append(chs.render().el)}}else{$("#iptv-3").append(chs.render().el)}chs.el.on("choice",function(e,option){_this.choiceOption(e,option)});chs.el.on("choice_option",function(e,option,id){_this.choiceOptionTariff(e,option,id)})});if($("#apack").find("section").length==0){$("#show_more_shpd").hide()}if($("#apack").find("section").length==0){$("#user-opts .page-ad-block").hide()}var firstDopPackCount=0;var isFirst=false;for(var i=0;i<_this.all_packages.length;i++){if(_this.all_packages[i].data.packgeType==27&&!isFirst){firstDopPackCount=i;isFirst=true}if(_this.all_packages[i].data.packgeType==27&&_this.all_packages[i].alias=="iptv_hd"){var temp=_this.all_packages[i];_this.all_packages[i]=_this.all_packages[firstDopPackCount];_this.all_packages[firstDopPackCount]=temp;break}}var cntMainPack=0;_.each(_this.all_packages,function(pckg){if(pckg.data.packgeType==26||pckg.data.packgeType==28){$("#iptv-1").append(pckg.render().el);cntMainPack++;if(cntMainPack>1){$("#tv-compare-open").show()}}if(pckg.data.packgeType==27){$("#iptv-2").append(pckg.render().el)}pckg.el.on("choice",function(e,option){_this.choiceOption(e,option)});pckg.el.on("loadChannels",function(e,alias){if(alias=="iptv_popular"){_this.rendered=false;_this.renderCart()}})});if(isCorrectPrice){var showPackCnt=0;switch(correctPriceTag){case 329:case 330:break;case 331:showPackCnt=1;break;case 332:showPackCnt=2;break}for(var i=0;i<$("#iptv-1").find("section").length;i++){if(i>showPackCnt){$($("#iptv-1").find("section")[i]).hide()}}$("#show_more_iptv").text("Показать все основные пакеты телеканалов");$("#show_more_iptv").on("click",function(){$("#iptv-1").find("section").show();$("#show_more_iptv").hide()})}_this.all_devices=_.sortBy(_this.all_devices,function(dvs){return dvs.order});var hasOptionDevices=false;_.each(_this.all_devices,function(dvs){if(isCorrectPrice){if(dvs.data.alias==_this.device_ids.sender){$("#s3 #optional-equipment").append(dvs.render().el)}else{$("#s2 #basic-equipment").append(dvs.render().el)}}else{if(dvs.data.alias==_this.device_ids.sender){$("#s2 #optional-equipment").append(dvs.render().el)}else{$("#s2 #basic-equipment").append(dvs.render().el)}}dvs.el.on("choice",function(e,device){_this.choiceDevice(device)});dvs.el.on("choice_tariff",function(e,device,tariff_id){_this.choiceDevicePayType(device,tariff_id)});if(dvs.isSender()){hasOptionDevices=true}});if(!hasOptionDevices){var $subSection=$("#optional-equipment").parent(),$header=$subSection.prev();$subSection.remove();$header.remove()}_.each(_this.all_subscriptions,function(sub){$("#iptv-4").append(sub.render().el);sub.el.on("choice",function(e,option){_this.choiceOption(e,option)})});if(_this.all_phones.length>0){var _html="";var isSelected=false;for(var phone in _this.all_phones){if(mrf.isUral(app.wi.cart.reg_id)){if(app.wi.cart.tariff.title.indexOf("Максимальный")>=0&&_this.all_phones[phone].title.indexOf("Абонентский")<0||app.wi.cart.tariff.title.indexOf("Оптимальный")>=0&&_this.all_phones[phone].title.indexOf("Повременный")<0){continue}}_html+='<option value="'+_this.all_phones[phone].id+'">'+_this.all_phones[phone].title+"</option>";if(!isSelected){_this.all_phones[phone].selected=true;isSelected=true}}$("#phoneSelect").html(_html);var comment1="";var comment2="";var Info={info39:null,info43:null,info44:null,info45:null,info46:null};for(var ii=0;ii<_this.all_phones[0].info.length;ii++){var __info=_this.all_phones[0].info[ii];if(typeof __info.optCostId!="undefined"){Info["info"+__info.type]=parseInt(__info.value)}}if(Info.info45){comment1="(включая "+(typeof Info.info45=="number"?Math.round(Info.info45/100):"")+" руб./мес. за предоставление абонентской линии)<br/>"}if(Info.info46){comment2+="Стоимость 1 минуты соединения<br/>";comment2+="&#8212; "+utils.parseFee(Info.info44)+" руб./мин. (с 08:00 до 22:00)<br/>";comment2+="&#8212; "+utils.parseFee(Info.info46)+" руб./мин. (с 22:00 до 08:00)<br/>"}else{if(Info.info43){if(parseInt(Info.info43)!=0){comment2+=Info.info43+" минут включено в тариф"}if(Info.info44&&!isNaN(Info.info43)){if(comment2.length>0){comment2+=", "}comment2+=""+(typeof Info.info44=="number"?utils.parseFee(Info.info44):"")+" руб./мин. с "+(parseInt(Info.info43)+1)+" минуты"}comment2+="."}}if(mrf.isUral(app.wi.cart.reg_id)){comment2+=" неограниченное количество минут включено в тариф"}var selectedId=$("#phoneSelect").val();if(mrf.isSouth(adrMgr.selectedRegion.klRegion)){for(var t=0;t<app.wi.cart.all_phones.length;t++){if(app.wi.cart.all_phones[t].id==selectedId&&app.wi.cart.all_phones[t].title.indexOf("Абонентский")>=0){comment2+="неограниченное количество минут включено в тариф."}}}$("#phoneDesc").html(comment1+comment2)}construct.resetHeight();if(_this.all_phones.length>0){window.construct.initPhoneSelector()}_this.rendered=false;_this.render()}};this.getBasicPackagesNames=function(){var names=[""];if(this.plan.hasIptv){names=_.map(_.filter(this.data.services.iptv.choice_packages,function(pkg){return pkg.packgeType==26}),function(pkg){return"«"+pkg.title+"»"})}if(names.length==1){return names[0]}else{return names.join(", ")}};this.render=function(){var _this=this;if(_this.renderTOut!=null){clearTimeout(_this.renderTOut)}_this.renderTOut=setTimeout(function(){_this.renderCart()},100)};this.renderCart=function(){try{var iptv_cinemaIdx=0;var iptv_popularIdx=0;for(var i=0;i<this.packages.length;i++){if(this.packages[i].altName=="iptv_cinema"){iptv_cinemaIdx=i}if(this.packages[i].altName=="iptv_popular"){iptv_popularIdx=i}}var cinemaIds=[];var popularIds=[];for(var iii=0;iii<this.packages[iptv_popularIdx].channels.length;iii++){popularIds.push(this.packages[iptv_popularIdx].channels[iii].id)}for(var iii=0;iii<this.packages[iptv_cinemaIdx].channels.length;iii++){cinemaIds.push(this.packages[iptv_cinemaIdx].channels[iii].id)}$("#info_channel_count").html(_.union(cinemaIds,popularIds).length)}catch(error){}var _this=this;if(_this.rendered==false){if(_this.plan){var isCorrectPrice=false;var correctPriceTag=0;if(typeof _this.plan.isCorrectPrice!=="undefined"&&_this.plan.isCorrectPrice){isCorrectPrice=true;correctPriceTag=_this.plan.correctPriceTag}_this.data.afterFee=0;_this.data.fee=0;_this.data.cost=0;_this.data.discount=0;_.each(_this.plan.tariffs,function(trf){if(trf.id==_this.tariff_id){if(typeof trf.services!=="undefined"){if(typeof trf.services.iptv!=="undefined"){_this.has_iptv=true}if(typeof trf.services.shpd!=="undefined"){_this.has_shpd=true}}}});_this.data.services_count=0;if(typeof _this.tariff!=="undefined"&&_this.tariff!=null&&typeof _this.tariff.services!=="undefined"){_this.data.services=_this.tariff.services;_.each(_this.data.services,function(srv){_this.data.services_count++})}_this.enb_options_aliases=[];_this.enb_packages_aliases=[];_this.enb_choices_aliases=[];_this.enb_subs_aliases=[];if(_this.has_iptv&&_this.has_shpd){_this.data.show_mode="packet";_this.data.title=_this.plan.data.title}else{_this.data.show_mode="basic"}_.each(_this.data.services,function(srv,idx){if(srv!=null){_.each(srv.options,function(opt){_this.enb_options_aliases.push(opt.altName)});if(typeof srv.packages!=="undefined"){_.each(srv.packages.packages,function(opt){_this.enb_packages_aliases.push(opt.altName)})}if(typeof srv.choices!=="undefined"){_.each(srv.choices,function(opt){_this.enb_choices_aliases.push(opt.name);if(_this.enb_options_aliases.indexOf(opt.name)!==-1||(opt.name=="safe_internet"&&_this.enb_options_aliases.indexOf("safe_internet_base")!==-1)){if(opt.name=="safe_internet"&&_this.enb_options_aliases.indexOf("safe_internet_base")!==-1){_this.enb_options_aliases=_.without(_this.enb_options_aliases,"safe_internet_base")}else{_this.enb_options_aliases=_.without(_this.enb_options_aliases,opt.name)}}})}if(typeof srv.subsPack!=="undefined"&&srv.subsPack.subscriptions!=="undefined"){_.each(srv.subsPack.subscriptions,function(opt){_this.enb_subs_aliases.push(opt.id)})}srv.choice_options=[];srv.choice_packages=[];srv.choice_choices=[];srv.choice_devices=[];srv.choice_subscriptions=[];srv.discount=0;srv.options_length=0;srv.show_fee=0;srv.calc_fee=0;srv.calc_fee_after=0;srv.calc_cost=0;srv.show_service_fee=(_this.data.services_count==1);if(srv.type=="shpd"){if(adrMgr.selectedRegion.klRegion==50&&_this.tag_id==312){var pstn=$("#phoneSelect").val();switch(pstn){case"178292":srv.fee=18400;srv.afterFee=31700;break;case"178291":srv.fee=20900;srv.afterFee=33000;break;case"178288":srv.fee=18500;srv.afterFee=34500;break;case"178289":srv.fee=18500;srv.afterFee=31700;break;case"178286":srv.fee=24400;srv.afterFee=52700;break;case"178287":srv.fee=23400;srv.afterFee=56500;break;case"178290":srv.fee=21400;srv.afterFee=48000;break;case"178285":srv.fee=23400;srv.afterFee=73000;break;case"178287":srv.fee=23400;srv.afterFee=56500;break;case"178288":srv.fee=18500;srv.afterFee=55500;break;case"178291":srv.fee=20900;srv.afterFee=48000;break;case"178292":srv.fee=18400;srv.afterFee=52700;break;case"178289":srv.fee=18500;srv.afterFee=55500;break;case"178290":srv.fee=21400;srv.afterFee=48000;break;case"178285":srv.fee=23400;srv.afterFee=73000;break;case"178286":srv.fee=24400;srv.afterFee=52700;break}}srv.calc_fee=(srv.fee/100);srv.show_fee=(srv.fee/100);if(srv.afterFee){srv.calc_fee_after=(srv.afterFee)}if(srv.cost){srv.calc_cost+=(srv.cost/100)}}_.each(srv.tariffs,function(trf,idx){if(trf.choice){srv.calc_fee=trf.fee;if(trf.afterFee){srv.calc_fee_after=(trf.afterFee)}if(trf.cost){srv.calc_cost+=trf.cost}}});_.each(_this.data.choice_options,function(opt,idx){if(opt.type==srv.type){srv.choice_options.push(opt)}});_.each(_this.data.choice_packages,function(opt,idx){if(opt.type==srv.type){srv.choice_packages.push(opt)}});_.each(_this.data.choice_choices,function(opt,idx){if(opt.type==srv.type){srv.choice_choices.push(opt)}});_.each(_this.data.choice_subscriptions,function(opt,idx){if(opt.type==srv.type){srv.choice_subscriptions.push(opt)}});srv.options_length=srv.choice_options.length+srv.choice_packages.length+srv.choice_choices.length+srv.choice_subscriptions.length;if(srv.type&&srv.type=="iptv"){var basic_option_idx=0;var basic_option_nx=0;var basic_channels=[];var prices=_this.prices.singlepay;var price=0;var price_nx=prices[1]/100;var pkg_fee=0;var price_after=0;srv.basic_pkg_names=_this.getBasicPackagesNames();srv.basic_pkg_fee=0;_this.data.basic_iptv_pkg=[];var choice_basic_pkg=[];_.each(srv.choice_packages,function(opt){opt.discount=0;if(opt.packgeType==26){choice_basic_pkg.push(opt.alias);basic_option_idx++;if(typeof opt.channels!=="undefined"){var mas=[];for(var i=0;i<opt.channels.length;i++){mas.push(opt.channels[i].id)}basic_channels=_.union(mas,basic_channels)}price=_this.prices.singlepay[basic_option_idx]/100;if(_this.prices.singlepay_after&&_this.prices.singlepay_after[basic_option_idx]){price_after=_this.prices.singlepay_after[basic_option_idx]}if(_this.mode=="doubleplay"&&!utils.isEmpty(_this.prices.discount_doubleplay)){price+=_this.prices.discount_doubleplay[basic_option_idx]/100;if(_this.prices.discount_doubleplay_after&&_this.prices.discount_doubleplay_after[basic_option_idx]){price_after+=_this.prices.discount_doubleplay_after[basic_option_idx]}}if(_this.mode=="tripleplay"&&!utils.isEmpty(_this.prices.discount_tripleplay)){price+=_this.prices.discount_tripleplay[basic_option_idx]/100;if(_this.prices.discount_tripleplay_after&&_this.prices.discount_tripleplay_after[basic_option_idx]){price_after+=_this.prices.discount_tripleplay_after[basic_option_idx]}opt.discount=(_this.prices.singlepay[basic_option_idx]/100)-price}opt.fee=price;opt.afterFee=price_after;_this.cache_pkg[opt.alias].el.find(".cost-rubmonth-2rows").html(opt.fee);_this.data.basic_iptv_pkg.push(_this.cache_pkg[opt.alias].data.title);pkg_fee+=price;srv.basic_pkg_fee+=price}});var basic_option_nx_idx=basic_option_idx+1;var price_nx=_this.prices.singlepay[basic_option_nx_idx]/100;var iptv_max_price=(typeof _this.cache_pkg.iptv_max!=="undefined")?_this.cache_pkg.iptv_max.data.fee:0;if(_this.mode=="doubleplay"){if(_this.prices.discount_doubleplay&&_this.prices.discount_doubleplay[basic_option_nx_idx]){price_nx+=_this.prices.discount_doubleplay[basic_option_nx_idx]/100}if(_this.discounts&&_this.discounts.discount_doubleplay[0].packageId=="iptv_max"){}}if(_this.mode=="tripleplay"){if(_this.prices.discount_tripleplay&&_this.prices.discount_tripleplay[basic_option_nx_idx]){price_nx+=_this.prices.discount_tripleplay[basic_option_nx_idx]/100}if(_this.discounts&&_this.discounts.discount_tripleplay[0].packageId=="iptv_max"){iptv_max_price+=_this.discounts.discount_tripleplay[0].fee/100}}_.each(_this.basic_iptv,function(alias){if($.inArray(alias,choice_basic_pkg)==-1){_this.cache_pkg[alias].el.find(".cost-rubmonth-2rows").html(price_nx)}if(_this.has_iptv_max){_this.cache_pkg[alias].el.find(".cost-rubmonth-2rows").hide()}else{_this.cache_pkg[alias].el.find(".cost-rubmonth-2rows").show()}});if(_this.has_iptv_max){_this.cache_pkg.iptv_adult.el.find(".cost-rubmonth-2rows").hide()}else{if(!!_this.cache_pkg.iptv_adult){_this.cache_pkg.iptv_adult.el.find(".cost-rubmonth-2rows").show()}}if(typeof _this.cache_pkg.iptv_max!=="undefined"){_this.cache_pkg.iptv_max.el.find(".cost-rubmonth-2rows").html(iptv_max_price)}if(_this.has_iptv_max){var iptv_max_data=_this.cache_pkg.iptv_max.data;basic_option_idx=_this.basic_iptv.length+1;basic_channels=iptv_max_data.channels;pkg_fee=iptv_max_data.fee;iptv_max_data.discount=0;if(_this.mode==="doubleplay"&&_this.prices.discount_doubleplay){}else{if(_this.mode==="tripleplay"&&_this.prices&&_this.prices.discount_tripleplay){iptv_max_data.discount=_this.discounts.discount_tripleplay[0].fee/100}}pkg_fee+=iptv_max_data.discount;srv.basic_pkg_names+=", «Взрослый»";srv.basic_pkg_fee=pkg_fee}$(".package-tvchannel__cost-n-pack").html(basic_option_idx);$(".package-tvchannel__total .r-18").html(_this.declOfNum(basic_option_idx,["пакет","пакета","пакетов"]));if(basic_channels.length){$(".package-tvchannel__cost-n-channel").html(basic_channels.length).show();$(".package-tvchannel__cost-n-channel-text").html(_this.declOfNum(basic_channels.length,["канал","канала","каналов"])).show()}else{$(".package-tvchannel__cost-n-channel").hide();$(".package-tvchannel__cost-n-channel-text").hide()}$(".package-tvchannel__cost-price").html(pkg_fee)}_.each(_this.data.choice_devices,function(dvs,idx){if(dvs.type==srv.type){if(typeof dvs.quantity!=="undefined"){if(dvs.fee!=null){srv.calc_fee+=dvs.fee*dvs.quantity;if(_this.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&dvs.alias==_this.device_ids.main&&dvs.fee==0){if(dvs.quantity==2){srv.calc_fee+=95}if(dvs.quantity==3){srv.calc_fee+=190}}if(typeof dvs.afterFee!=="undefined"){srv.calc_fee_after+=(dvs.afterFee*dvs.quantity)*100}else{srv.calc_fee_after+=(dvs.fee*dvs.quantity)*100}}if(dvs.cost!=null){srv.calc_cost+=dvs.cost*dvs.quantity}}srv.choice_devices.push(dvs)}})}});_.each(_this.data.services,function(srv,idx){if(srv!=null){srv.discount=0;_.each(srv.choice_options,function(opt,idx){if(typeof opt.fee!=="undefined"&&!isNaN(opt.fee)){srv.calc_fee+=parseInt(opt.fee);if(opt.afterFee){srv.calc_fee_after+=parseInt(opt.afterFee)}}if(typeof opt.discount!=="undefined"){srv.discount+=parseInt(opt.discount)}});_.each(srv.choice_choices,function(opt,idx){if(opt.current_tariff){if(typeof opt.current_tariff.fee!=="undefined"&&!isNaN(opt.current_tariff.fee)){srv.calc_fee+=parseInt(opt.current_tariff.fee);if(typeof opt.current_tariff.afterFee!=="undefined"&&!isNaN(opt.current_tariff.afterFee)){srv.calc_fee_after+=parseInt(opt.current_tariff.afterFee)}}}else{if(typeof opt.fee!=="undefined"&&!isNaN(opt.fee)){srv.calc_fee+=parseInt(opt.fee);if(typeof opt.afterFee!=="undefined"&&!isNaN(opt.afterFee)){srv.calc_fee_after+=parseInt(opt.afterFee)}}}if(typeof opt.discount!=="undefined"){srv.discount+=parseInt(opt.discount)}});_.each(srv.choice_subscriptions,function(opt,idx){srv.calc_fee+=parseInt(opt.fee);srv.calc_fee_after+=parseInt(opt.fee)*100;if(typeof opt.discount!=="undefined"){srv.discount+=parseInt(opt.discount)}});_.each(srv.choice_packages,function(opt,idx){opt.show_cart=true;opt["class"]="";if(_this.basic_iptv.indexOf(opt.alias)!=-1||opt.alias=="iptv_max"){opt.show_cart=false}if(_this.has_iptv_max&&["iptv_adult"].indexOf(opt.alias)!=-1){opt.show_cart=false}if(opt.alias=="iptv_hd"){opt["class"]="basket__data-row-item_color-orange"}if(_this.has_iptv_max&&(_this.basic_iptv.indexOf(opt.alias)!=-1||["iptv_adult"].indexOf(opt.alias)!=-1)){}else{if(typeof opt.fee!=="undefined"){srv.calc_fee+=parseInt(opt.fee);if(opt.afterFee){srv.calc_fee_after+=parseInt(opt.afterFee)}}if(typeof opt.discount!=="undefined"){srv.discount+=parseInt(opt.discount)}}});_this.data.fee+=srv.calc_fee;_this.data.afterFee+=srv.calc_fee_after;_this.data.cost+=srv.calc_cost;_this.data.discount+=srv.discount;if(_this.has_iptv_max){_this.data.discount=0}}});_this.dis_options_aliases=_.difference(_this.all_options_aliases,_.uniq(_this.enb_options_aliases));_this.dis_packages_aliases=_.difference(_this.all_packages_aliases,_.uniq(_this.enb_packages_aliases));_this.dis_choices_aliases=_.difference(_this.all_choices_aliases,_.uniq(_this.enb_choices_aliases));_this.dis_subs_aliases=_.difference(_this.all_subs_aliases,_.uniq(_this.enb_subs_aliases));_.each(_this.cache_opt,function(opt){if(_this.enb_options_aliases.indexOf(opt.alias)!==-1&&opt.is_visible==true){opt.el.show()}else{opt.el.hide()}});_.each(_this.cache_chs,function(opt){if(_this.enb_choices_aliases.indexOf(opt.alias)!==-1&&opt.is_visible==true){opt.el.show()}else{opt.el.hide()}});_.each(_this.enb_packages_aliases,function(alias){if(!isCorrectPrice){$("#tariff-package-"+alias).show()}});_.each(_this.dis_packages_aliases,function(alias){$("#tariff-package-"+alias).hide()});_.each(_this.enb_subs_aliases,function(alias){$("#tariff-subscription-"+alias).show()});_.each(_this.dis_subs_aliases,function(alias){$("#tariff-subscription-"+alias).hide()});if(_this.has_iptv){$(".p-section-iptv").show()}else{$(".p-section-iptv").hide()}if(_this.has_shpd){$(".p-section-shpd").show()}else{$(".p-section-shpd").hide()}if(_this.mode=="doubleplay"||_this.mode=="tripleplay"){$(".p-section-modeplay").show()}else{}_this.el.trigger("change_blocks");if(_this.plan.showMode=="iptv"){_this.plan.data.type="iptv";_this.data.show_mode="iptv";_this.data.services_count=1;var iptv=_this.data.services.iptv;_this.data.services={iptv:iptv};_this.data.fee=_this.data.services.iptv.calc_fee}var floatBasketEl=$("#float-basket");if(typeof _this.plan.data!=="undefined"){$(".config-choise-mini__discount-txt .cost-rubmonth").html(_this.data.discount);for(var t in _this.all_phones){var selectedPhoneId=$("#phoneSelect").val();if(_this.all_phones[t].id==selectedPhoneId){_this.data.fee+=_this.all_phones[t].fee/100;_this.data.cost+=_this.all_phones[t].cost/100;_this.data.choice_phone=[];_this.data.choice_phone.push(_this.all_phones[t])}}if(_this.has_iptv_max){_this.data.fee+=(_this.cache_pkg.iptv_max.data.discount||0)}floatBasketEl.find(".cost-rubmon").html(_this.data.fee);$("#float-basket").setMod("visible")}}if(_this.tag_id==312){_this.tpl=new TemplateClass("/tpls/tariff_cart_triple_total2.hbs");var total={};total.mainBlock=[];total.addBlock={};total.totalBlock=[];var iptvText="Пакеты телеканалов: "+_this.getBasicPackagesNames();total.mainBlock.push(iptvText);var shpdText="Домашний Интернет: тариф «Максимальный»";if(_this.data.services.shpd.title.toLowerCase().indexOf("оптимальный")>=0){shpdText="Домашний Интернет: тариф «Оптимальный»"}total.mainBlock.push(shpdText);var pstnText="Домашний телефон: тариф ";var pstnFee=0;var pstnFeeAfter=0;var selectedId=$("#phoneSelect").val();for(var t in _this.data.services.pstn){if(_this.data.services.pstn[t].id==selectedId){pstnText+="«"+_this.data.services.pstn[t].title+"»";pstnFee=_this.data.services.pstn[t].fee/100;if(_this.data.services.pstn[t].afterFee){_this.data.afterFee+=_this.data.services.pstn[t].afterFee}break}}total.mainBlock.push(pstnText);total.addBlock.shpd=[];for(var o in _this.data.services.shpd.choice_options){var el={title:"",fee:0};el.title=_this.data.services.shpd.choice_options[o].title;el.fee=_this.data.services.shpd.choice_options[o].fee;if(this.data.services.shpd.choice_options[o].alias=="wi_fi_router"){el.action=true;el.title="Wi-Fi роутер/модем по акции «Выгодное оборудование»"}total.addBlock.shpd.push(el)}for(var o in _this.data.services.shpd.choice_choices){var el={title:"",fee:0};el.title=_this.data.services.shpd.choice_choices[o].title;el.fee=_this.data.services.shpd.choice_choices[o].fee;total.addBlock.shpd.push(el)}var cnt=0;var packTitle=[];total.addBlock.iptvPack=[];total.addBlock.iptvServ=[];total.addBlock.iptvDev=[];total.addBlock.iptvSubs=[];for(var t in _this.data.services.iptv.choice_packages){if(_this.data.services.iptv.choice_packages[t].packgeType==26){cnt++;packTitle.push(_this.data.services.iptv.choice_packages[t].title)}}var feeIptvMain=0;for(i=1;i<=cnt;i++){var p=_this.prices.singlepay[i]/100;if(this.prices.discount_doubleplay){if(this.i_have_shpd&&this.i_have_phone){p+=this.prices.discount_tripleplay[i]/100}else{if(this.i_have_shpd||this.i_have_phone){p+=this.prices.discount_doubleplay[i]/100}}}feeIptvMain+=p}for(var t in _this.data.services.iptv.choice_packages){var el={title:"",fee:0};if(_this.data.services.iptv.choice_packages[t].packgeType==27){el.title=_this.data.services.iptv.choice_packages[t].title;el.fee=_this.data.services.iptv.choice_packages[t].fee;if(_this.data.services.iptv.choice_packages[t].fee==0&&_this.data.services.iptv.choice_packages[t].alias=="iptv_hd"){el.action=true;el.notes="(с 3-го месяца платеж составит 395 руб/мес.)";el.title="Пакет телеканалов «HD»"}total.addBlock.iptvPack.push(el)}}for(var t in _this.data.services.iptv.choice_options){var el={title:"",fee:0};el.title=_this.data.services.iptv.choice_options[t].title;el.fee=_this.data.services.iptv.choice_options[t].fee;total.addBlock.iptvPack.push(el)}for(var t in _this.data.services.iptv.choice_choices){var el={title:"",fee:0};el.title=this.data.services.iptv.choice_choices[t].title;el.fee=this.data.services.iptv.choice_choices[t].fee;total.addBlock.iptvServ.push(el)}for(var t in _this.data.services.iptv.choice_devices){var el={title:"",fee:0,count:1},choice_device=this.data.services.iptv.choice_devices[t];el.title=choice_device.title;el.count=choice_device.quantity;el.fee=choice_device.fee*el.count;el.cost=choice_device.cost*el.count;el.saleType=choice_device.saleType;el.saleComment=el.saleType=="SALE"?"покупка":(choice_device.current_tariff.saleSchemName||"").replace(/покупка /gi,"");if(_this.multiroom.stb_main_id==choice_device.alias&&typeof mrf!=="undefined"&&typeof adrMgr!=="undefined"){if(typeof adrMgr!=="undefined"&&typeof adrMgr.selectedCity!=="undefined"){if(choice_device.alias==_this.device_ids.main&&choice_device.saleType=="RENT"&&choice_device.isAction==true){el.action=true;el.title="ТВ-приставка «Стандарт» по акции «Выгодное оборудование»"}}}total.addBlock.iptvDev.push(el)}for(var t in _this.data.services.iptv.choice_subscriptions){var el={title:"",fee:0};el.title=this.data.services.iptv.choice_subscriptions[t].title;el.fee=this.data.services.iptv.choice_subscriptions[t].fee;total.addBlock.iptvSubs.push(el)}_this.data.totalTriple=total;_this.data.feeMainPack=0;_this.data.feeMainPack+=feeIptvMain;_this.data.feeMainPack+=_this.data.services.shpd.show_fee;_this.data.feeMainPack+=pstnFee;if(adrMgr.selectedRegion.klRegion==50){_this.data.feeMainPack=549}}_this.hideEmptySections();_this.prepareCartData();_this.data.mouth3=0;_this.data.mouth4=parseInt(_this.data.afterFee/100);try{if($("#tariff-package-iptv_hd input[name=tariff-options]").is(":checked")){_this.data.mouth3=_this.data.fee+395;_this.data.mouth4+=395}}catch(error){}_this.data.show_mouth3=_this.data.mouth3>0;_this.data.discount=parseInt(_this.data.afterFee/100)-_this.data.fee;if(isCorrectPrice){_this.data.isCorrectPrice=true}if($.inArray(_this.tag_id,[237,338,339,340,341])>-1){_this.data.isCrazyDays=true}_this.el.html(_this.tpl.render(_this.data)).attr("id",_this.id).addClass(_this["class"]);$(".basket__data-item").each(function(){if(!$(this).find("div.basket__data-row").last().hasClass("basket__data-row_border-no")){$(this).find("div.basket__data-row").last().addClass("basket__data-row_border-no")}});if($("#afterFee").length){$("#afterFee").html(parseInt(_this.data.afterFee/100))}_this.rendered=true}if("0"==$("#tariff-choice-karaoke").find("span.cost-rubmonth-2rows").text()){$("#tariff-choice-karaoke").find(".config-choise__add-box").hide()}if("0"==$("#tariff-choice-iptv_multiroom").find("span.cost-rubmonth-2rows").text()){$("#tariff-choice-iptv_multiroom").find(".config-choise__add-box").hide()}};this.prepareCartData=function(){var _this=this;var isCorrectPrice=false;var correctPriceTag=0;if(typeof this.plan!=="undefined"){if(typeof this.plan.isCorrectPrice!=="undefined"&&this.plan.isCorrectPrice){isCorrectPrice=true;correctPriceTag=this.plan.correctPriceTag}}if(isCorrectPrice){var isWiFiChoice=false,isRentDevice=false;for(var opt in this.data.choice_options){if(this.data.choice_options[opt].altName=="wi_fi_router"){isWiFiChoice=true;break}}for(var dev in this.data.choice_devices){if(this.data.choice_devices[dev].alias==_this.device_ids.main&&this.data.choice_devices[dev].saleType=="RENT"&&this.data.choice_devices[dev].isAction==true){isRentDevice=true;break}}if(mrf.isUral(adrMgr.selectedRegion.klRegion)&&isWiFiChoice&&isRentDevice){this.data.fee-=2}}var floatBasketEl=$("#float-cart");var cartInfo={sectionInfo:{show:true,title:"Заголовок",ico:"service-ico-packet",rows:[]},sectionAdditional:{show:true,title:"Дополнительные услуги",rows:[]},sectionDiscount:{show:true,rows:[]},sectionTotal:{show:true,title:"Итого",fee:this.data.fee,rows:[]},floatCart:{title:"",fee:0},tvinFee:0};cartInfo.floatCart.fee=this.data.fee;if((this.data.afterFee/100)>this.data.fee){cartInfo.sectionTotal.afterFee=this.data.afterFee/100;var title="Ежемесячный платеж";if([237,338,339,340,341].indexOf(this.tag_id)!=-1){title+='<br><span class="notes-info-small">(с 3-го месяца платеж составит '+cartInfo.sectionTotal.afterFee+" руб/мес.)</span>"}cartInfo.sectionTotal.rows.push({title:title,fee:this.data.fee,action:true})}else{cartInfo.sectionTotal.rows.push({title:"Ежемесячный платеж",fee:this.data.fee})}cartInfo.sectionTotal.rows.push({title:"Единовременный платеж при подключении",fee:this.data.cost,type:"cost"});if(mrf.isDv(adrMgr.selectedRegion.klRegion)){var module={};for(var m in app.modules){if(app.modules[m].alias=="tariff_order"){module=app.modules[m]}}if(module.options.isAction){cartInfo.sectionTotal.rows.push({title:"Ваша экономия по акции",fee:this.data.afterFee/100-this.data.fee,action:true})}}var packagesSection=cartInfo.sectionInfo;var optionsSection=cartInfo.sectionInfo;var devicesSection=cartInfo.sectionAdditional;if(this.plan.hasIptv&&this.plan.hasShpd&&this.plan.hasPhone){cartInfo.sectionInfo.title="Комплект 3 в 1";cartInfo.sectionDiscount.rows.push({title:"Покупая «Комплект 3 в 1», вы экономите",fee:99});cartInfo.floatCart.title="Комплект 3 в 1";packagesSection=cartInfo.sectionAdditional;optionsSection=cartInfo.sectionAdditional}else{if(this.plan.hasIptv&&this.plan.hasShpd){cartInfo.sectionInfo.title="Пакет «"+this.getTariffTitle(this.tariff)+"»";cartInfo.floatCart.title="Пакет «"+this.getTariffTitle(this.tariff)+"»";if(isCorrectPrice){var showPackCnt=1;switch(this.plan.correctPriceTag){case 329:case 330:break;case 331:showPackCnt=2;break;case 332:showPackCnt=3;break}cartInfo.sectionInfo.title="Верная цена "+showPackCnt;cartInfo.floatCart.title="Верная цена "+showPackCnt}if(mrf.isSouth(adrMgr.selectedCity.klRegion)){cartInfo.sectionInfo.title="Пакет «Домашний Интернет +ТВ»";cartInfo.floatCart.title="Пакет «Домашний Интернет +ТВ»"}if([223,224].indexOf(this.tag_id)!==-1){cartInfo.sectionInfo.title="Пакет «"+this.getTariffTitle(this.tariff,true)+"»";cartInfo.floatCart.title="Пакет «"+this.getTariffTitle(this.tariff,true)+"»"}cartInfo.sectionDiscount.show=false;if(cartInfo.sectionTotal.afterFee>cartInfo.sectionTotal.fee){cartInfo.sectionInfo.action=true}}else{if(this.plan.hasIptv){cartInfo.sectionInfo.ico="service-ico-hometv";cartInfo.sectionInfo.title="Интерактивное ТВ";cartInfo.floatCart.title="Интерактивное ТВ";cartInfo.sectionDiscount.show=false;devicesSection=cartInfo.sectionInfo}else{if(this.plan.hasShpd){var tariffTitle=this.getTariffTitle(this.tariff);cartInfo.sectionInfo.ico="service-ico-homeinet";cartInfo.sectionInfo.title="Домашний Интернет";cartInfo.sectionAdditional.show=false;cartInfo.sectionDiscount.show=false}}}}if(this.plan.hasShpd){var tariffTitle=this.getTariffTitle(this.tariff);if(isCorrectPrice){tariffTitle="Домашний Интернет"}if(this.plan.tariffs[0].speed!=="undefined"){if(!this.plan.hasIptv){cartInfo.floatCart.title="Интернет до "+(this.plan.tariffs[0].speed/1024)+" Мбит/сек."}if(this.plan.tariffs[0].speed<1024){tariffTitle+=" до "+this.plan.tariffs[0].speed+" Кбит/сек."}else{tariffTitle+=" до "+(this.plan.tariffs[0].speed/1024)+" Мбит/сек."}}if(this.plan.tariffs[0].techId!=="undefined"){var isTwoTypeTech=false;if(this.plan.tariffs[0].technology.indexOf(1)>=1&&this.plan.tariffs[0].technology.length>1){isTwoTypeTech=true}if(this.plan.tariffs[0].techId==1){tariffTitle+=" по телефонной линии (технология ADSL)"}else{tariffTitle+=" по "+(isTwoTypeTech?"телефонной или выделенной":"выделенной")+" линии ("+this.plan.tariffs[0].techComment+")"}}cartInfo.sectionInfo.rows.push({title:tariffTitle,fee:this.data.services.shpd.show_fee});cartInfo.tvinFee+=this.data.services.shpd.show_fee;_.each(this.data.services.shpd.choice_options,function(opt){if(opt.alias=="wi_fi_router"){if(!mrf.isUral(adrMgr.selectedRegion.klRegion)){cartInfo.sectionAdditional.rows.push({title:"Wi-Fi роутер/модем по акции «Выгодное оборудование»",fee:opt.fee,action:true})}}else{cartInfo.sectionAdditional.rows.push({title:opt.title,fee:opt.fee})}});_.each(this.data.services.shpd.choice_choices,function(opt){cartInfo.sectionAdditional.rows.push({title:opt.title,fee:opt.fee})})}if(this.plan.hasIptv){if(this.has_iptv_max){cartInfo.tvinFee+=this.cache_pkg.iptv_max.data.fee;if(this.mode=="tripleplay"){cartInfo.tvinFee+=this.discounts.discount_tripleplay[0].fee/100}else{if(this.mode=="doubleplay"){}}}else{var cnt=0;for(var t in this.data.services.iptv.choice_packages){if(this.data.services.iptv.choice_packages[t].packgeType==26){cnt++}}for(var i=1;i<=cnt;i++){var p=this.prices.singlepay[i]/100;if(this.prices.discount_doubleplay){if(this.i_have_shpd&&this.i_have_phone){p+=this.prices.discount_tripleplay[i]/100}else{if(this.i_have_shpd||this.i_have_phone){p+=this.prices.discount_doubleplay[i]/100}else{if(this.mode=="doubleplay"){p+=this.prices.discount_doubleplay[i]/100}else{if(this.mode=="tripleplay"){p+=this.prices.discount_tripleplay[i]/100}}}}}cartInfo.tvinFee+=p}}packagesSection.rows.push({title:"Пакеты телеканалов: "+this.data.services.iptv.basic_pkg_names,fee:this.data.services.iptv.basic_pkg_fee});_.each(this.data.services.iptv.choice_packages,function(opt){if(opt.show_cart){var packageInfo={title:"Пакет телеканалов «"+opt.title+"»",fee:opt.fee};if(opt.fee==0&&opt.alias=="iptv_hd"){packageInfo.action=true;packageInfo.notes="(с 3-го месяца платеж составит 395 руб/мес.)"}cartInfo.sectionAdditional.rows.push(packageInfo)}});_.each(this.data.services.iptv.choice_options,function(opt){var optionInfo={title:opt.title,fee:opt.fee};if(opt.fee==0){}cartInfo.sectionAdditional.rows.push(optionInfo)});_.each(this.data.services.iptv.choice_choices,function(opt){cartInfo.sectionAdditional.rows.push({title:opt.title,fee:opt.fee})});_.each(this.data.services.iptv.choice_subscriptions,function(opt){cartInfo.sectionAdditional.rows.push({title:"Подписка «"+opt.title+"»",fee:opt.fee})});_.each(this.data.services.iptv.choice_devices,function(dvs){if(!(dvs.saleType=="RENT"&&mrf.isUral(adrMgr.selectedRegion.klRegion))){var deviceTitle=dvs.title.replace("Приставка","ТВ-приставка");var deviceQ=(dvs.quantity!=1)?" × "+dvs.quantity:"";var deviceS=dvs.current_tariff.saleSchemName.toLowerCase().replace("покупка в рассрочку","в рассрочку").replace("месяца","мес.").replace("месяцев","мес.");var deviceInfo={title:deviceTitle+" "+deviceS+deviceQ,fee:dvs.fee*dvs.quantity};if(dvs.saleType=="SALE"){deviceInfo.fee=dvs.cost*dvs.quantity}if(app.wi.cart.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&dvs.alias==_this.device_ids.main&&dvs.fee==0){if(dvs.quantity==2){deviceInfo.fee+=95}if(dvs.quantity==3){deviceInfo.fee+=190}}if(dvs.saleType=="SALE"){deviceInfo.type="cost"}else{if(dvs.fee==0){if(typeof dvs.notes!=="undefined"){deviceInfo.action=true;deviceInfo.notes=dvs.notes.replace(/(.+)\. С/g,"(с")+")"}}}if(dvs.saleType=="RENT"&&dvs.isAction==true){deviceInfo.action=true;deviceInfo.title="ТВ-приставка «Стандарт» по акции «Выгодное оборудование»"}deviceInfo.isDevice=true;devicesSection.rows.push(deviceInfo)}})}if(this.plan.hasPhone){var pstnInfo={title:"Домашний телефон: тариф ",fee:0};var selectedId=$("#phoneSelect").val();for(var t in this.data.services.pstn){if(this.data.services.pstn[t].id==selectedId){pstnInfo.title+="«"+this.data.services.pstn[t].title+"»";pstnInfo.fee=this.data.services.pstn[t].fee;break}}cartInfo.sectionInfo.rows.push(pstnInfo)}if(cartInfo.sectionTotal.afterFee>cartInfo.tvinFee){cartInfo.sectionTotal.economy=cartInfo.sectionTotal.afterFee-cartInfo.sectionTotal.fee;cartInfo.sectionTotal.showEconomy=true;if(this.tag_id==286){cartInfo.sectionTotal.showEconomy=false}}cartInfo.sectionAdditional.show=(cartInfo.sectionAdditional.rows.length==0)?false:true;this.data.cartInfo=cartInfo;floatBasketEl.find(".float-basket__data").html(cartInfo.floatCart.title);floatBasketEl.find(".cost-rubmon").html(cartInfo.floatCart.fee)};this.hideEmptySections=function(){if($("#internet-1 section:visible").length==0){$("#internet-1").parents(".p-section-shpd").hide()}else{$("#internet-1").parents(".p-section-shpd").show()}if($("#iptv-3 section:visible").length==0){$("#iptv-3").parents(".p-section-shpd").hide()}else{$("#iptv-3").parents(".p-section-shpd").show()}if(this.plan.options.tag_id==141){$("#internet-1").parents(".p-section-shpd").hide();$("#iptv-3").parents(".p-section-shpd").hide()}};this.getTariffTitle=function(tariff,_short){var tariffTitlesByTag={218:"Домашний Интернет «Fast»",219:"Домашний Интернет",223:"Домашний Интернет Fast",224:"Домашний Интернет",329:"Верный",330:"Верный",331:"Верный",332:"Верный"};var tariffTitlesByTagPkg={223:"Домашний Интернет Fast",224:"Домашний Интернет"};var tariffTitlesByTagShort={223:"ТвИн Fast",224:"ТвИн"};if(mrf.isSouth(adrMgr.selectedRegion.klRegion)){tariffTitlesByTagShort={223:"Интернет+ТВ",224:"Интернет+ТВ"}}if(mrf.isVt(adrMgr.selectedRegion.klRegion)){tariffTitlesByTagShort={223:"Быстрый ТвИн",224:"Простой ТвИн"}}var result=tariff.title;var titles=tariff.inPkg?tariffTitlesByTagPkg:tariffTitlesByTag;titles=!utils.isEmpty(_short)?tariffTitlesByTagShort:titles;for(var tagIdx in tariff.tags){if(titles[tariff.tags[tagIdx].id]){result=titles[tariff.tags[tagIdx].id]}}return result};return this}})();