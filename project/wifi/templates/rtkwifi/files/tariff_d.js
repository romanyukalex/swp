(function(){TariffDevice=function(options){this.id="tariff-device";this.alias="";this["class"]="";this.data={current_tariff_id:null,quantity:1,fee:null,cost:null};this.el=$("<div></div>");this.defaults={};this.settings={};this.tpl_path="/tpls/tariff_device.hbs";this.tpl={};this.trigger_on=true;this.enableD=false;this.enableP=true;this.enableM=true;this.types={main:"iptv_device_standard",premium:"iptv_device_premium",sender:"iptv_videosender"};if(typeof options!=="undefined"){this.settings=$.extend(this.defaults,options);this.id=this.settings.id;this.alias=this.settings.alias;this["class"]=this.settings["class"];this.data=this.settings.data;if(typeof options.tpl!=="undefined"){this.tpl=options.tpl}else{this.tpl=new TemplateClass(this.tpl_path);this.tpl.load()}}this.render=function(){var _this=this;this.data.label=this.data.title;_.each(this.data.prices,function(price){if(typeof price["default"]!=="undefined"&&price["default"]==true){_this.data.fee=price.fee;_this.data.cost=price.cost;_this.data.saleType=price.saleType}});if(typeof adrMgr!=="undefined"){if(!mrf.isVt(adrMgr.selectedCity.klRegion)&&this.data.alias==this.types.main){this.data.oneStar=true}if(mrf.isUral(adrMgr.selectedCity.klRegion)&&this.data.alias!=this.types.main){this.data.twoStar=true}if(mrf.isUral(adrMgr.selectedCity.klRegion)){this.data.isUral=true}else{this.data.isUral=false}if(mrf.isSouth(adrMgr.selectedCity.klRegion)){this.data.isSouth=true}else{this.data.isSouth=false}if(mrf.isSibir(adrMgr.selectedCity.klRegion)&&adrMgr.selectedCity.klRegion!="42"){this.data.isSibirWithOutKemerovo=true}else{this.data.isSibirWithOutKemerovo=false}if(mrf.isSibir(adrMgr.selectedCity.klRegion)&&adrMgr.selectedCity.klRegion!="17"){this.data.isSibirWithOutTuva=true}else{this.data.isSibirWithOutTuva=false}}this.el.html(this.tpl.render(this.data)).attr("id",this.id).addClass(this["class"]);this.binds();return this};this.enable=function(trigger){var _this=this;_this.enableD=true;if(typeof trigger!=="undefined"&&trigger==false){_this.trigger_on=false;this.el.find("input.unit-equipment__switch").iCheck("check");_this.trigger_on=true}else{this.el.find("input.unit-equipment__switch").iCheck("check")}};this.disable=function(trigger){var _this=this;_this.setQuantity(1);_this.enablePlus();_this.enableMinus();_this.enableD=false;this.el.find("input.unit-equipment__switch").iCheck("uncheck")};this.disableCheck=function(){this.el.find("input.unit-equipment__switch").iCheck("disable")};this.enableCheck=function(){this.el.find("input.unit-equipment__switch").iCheck("enable")};this.getQuantity=function(){return this.data.quantity};this.setQuantity=function(q){q=(q>0)?q:1;this.data.quantity=q;var totalFee=0;if(typeof this.data.current_tariff!=="undefined"){if(this.data.current_tariff.saleType=="SALE"){totalFee=this.data.cost*this.data.quantity;this.el.find(".unit-equipment__price span").html(totalFee).addClass("cost-rub")}else{totalFee=this.data.fee*this.data.quantity;if(app.wi.cart.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&this.data.alias=="iptv_device_standard"&&this.data.fee==0){if(this.data.quantity==2){totalFee+=95}if(this.data.quantity==3){totalFee+=190}}this.el.find(".unit-equipment__price span").html(totalFee).removeClass("cost-rub")}}this.el.find(".unit-equipment__number").html(this.data.quantity)};this.isEnable=function(){return this.enableD};this.isStb=function(){return([this.types.main,this.types.premium].indexOf(this.data.alias)!==-1)?true:false};this.isSender=function(){return(this.types.sender==this.data.alias)?true:false};this.isPremiumStb=function(){return(this.types.premium==this.data.alias)?true:false};this.disablePlus=function(){this.enableP=false;this.el.find(".unit-equipment__btn_plus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive")};this.disableMinus=function(){this.enableM=false;this.el.find(".unit-equipment__btn_minus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive")};this.enablePlus=function(){this.enableP=true;if(this.enableD){this.el.find(".unit-equipment__btn_plus").addClass("unit-equipment__btn_active").removeClass("unit-equipment__btn_passive")}};this.enableMinus=function(){this.enableM=true;if(this.enableD){this.el.find(".unit-equipment__btn_minus").addClass("unit-equipment__btn_active").removeClass("unit-equipment__btn_passive")}};this.binds=function(){var _this=this;this.el.find(".js-selectric2").selectric({customClass:{prefix:"selectric2",postfixes:"Input Items Open Disabled TempShow HideSelect Wrapper Hover Responsive",camelCase:false}}).change(function(e){var price_id=parseInt($(e.currentTarget).val());if(isNaN(price_id)){price_id=0}_.each(_this.data.prices,function(price){if(price.id==price_id){_this.data.current_tariff=price}});if(_this.data.current_tariff){_this.data.saleType=_this.data.current_tariff.saleType;_this.data.isAction=_this.data.current_tariff.isAction;if(_this.data.current_tariff.saleType=="INSTALLMENTSALE"&&_this.data.current_tariff.fee==0){_this.el.find(".device-hint").show()}else{_this.el.find(".device-hint").hide()}_this.data.fee=_this.data.current_tariff.fee;_this.data.cost=_this.data.current_tariff.cost;if(_this.data.current_tariff.saleType=="SALE"){_this.el.find(".unit-equipment__price span").html(_this.data.cost*(_this.getQuantity()==0?1:_this.getQuantity())).addClass("cost-rub")}else{var totalFee=_this.data.fee;totalFee=totalFee*(_this.getQuantity()==0?1:_this.getQuantity());if(app.wi.cart.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&_this.data.alias=="iptv_device_standard"&&_this.data.fee==0){if(_this.data.quantity==2){totalFee+=95}if(_this.data.quantity==3){totalFee+=190}}_this.el.find(".unit-equipment__price span").html(totalFee).removeClass("cost-rub");_this.data.afterFee=_this.data.current_tariff.afterFee}}_this.el.trigger("choice_tariff",[_this,price_id])}).val(0).selectric("refresh").trigger("change");this.el.find("input.unit-equipment__switch").on("ifChanged",function(e){var inp_sw=$(e.currentTarget);var el_cnt=inp_sw.parents(".unit-equipment.unit-content");_this.enableD=inp_sw.is(":checked");_this.setQuantity(1);if(_this.enableD){el_cnt.removeClass("unit-equipment_passive").addClass("unit-equipment_active");if(_this.enableM){el_cnt.find(".unit-equipment__btn_minus").removeClass("unit-equipment__btn_passive").addClass("unit-equipment__btn_active")}if(_this.enableP){el_cnt.find(".unit-equipment__btn_plus").removeClass("unit-equipment__btn_passive").addClass("unit-equipment__btn_active")}}else{el_cnt.removeClass("unit-equipment_active").addClass("unit-equipment_passive");el_cnt.find(".unit-equipment__btn_minus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive");el_cnt.find(".unit-equipment__btn_plus").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive")}if(typeof _this.data.current_tariff==="undefined"){var price_id=parseInt(_this.el.find("select.js-selectric2").val());_.each(_this.data.prices,function(price){if(price.id==price_id){_this.data.current_tariff=price}})}if(_this.trigger_on){_this.el.trigger("choice",_this)}});var equipmentUnutClass="unit-equipment",equipmentSwitchClass="unit-equipment__switch",equipmentSwitch=$("#unit-equipment__switch0, #unit-equipment__switch1, #unit-equipment__switch2"),equipmentUnutBtnPlusClass="unit-equipment__btn_plus",equipmentUnutBtnMinusClass="unit-equipment__btn_minus",equipmentUnutBtnNumberClass="unit-equipment__number",equipmentUnut=this.el.find("."+equipmentUnutClass),equipmentUnutBtnPlus=this.el.find("."+equipmentUnutBtnPlusClass),equipmentUnutBtnMinus=this.el.find("."+equipmentUnutBtnMinusClass),equipmentUnutBtnNumber=this.el.find("."+equipmentUnutBtnNumberClass);equipmentUnutBtnPlus.on("click",function(event){event.stopPropagation();var parent=$(this).parents("."+equipmentUnutClass);if(_this.enableP&&_this.enableD){if(!parent.find("input."+equipmentSwitchClass).prop("checked")){parent.find("."+equipmentSwitchClass).iCheck("check");parent.find("."+equipmentSwitchClass).iCheck("check")}parent.find("."+equipmentUnutBtnNumberClass).text(function(i,v){if(_this.alias==_this.types.main&&_this.data.saleType=="RENT"&&_this.data.isAction==true){utils.Message('<div style="max-width: 350px;"><p class="content-p-0 r-12">В рамках акции Выгодное оборудование предоставляется только 1 ТВ-приставка.</p></div>',"","Внимание",function(){});return}var q=(+v)+1;q=(q<=3)?q:3;if(_this.alias==_this.types.sender&&q>app.wi.cart.multiroom.stb_dvc){_this.el.trigger("choice",_this);return}_this.setQuantity(q);_this.el.trigger("choice",_this);if(_this.alias==_this.types.premium&&q==3){if(!!app.wi.cart.cache_opt.wi_fi_router){app.wi.cart.cache_dev[_this.types.main].disable();app.wi.cart.cache_opt.wi_fi_router.disable()}}if(_this.data.saleType=="SALE"){$(this).parent().find(".unit-equipment__price span").text(_this.cost*q)}else{var totalFee=_this.fee*q;if(app.wi.cart.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&_this.data.alias=="iptv_device_standard"&&_this.data.fee==0){if(_this.data.quantity==2){totalFee+=95}if(_this.data.quantity==3){totalFee+=190}}$(this).parent().find(".unit-equipment__price span").text(totalFee)}return q})}});equipmentUnutBtnMinus.on("click",function(event){event.stopPropagation();var parent=$(this).parents("."+equipmentUnutClass);if(_this.enableM&&_this.enableD){parent.find("."+equipmentUnutBtnNumberClass).text(function(i,v){if(v==1){_this.setQuantity(1);parent.find("."+equipmentSwitchClass).iCheck("uncheck");_this.el.trigger("choice",_this)}else{var q=(+v)-1;q=(q>0)?q:1;_this.setQuantity(q);_this.el.trigger("choice",_this);if(_this.data.saleType=="SALE"){$(this).parent().find(".unit-equipment__price span").text(_this.cost*q)}else{var totalFee=_this.fee*q;if(app.wi.cart.tag_id==282&&adrMgr.selectedCity.klCode=="1800000100000_2"&&_this.data.alias=="iptv_device_standard"&&_this.data.fee==0){if(_this.data.quantity==2){totalFee+=95}if(_this.data.quantity==3){totalFee+=190}}$(this).parent().find(".unit-equipment__price span").text(totalFee)}}})}})};return this}}());