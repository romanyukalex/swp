(function(){TariffOption=function(options){this.id="tariff-option";this.alias="";this.mode="";this["class"]="";this.data={};this.el=$("<section></section>");this.defaults={};this.settings={};this.tpl_path="/tpls/tariff_plan.hbs";this.tpl={};this.is_visible=true;this.is_enable=true;this.enable_options=true;this.trigger_on=true;if(typeof options!=="undefined"){this.settings=$.extend(this.defaults,options);this.id=this.settings.id;this.mode=this.settings.mode;this.alias=this.settings.alias;this["class"]=this.settings["class"];this.data=this.settings.data;this.is_enable=(typeof options.is_enable!=="undefined")?options.is_enable:this.is_enable;this.is_visible=(typeof options.is_visible!=="undefined")?options.is_visible:this.is_visible;this.enable_options=(typeof options.enable_options!=="undefined")?options.enable_options:this.enable_options;if(typeof options.tpl!=="undefined"){this.tpl=options.tpl}else{this.tpl=new TemplateClass(this.tpl_path);this.tpl.load()}}this.declOfNum=function(number,titles){cases=[2,0,1,1,1,2];return titles[(number%100>4&&number%100<20)?2:cases[(number%10<5)?number%10:5]]};this.render=function(){var _this=this;this.data.label=this.data.title;if(this.alias=="iptv_netvork"){this.data.label="Управление просмотром"}this.data.is_enable=this.is_enable;this.data.is_visible=this.is_visible;this.data.enable_options=this.enable_options;this.data.isVolga=mrf.isVt(adrMgr.selectedRegion.klRegion);this.data.isUral=mrf.isUral(adrMgr.selectedRegion.klRegion);this.data.isNw=mrf.isNw(adrMgr.selectedRegion.klRegion);if(this.data.alias=="speed_night_x2"&&(mrf.isNw(adrMgr.selectedRegion.klRegion)||mrf.isSibir(adrMgr.selectedRegion.klRegion))){this.data.overrideDescr="Увеличьте существующую скорость доступа в Интернет на 10 Мбит/с в период с полуночи до 12 часов дня.";if(["47","78"].indexOf(adrMgr.selectedRegion.klRegion)>-1){this.data.overrideDescr="Скорость доступа в Интернет до 200 Мбит/с в период с полуночи до 8 часов утра."}if(mrf.isSibir(adrMgr.selectedRegion.klRegion)){this.data.overrideDescr="Увеличьте существующую скорость доступа в Интернет ночью"}}this.data.isOverrideDescr=!utils.isEmpty(this.data.overrideDescr);this.el.html(this.tpl.render(this.data)).attr("id",this.id).addClass(this["class"]).addClass("js-config-choise");this.binds();return this};this.renderChannels=function(channels){var _this=this;var p_el=_this.el.parents(".package-tvchannel__list");var ul=".config-choise__list-values";_this.data.channels=channels;_this.data.channels_label=_this.declOfNum(_this.data.channels.length,["Канал","Канала","Каналов"]);_this.el.find(".config-choise__additional-info-head_channels").html(_this.data.channels.length+" "+_this.data.channels_label);_this.el.find(ul).empty();var desc_container=(p_el.attr("id")=="iptv-1")?$("#tvchannel_desc_list"):$("#iptv-2-desc");_this.data.channels=_.sortBy(_this.data.channels,function(ch){return ch.channelId});var st=Math.round(_this.data.channels.length/3),nd=st,rem=_this.data.channels.length%3;if(rem>0){st++;if(rem==2){nd++}}var cnt=0;for(var i=0;i<_this.data.channels.length;i++){if(i==(st)){cnt++}if(i==(st+nd)){cnt++}$(_this.el.find(ul)[cnt]).append('<li data-desc="#channel-desc'+_this.data.channels[i].id+"_"+_this.alias+'">'+_this.data.channels[i].name+"</li>");if($("#channel-desc"+_this.data.channels[i].id).length==0){var div='<div class="item-desc js-item-desc" id="channel-desc'+_this.data.channels[i].id+"_"+_this.alias+'"><div class="item-desc__wrap"><div class="units-row"><div class="unit-66"><h1 class="content-head-24">'+this.data.channels[i].name+'</h1></div><div class="unit-33"><h1 class="content-head-24">&#8470; '+this.data.channels[i].channelId+'</h1></div></div><div class="tvchannel-info units-row"><div class="tvchannel-info__logo-wrap unit-33" data-link="//www.rt.ru/data/img/TVlogo/'+_this.data.channels[i].id+'.png" alt=""></div>';if(_this.data.channels[i].language){div+='<div class="unit-66"><p class="tvchannel-info__lang content-p-1">Язык вещания: <span class="tvchannel-info__lang-val">'+_this.data.channels[i].language+"</span></p></div>"}div+='</div><p class="content-p-0 content-p-0_last">'+_this.data.channels[i].description+"</p></div></div>";desc_container.append(div)}}_this.el.trigger("loadChannels",_this.alias)};this.isBasicPackage=function(){return(this.data.packgeType==26)?true:false};this.off=function(){this.el.find("input.config-choise__checkbox").iCheck("disable");this.el.find("div.config-choise__icon").addClass("config-choise__icon_choise-checked");this.el.find("label.config-choise__cost").removeClass("opt-unchecked");this.el.find("label.config-choise__cost").addClass("opt-checked")};this.on=function(){this.el.find("input.config-choise__checkbox").iCheck("enable");this.el.find("div.config-choise__icon").removeClass("config-choise__icon_choise-checked");this.el.find("label.config-choise__cost").removeClass("opt-checked");this.el.find("label.config-choise__cost").addClass("opt-unchecked")};this.setOption=function(idx){this.el.find("select.config-choise__sel").prop("selectedIndex",idx).selectric("refresh")};this.enable=function(trigger){if(typeof trigger!=="undefined"&&trigger==false){this.trigger_on=false;this.el.find("input.config-choise__checkbox").iCheck("check");this.trigger_on=true}else{this.el.find("input.config-choise__checkbox").iCheck("check")}this.el.find(".config-choise__cost").removeClass("opt-unchecked");this.el.find(".config-choise__sel").addClass("select-active")};this.disable=function(trigger){if(typeof trigger!=="undefined"&&trigger==false){this.trigger_on=false;this.el.find("div.config-choise__checkbox").iCheck("uncheck");this.el.find("input.config-choise__checkbox").prop("checked",false);this.trigger_on=true}else{this.el.find("div.config-choise__checkbox").iCheck("uncheck");this.el.find("input.config-choise__checkbox").prop("checked",false).trigger("change")}this.el.find(".config-choise__cost").addClass("opt-unchecked");this.el.find(".config-choise__sel").removeClass("select-active")};this.binds=function(){var _this=this;this.el.find(".config-choise__checkbox").on("ifChanged",function(el){if(_this.trigger_on){_this.el.trigger("choice",_this)}});this.el.find(".config-choise__list-values").on("mouseover","li",function(){var desc=$(this).data("desc");if(desc.size()){if(!$(desc).hasClass("is-loaded")){var $chan_info=$(desc).find(".tvchannel-info__logo-wrap");$chan_info.append($("<img/>").prop({src:$chan_info.data("link")}));$(desc).addClass("is-loaded")}$(desc).addClass("is-active").siblings().removeClass("is-active")}});this.el.find(".config-choise__list-values").on("mouseout","li",function(){$(this).parents("section").find(".js-item-desc-default").addClass("is-active").siblings().removeClass("is-active")});this.el.find(".js-selectric0").selectric({customClass:{prefix:"selectric0",postfixes:"Input Items Open Disabled TempShow HideSelect Wrapper Hover Responsive",camelCase:false}}).change(function(e){var id=parseInt($(e.currentTarget).val());_.each(_this.data.options,function(opt){if(opt.id==id){_this.data.current_tariff=opt}});if(_this.data.current_tariff){_this.el.find(".cost-rubmonth-2rows").html(_this.data.current_tariff.fee)}_this.el.trigger("choice_option",[_this,id])})};return this}})();