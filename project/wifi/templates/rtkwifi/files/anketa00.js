$(function(){var $form=$("#anketa");if($form.size()>0){function check(){var error=[];if($form.find('[name="homePhone"]').val()==""&&$form.find('[name="address"]').val()==""){error.push("необходимо указать номер домашнего телефона или адрес, по которому подключены услуги")}if($form.find('[name="male"]:checked').size()==0){error.push("необходимо указать пол")}if($form.find('[name="age"]:checked').size()==0){error.push("необходимо указать возраст")}if($form.find('[name="contactPhone"]').val()==""){error.push("необходимо указать контактный телефонт")}$form.find("select.mark").each(function(){if(utils.isEmpty($(this).val())){error.push("необходимо указать все оценки");return false}});$form.find(".question").each(function(){var $this=$(this),empty=false;if($this.is("select")){empty=utils.isEmpty($this.val())}else{var radio=$this.data("radio");if(radio){empty=($this.find('[name="'+radio+'"]:checked').size()==0)}}if(empty){error.push("необходимо ответить на все вопросы");return false}});if(error.length>0){utils.Notice(error.join("<br>"));return false}else{return true}}function clear(){$form.find('[name="homePhone"]').val("");$form.find('[name="address"]').val("");$form.find('[name="male"]').prop("checked",false);$form.find('[name="age"]').prop("checked",false);$form.find("select.mark, select.question").prop("selectedIndex",0).selectric("refresh");$form.find(".question").find('input[type="radio"]').prop("checked",false);$form.find('[name="contactPhone"]').val("");$form.find('[name="suggestion"]').val("")}var ERR_MSG="Произошла ошибка при отправке анкеты, попробуйте, пожалуйста, позже";$form.find("#send-anketa").click(function(){if(check()){var id=this.id,$this=$(this);if(!utils.buttonLoader(id)){return false}$.ajax({url:"/ajax/anketa/send",type:"POST",data:$form.serialize(),async:true,cache:false,dataType:"json",success:function(resp){if(resp.isError>0||!resp.result){utils.Error(ERR_MSG,"Ошибка")}else{utils.Notice("Большое спасибо, что согласились принять участие в нашем исследовании. <br> Мы очень ценим Ваше мнение!","Анкета отправлена");clear();utils.buttonUnLoader(id)}},error:function(e){utils.Error(ERR_MSG,"Ошибка");utils.log(e);utils.buttonUnLoader(id)}})}})}});