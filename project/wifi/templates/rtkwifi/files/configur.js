var configurators={CHANNEL_LABELS:["канал","канала","каналов"],PACKET_LABELS:["пакет","пакета","пакетов"]};configurators.IBasketSection=function(){var self={row_class:"basket__data-row",row_border_no_class:"basket__data-row_border-no",item_class:"basket__data-row-item",item_orange_class:"basket__data-row-item_color-orange"};self.createRow=function(text,rowClass,label){return'<div class="'+(rowClass||"")+'">'+(label?'<div class="basket__data-cost basket__data-cost_pos-topright">'+label+"</div>":"")+text+"</div>"};self.createItem=function(text){return'<p class="'+self.item_class+'">'+text+"</div>"};self.createRowItem=function(text,rowClass){return self.createRow(self.createItem(text),rowClass)};self.createOptionItem=function(info,prefix,withOutFee){prefix=prefix||info.prefix;var price=(info.isAction?info.actionFee:info.fee)*(info.isYearUnit?12:1);if(!price&&info.isYearUnit){price=info.cost}var html="";html+='<p class="basket__data-row-item '+(info.isAction?"basket__data-row-item_color-orange":"")+'">';html+=(utils.isEmpty(prefix)?info.name:prefix+" &laquo;"+info.name+"&raquo;");if(!(!utils.isset(info.actionFee)&&!utils.isset(info.fee))&&!withOutFee){html+='<span class="basket__data-add-box"><span class="basket__data-cost"><span class="'+(info.isYearUnit?"cost-rubyear":"cost-rubmon")+'">'+Math.round(price/100)+"</span></span></span>";if(info.isAction&&info.actionMonth){html+='<br><span class="notes-info-small">(с '+(info.actionMonth+1)+"-го месяца платеж составит "+Math.round(info.fee/100)+" руб/мес.)</span>"}if(info.isAction&&info.actionNote){html+='<br><span class="notes-info-small">('+info.actionNote+")</span>"}}html+="</p>";return html};self.createEquipmentItem=function(info,prefix){return'<p class="basket__data-row-item">'+(utils.isEmpty(prefix)?info.name:prefix+" &laquo;"+info.name+"&raquo;")+" "+(info.label||"")+" "+(info.count>1?" &times; "+info.count+" ":" ")+'<span class="basket__data-add-box"><span class="basket__data-cost">'+(info.isFee?'<span class="cost-rubmon">'+Math.round((utils.isset(info.overriddenFee)?info.overriddenFee:info.fee*info.count)/100)+"</span>":'<span class="cost-rub">'+Math.round((utils.isset(info.overriddenCost)?info.overriddenCost:info.cost*info.count)/100)+"</span>")+"</span></span></p>"};self.refreshBasket=utils.notImplemented;return self};configurators.IBasePacketSection=function(){return{getPacketIds:utils.notImplemented,setPacketIds:utils.notImplemented}};configurators.IptvCompareSection=function($section,$link,basePacketSection,basketSection,params){params=params||{};var $packets=$section.find(".js-packet-select").find(".js-packet-header"),$selectionInfo=$section.find(".js-selection-info"),mq_flag=mq();var self={};var subject_head_active="channel-group__head_active-true",diagrams_hidden="package-diagrams-wrap_hidden-true",channel_list_active="channel_list_active-true",package_first="package-label_state-first",package_expand="package-label_expand-true",sbject_list_active="packages-compare_active-true",subject_active="packages-compare__row_active-true",package_active="package-label_active-true",diagram_active="package-diagram_active-true",package_item_selected="package-list__item_selected-true",channel_is_contained="package-diagram_fill-100";function getSelectedPackets(){return $packets.filter("."+package_active)}self.getSelectedPacketIds=function(){return $.map(getSelectedPackets(),function(packet){return $(packet).data("str-id")})};function getPackets(packetIds){return $packets.filter(function(){return $.inArray($(this).data("str-id"),packetIds)!=-1})}$section.find(".js-subject-group").each(function(){var $group=$(this),$head=$group.find(".js-subject-head"),$diagrams=$group.find(".js-packet-diagrams");$head.click(function(){var $list=$group.find(".js-new-channel-list");if($list.size()==0){$list=$group.find(".js-channel-list")}if($head.hasClass(subject_head_active)){$list.removeClass(channel_list_active).removeAttr("style")}else{$list.cloneWidthHeight("height").addClass(channel_list_active)}$group.toggleClass(subject_active);$head.toggleClass(subject_head_active);$diagrams.toggleClass(diagrams_hidden);if(mq_flag==3||mq_flag==4){$group.closest(".js-mobile-packet-part").removeAttr("data-max-height").cloneWidthHeight("height")}})});$section.find(".js-expand-all").click(function(){var $expander=$(this),old_text=$expander.text(),isAllExpanded=$expander.hasClass(subject_head_active);$expander.text($expander.data("toggle-text")).data("toggle-text",old_text);$expander.toggleClass(subject_head_active);$section.find(".js-subject-group").find(".js-subject-head").each(function(){var $subject=$(this),isExpanded=$subject.hasClass(subject_head_active);if(isAllExpanded==isExpanded){$subject.click()}})});$section.find(".js-packet-checks-toggle").click(function(){$(this).toggleClass("package-select__head_active-true").closest(".js-packet-checks").toggleClass("package-select_active-true")});function updatePacketItemWidth($items,width){$items.css({width:width}).removeClass(package_first).filter(":not(.js-is-hidden)").first().addClass(package_first)}function togglePacketItems($items,width){$items.each(function(index){var isHidden=$packets.eq(index).is(".js-is-hidden");$(this).toggle(!isHidden).toggleClass("js-is-hidden",isHidden)});updatePacketItemWidth($items,width)}var parts=[15,25,50,75,90,100];var diagram_fill_prefix="package-diagram_fill-";function addFillClass($diagram,part){$diagram.addClass(diagram_fill_prefix+part)}function removeFillClass($diagram){for(var i in parts){$diagram.removeClass(diagram_fill_prefix+parts[i])}}function getPart(currentSize,fullSize){var part=fullSize!=0?currentSize/fullSize*100:0;roundPart=null;if(part==0){roundPart=0}else{if(part==100){roundPart=parts[parts.length-1]}else{for(var i=0,n=parts.length-1;i<n;i++){if(part<=parts[i]){roundPart=parts[i];break}}roundPart=roundPart||parts[parts.length-2]}}return roundPart}function updateSubjectChannelList($subject){var $channelList=$subject.find(".js-channel-list"),size=$channelList.find(".js-channel:not(.js-is-hidden)").size();$subject.find(".js-subject-size").text(size);$subject.find(".js-packet-diagrams").find(".js-packet:not(.js-is-hidden)").each(function(){var $packInSubject=$(this),$diagram=$packInSubject.find(".js-packet-diagram");removeFillClass($diagram);addFillClass($diagram,getPart($packInSubject.find(".js-channel-count").text(),size))});var $oldFiltredChannelList=$subject.find(".js-new-channel-list"),isActive;if($oldFiltredChannelList.size()>0){isActive=$oldFiltredChannelList.hasClass(channel_list_active);$oldFiltredChannelList.remove()}else{isActive=$channelList.hasClass(channel_list_active)}var $filtredChannelList=$channelList.clone(true),$channelsForRemove=$filtredChannelList.find(".js-channel.js-is-hidden, .js-channel.js-is-filtered"),$currentList;if($channelsForRemove.size()>0){$channelList.hide();$channelsForRemove.remove();$subject.append($filtredChannelList.removeClass("js-channel-list").addClass("js-new-channel-list"));$currentList=$filtredChannelList}else{$currentList=$channelList}if(isActive){$currentList.cloneWidthHeight("height").addClass(channel_list_active).show()}else{$currentList.removeClass(channel_list_active).removeAttr("style")}var isShowed=$subject.find(".js-channel:not(.js-is-filtered):not(.js-is-hidden)").size()>0;$subject.toggle(isShowed).toggleClass("js-is-hidden",!isShowed)}function updateMobileSubjectChannelLists($subject){var isShowed=!$subject.hasClass("js-is-hidden");$packets.each(function(){var $packet=$(this),$mobilePart=$packet.next(".js-mobile-packet-part"),$desktopChannelList=$subject.find(".js-channel-list");$mobilePart.find('.js-subject-group[data-id="'+$subject.data("id")+'"]').each(function(){var $mobileSubject=$(this);$mobileSubject.find(".js-channel-list").find(".js-channel").each(function(){var $mobileChannel=$(this),$desktopChannel=$desktopChannelList.find('.js-channel[data-id="'+$mobileChannel.data("id")+'"]'),isHidden=$desktopChannel.hasClass("js-is-hidden"),isFiltered=$desktopChannel.hasClass("js-is-filtered");$mobileChannel.toggleClass("js-is-hidden",isHidden).toggleClass("js-is-filtered",isFiltered).toggle(!isHidden&&!isFiltered)});updateSubjectChannelList($mobileSubject);$mobileSubject.toggle(isShowed).toggleClass("js-is-hidden",!isShowed)})})}var $desktopSubjects=$section.find(".js-desktop-subjects").find(".js-subject-group");function updateSubjectChannelLists(){$desktopSubjects.each(function(){var $subject=$(this);$subject.find(".js-channel-list").find(".js-channel").each(function(){var $channel=$(this),isShowed=$channel.find(".js-channel-diagrams").find(".js-packet:not(.js-is-hidden)").find(".js-packet-diagram").filter("."+channel_is_contained).size()>0;$channel.toggle(isShowed).toggleClass("js-is-hidden",!isShowed)});updateSubjectChannelList($subject);updateMobileSubjectChannelLists($subject)})}function filterChannels(text){text=text.trim().toLowerCase();$desktopSubjects.each(function(){var $subject=$(this);$subject.find(".js-channel-list").find(".js-channel").each(function(){var $channel=$(this),isShowed=text==""||$channel.find(".js-name").text().toLowerCase().indexOf(text)!=-1;$channel.toggle(isShowed).toggleClass("js-is-filtered",!isShowed)});updateSubjectChannelList($subject);updateMobileSubjectChannelLists($subject)})}var $searchText=$section.find(".js-text-search");$section.find(".js-button-search").click(function(){filterChannels($searchText.val())});$searchText.on("keydown",function(e){if(e.keyCode==13){filterChannels($searchText.val())}});var $packetChecks=$section.find(".js-packet-check-list").find(".js-packet-check");$packetChecks.change(function(){var count=0;$packets.each(function(index){var $packet=$(this),isChecked=$packetChecks.filter('[value="'+$packet.data("str-id")+'"]').is(":checked");$packet.toggle(isChecked).toggleClass("js-is-hidden",!isChecked);var $mobilePart=$packet.next(".js-mobile-packet-part");if($packet.hasClass(package_expand)&&isChecked){$mobilePart.cloneWidthHeight("height").addClass(sbject_list_active)}else{$mobilePart.removeClass(sbject_list_active).removeAttr("style")}if(isChecked){count++}});var width=100/count+"%";updatePacketItemWidth($packets,width);if(count==1){$packetChecks.filter(":checked").prop("disabled",true)}else{$packetChecks.prop("disabled",false)}$section.find(".js-desktop-subjects").find(".js-subject-group").each(function(){var $subject=$(this);togglePacketItems($subject.find(".js-packet-diagrams").find(".js-packet"),width);$subject.find(".js-channel-list").find(".js-channel-diagrams").each(function(){togglePacketItems($(this).find(".js-packet"),width)})});updateSubjectChannelLists()});$desktopSubjects.add($section.find(".js-packet-select").find(".js-mobile-packet-part")).find(".js-channel-list").each(function(){var $channels_list=$(this);$channels_list.find(".js-channel").find("[data-desc]").click(function(){var $this=$(this);if(mq_flag==2||mq_flag==3||mq_flag==4){var $desc=$($(this).data("desc"));if($desc.size()>0){var $channelPopup=$desc.clone();$channelPopup.addClass("channel-compare-desc");var $closeButton=$("<button>",{"class":"channel-compare-desc__close",type:"button",title:"Закрыть"});$channelPopup.append($closeButton);$channelPopup.css("top",($channels_list.position().top+$this.position().top));$channelPopup.insertAfter($channels_list);$section.setMod("overlay","on");setTimeout(function(){$section.on("click.compare",function(){$channelPopup.remove();$(this).delMod("overlay").off("click.compare")})},1000);$closeButton.on("click.compare",function(){$channelPopup.remove();$section.delMod("overlay").off("click.compare")})}}})});function updatePacketWidth(isForce){var old_mq_flag=mq_flag;mq_flag=mq();if((mq_flag===3||mq_flag===4)&&(old_mq_flag===1||old_mq_flag===2||isForce)){$packets.css({width:"100%"});$packets.filter(":not(.js-is-hidden)").each(function(){var $packet=$(this);if($packet.hasClass(package_expand)){$packet.next(".js-mobile-packet-part").removeAttr("data-max-height").cloneWidthHeight("height")}})}else{if((old_mq_flag===3||old_mq_flag===4)&&(mq_flag===1||mq_flag===2||isForce)){$packets.css({width:100/$packets.filter(":not(.js-is-hidden)").size()+"%"})}}}$(window).on("resize",function(){updatePacketWidth()});$section.find(".js-open-print-version").click(function(){var filteredPacketIds=[];$section.find(".js-packet-check-list").find(".js-packet-check:checked").each(function(){filteredPacketIds.push($(this).val())});var subjectIds=[];$desktopSubjects.each(function(){var $subject=$(this);if($subject.hasClass(subject_active)){subjectIds.push($subject.data("id"))}});utils.sendPost(params.printUrl,$.extend({filteredPacketStrIds:filteredPacketIds,expandedSubjectIds:subjectIds,selectedPacketStrIds:self.getSelectedPacketIds()},params.printParams),{target:"_blank"})});function toggleHightLightDiagrams($diagrams,index,isSelected){$diagrams.find(".js-packet:eq("+index+")").toggleClass(package_active,isSelected).find(".js-packet-diagram").toggleClass(diagram_active,isSelected)}function toggleHightLightSubjects($subjects,index,isSelected){$subjects.each(function(){var $subject=$(this);toggleHightLightDiagrams($subject.find(".js-packet-diagrams"),index,isSelected);$subject.find(".js-channel-list").find(".js-channel").each(function(){toggleHightLightDiagrams($(this).find(".js-channel-diagrams"),index,isSelected)})})}function toggleHightLight($packet,isSelected){if(!utils.isset(isSelected)){isSelected=!$packet.hasClass(package_active)}var index=$packets.index($packet);$packet.toggleClass(package_active,isSelected);toggleHightLightSubjects($section.find(".js-desktop-subjects").find(".js-subject-group"),index,isSelected);toggleHightLightSubjects($packet.next(".js-mobile-packet-part").find(".js-subject-group"),0,isSelected)}self.updateSelectionInfo=function(){var packetIds=self.getSelectedPacketIds();$selectionInfo.find(".js-packet-count").text(packetIds.length);$selectionInfo.find(".js-label-of-packets").text(utils.plural(packetIds.length,configurators.PACKET_LABELS));var channelCount=self.getChannelCountForPackets(packetIds);$selectionInfo.find(".js-channel-count").text(channelCount);$selectionInfo.find(".js-label-of-channels").text(utils.plural(channelCount,configurators.CHANNEL_LABELS));$selectionInfo.find(".js-name").text($.map(getSelectedPackets(),function(packet){return $.trim($(packet).find(".js-name").html()).replace("<br>"," ")}).join(", "))};$selectionInfo.find(".js-connect").click(function(){$.magnificPopup.close();basePacketSection.setPacketIds(self.getSelectedPacketIds())});$packets.click(function(){var $packet=$(this);if(mq_flag==3||mq_flag==4){var $mobilePart=$packet.next(".js-mobile-packet-part");if($packet.hasClass(package_expand)){$mobilePart.removeClass(sbject_list_active).removeAttr("style").css("min-height","0px")}else{$mobilePart.removeAttr("style").cloneWidthHeight("height").addClass(sbject_list_active)}$packet.toggleClass(package_expand)}else{if(mq_flag==1||mq_flag==2){if(params.isMultiMode){toggleHightLight($packet)}else{var $selectedPacket=getSelectedPackets();if(!$packet.is($selectedPacket)){toggleHightLight($selectedPacket,false);toggleHightLight($packet,true)}}self.updateSelectionInfo();$selectionInfo.addClass("is-active")}}});$(".js-mobile-packet-part").css("min-height","0px");var isFirstOpen=true;$link.magnificPopup({type:"inline",callbacks:{beforeOpen:function(){updatePacketWidth(true);var $oldSelectedPacket=getSelectedPackets(),$newSelectedPacket=getPackets(basePacketSection.getPacketIds());$oldSelectedPacket.not($newSelectedPacket).each(function(){toggleHightLight($(this),false)});$newSelectedPacket.not($oldSelectedPacket).each(function(){toggleHightLight($(this),true)});self.updateSelectionInfo();$selectionInfo.toggleClass("is-active",$newSelectedPacket.size()>0)},open:function(){if(isFirstOpen){isFirstOpen=false;actions.mfpScrolledBlocks()}}},closeBtnInside:false,showCloseBtn:false,fixedContentPos:true,fixedBgPos:true}).show();self.getChannelCountForPackets=function(packetIds){packetIds=packetIds||basePacketSection.getPacketIds();return $section.find(".js-desktop-subjects").find(".js-subject-group").find(".js-channel-list").find(".js-channel").filter(function(){return $(this).find(".js-packet").has(".js-packet-diagram."+channel_is_contained).filter(function(){return $.inArray($(this).data("str-id"),packetIds)!=-1}).size()>0}).size()};return self};configurators.PstnSection=function($section,basketSection){var self={};function getTariffPlan(){return $section.find("select.js-tariff-plans").find("option:selected")}self.getTariffPlanId=function(){return getTariffPlan().val()};self.getSvcClassId=function(){return getTariffPlan().data("svc-class-id")};self.getBaseOptionId=function(){return getTariffPlan().data("base-option-id")};self.getTariffInfo=function(){var $plan=getTariffPlan();return{name:$plan.data("name"),fee:$plan.data("fee"),afterFee:$plan.data("after-fee"),cost:$plan.data("cost")}};$section.find("select.js-tariff-plans").change(function(){if(!$(this).data("force")){$section.find(".js-comment").hide().filter('[data-pstn-tariff-id="'+$(this).val()+'"]').show();basketSection.refreshBasket()}});$section.find(".js-comment").first().show();return self};configurators.OptionSection=function($section,basketSection,params){params=params||{};var self={};var jsClass=params.jsClass||"js-option";var $options=$section.find("."+jsClass);$options.each(function(){var $switcher=$(this).find("input.js-option-toggle");if(!$switcher.is("[checked]")){$switcher.data("force",true).iCheck("uncheck").data("force",false)}});self.getOption=function(optionId){return $options.filter('[data-str-id="'+optionId+'"]')};self.toggleByBaseIds=function(baseIds){baseIds=baseIds||[];$options.each(function(){var $option=$(this);$option.toggle(baseIds.indexOf($option.data("base-str-id"))==-1)});$section.toggle($options.filter(":visible").size()>0)};self.addToggleListener=function(optionId,callback){var $option=self.getOption(optionId);$option.find("input.js-option-toggle").on("ifChanged",function(){var $switcher=$(this);if(!$switcher.data("is-not-toggle")&&!$switcher.data("not-raise-toggle")){callback($switcher.is(":checked"),$switcher.data("force"))}})};self.addChangeListener=function(callback){if(utils.isFunction(callback)){$options.find("input.js-option-toggle").on("ifChanged",function(){if(!$(this).data("force")){callback()}})}};function setChecked($option,isChecked,isNotRaise){var $switcher=$option.find("input.js-option-toggle");if($switcher.is(":checked")==isChecked){return}if(isNotRaise){$switcher.data("not-raise-toggle",true)}$switcher.data("force",true);$switcher.iCheck(isChecked?"check":"uncheck");if(!isChecked){$switcher.closest(".config-choise").find(".config-choise__icon").removeClass("config-choise__icon_choise-checked")}$switcher.data("force",false);if(isNotRaise){$switcher.data("not-raise-toggle",false)}}self.setChecked=function(optionId,isChecked,isNotRaise){setChecked(self.getOption(optionId),isChecked,isNotRaise)};function setEnabled($option,isEnabled,forAction){var $switcher=$option.find("input.js-option-toggle");if(forAction){$option.data("is-action-disabled",!isEnabled)}if($switcher.prop("disabled")!=isEnabled||isEnabled==$option.data("is-action-disabled")){return}$switcher.data("is-not-toggle",true).data("force",true).iCheck(isEnabled?"enable":"disable");if(!$switcher.is(":checked")){$switcher.iCheck(isEnabled?"indeterminate":"determinate")}if(!isEnabled&&!$switcher.is(":checked")){$switcher.closest(".config-choise").find(".config-choise__icon").removeClass("config-choise__icon_choise-checked")}$switcher.prop("disabled",!isEnabled).data("force",false).data("is-not-toggle",false)}self.setEnabled=function(optionId,isEnabled,forAction){setEnabled(self.getOption(optionId),isEnabled,forAction)};self.togglePrice=function(optionId,isVisible){self.getOption(optionId).find(".config-choise__add-box").hide()};function setPriceText($option,text){$option.find(".config-choise__add-box").find(".cost-rubmonth-2rows,.js-price,.js-fee").text(text)}self.getFee=function(optionId){var $option=self.getOption(optionId);var $subOptions=$option.find(".js-sub-options");if($subOptions.length){if($subOptions.is("select")){$option=$subOptions.find("option:selected")}else{$option=$option.find("input:checked")}}return $option.data("fee")||0};self.resetPriceText=function(optionId){setPriceText(self.getOption(optionId),0)};self.restorePriceText=function(optionId){setPriceText(self.getOption(optionId),Math.round(self.getFee(optionId)/100))};self.toggleSwitcher=function(optionId,isVisible){self.getOption(optionId).find(".js-option-toggle").hide()};self.getOptionInfos=function(escapedOptionIds){var infos=[];$options.has("input.js-option-toggle:checked").each(function(){var $option=$(this),name;if(escapedOptionIds&&escapedOptionIds.indexOf($option.data("str-id"))!=-1){return}var $subOptions=$option.find(".js-sub-options");if($subOptions.length){if($subOptions.is("select")){$option=$subOptions.find("option:selected")}else{$option=$option.find("input:checked")}name=$option.data("name")||$option.text()}else{name=$option.find(".js-name").text()}var info={id:$option.data("str-id"),name:name,prefix:$option.data("prefix"),fee:$option.data("fee")||0,afterFee:$option.data("after-fee")||0,cost:$option.data("cost")||0};if($option.data("is-action")){info.isAction=true;info.actionFee=$option.data("action-fee")||0;var month=$option.data("action-month");if(month&&month>0){info.actionMonth=month}var actionNote=$option.data("action-note");if(!utils.isEmpty(actionNote)){info.actionNote=actionNote}}info.isYearUnit=$option.data("is-year-unit");infos.push(info)});return infos};self.getOptionInfosWithEscaping=function(escapedOptionIds){if(utils.isset(escapedOptionIds)&&!utils.isArray(escapedOptionIds)){escapedOptionIds=[escapedOptionIds]}return self.getOptionInfos(escapedOptionIds)};self.getOrderedOptionIds=function($filtredOptions){$filtredOptions=$filtredOptions||$options;var optionIds=[];$filtredOptions.has("input.js-option-toggle:checked").each(function(){var $option=$(this);if(!$option.data("is-fictive")){var $subOptions=$option.find(".js-sub-options");if($subOptions.length){if($subOptions.is("select")){$option=$subOptions.find("option:selected")}else{$option=$option.find("input:checked")}optionIds.push($option.val())}else{optionIds.push($option.data("str-id"))}}});return optionIds};self.isSelect=function(optionId){var isSelect=false;$options.has("input.js-option-toggle:checked").each(function(){var $option=$(this);return !(isSelect=($option.data("str-id")==optionId||$option.find("select.js-sub-options").val()==optionId)||$option.find(".js-sub-options").find("input:checked").val()==optionId)});return isSelect};self.updateIncludedOptions=function(optionIds){$options.each(function(){var $option=$(this),isIncluded=$.inArray($option.data("str-id"),optionIds)!=-1;var $switcher=$option.find(".js-option-toggle").toggle(!isIncluded||$option.data("is-fictive")).filter("input");setEnabled($option,!isIncluded&&$option.data("is-enabled"));if(isIncluded&&!$switcher.is(":checked")){setChecked($option,true)}})};self.updateRequiredOptions=function(includedOptionIds,excludedOptionIds){$options.each(function(){var $option=$(this),id=$option.data("str-id"),isIncluded=$.inArray(id,includedOptionIds)!=-1;if(!isIncluded&&$option.data("is-required")){for(var otherId in excludedOptionIds){if($.inArray(otherId,includedOptionIds)!=-1&&$.inArray(id,excludedOptionIds[otherId])!=-1){return}}setChecked($option,true)}})};self.resetSelection=function(){$options.has("input.js-option-toggle:checked").each(function(){var $option=$(this);var $switcher=$option.find("input.js-option-toggle");if(!$option.data("is-required")&&!$option.data("is-fictive")&&$switcher.is(":checked")&&!$switcher.is("[checked]")){setChecked($option,false)}})};self.getOrderDopInfo=function(){var infos=[];$options.has("input.js-option-toggle:checked").filter('[data-is-fictive="true"]').each(function(){var $option=$(this);var $subOptions=$option.find(".js-sub-options");if($subOptions.length){if($subOptions.is("select")){$option=$subOptions.find("option:selected")}else{$option=$option.find("input:checked")}}var info=$option.data("dop-info");if(!utils.isEmpty(info)){infos.push(info)}});return infos.join("\r\n")};$options.each(function(){var $option=$(this);$option.find("select.js-sub-options").change(function(){var $subOption=$(this).find("option:selected");$option.find(".js-fee").text(Math.round($subOption.data("fee")/100))})});$options.find("input.js-option-toggle").on("ifChanged",function(){var $switcher=$(this);$switcher.closest("."+jsClass).find(".js-sub-options").toggleClass("select-active",$switcher.is(":checked"));if(!$switcher.data("force")){basketSection.refreshBasket()}});$options.find("select.js-sub-options").change(function(){if(!$(this).data("force")){basketSection.refreshBasket()}});$options.find(".js-sub-options:not(select)").find("input").on("ifChanged",function(){if(!$(this).data("force")){basketSection.refreshBasket()}});$options.has(".js-grey-radio").each(function(){var $option=$(this),$switcher=$option.find("input.js-option-toggle");var onSwitch=function(force){var isChecked=$switcher.is(":checked");if(isChecked){$option.find(".config-choise__cost").has("input.js-grey-radio:checked").removeClass("opt-unchecked")}else{$option.find(".config-choise__cost").addClass("opt-unchecked")}var $radios=$option.find("input.js-grey-radio");if(force){$radios.data("force",true)}$radios.iCheck(isChecked?"enable":"disable");if(force){$radios.data("force",false)}};$switcher.on("ifChanged",function(){onSwitch()});$option.find("input.js-grey-radio").on("ifChanged",function(){var $this=$(this);$this.closest(".config-choise__cost").toggleClass("opt-unchecked",!$this.is(":checked")||!$switcher.is(":checked"))});onSwitch(true)});$options.each(function(){var $option=$(this);if(!$option.data("is-enabled")){setEnabled($option,false)}if($option.data("is-required")){setChecked($option,true)}});return self};configurators.bindOptionExcluding=function(optionSections,basketSection,excludedOptionIds){var refreshBasket=utils.noop;function exclude(ids,isChecked){for(var i in ids){for(var j in optionSections){optionSections[j].setChecked(ids[i],false)}}}$(optionSections).each(function(i,optionSection){$.each(excludedOptionIds,function(id,excludedIds){optionSection.addToggleListener(id,function(isChecked){if(isChecked){exclude(excludedIds)}refreshBasket()});if(optionSection.isSelect(id)){exclude(excludedIds)}})});refreshBasket=basketSection.refreshBasket};configurators.EquipmentSection=function($section,basketSection,params){params=params||{};var self={};var $equipments=$section.find(".js-equipment"),$baseEquipments=$equipments.filter('[data-is-option="false"]'),$optionEquipments=$equipments.filter('[data-is-option="true"]'),MAX_COUNT=params.maxCount||3;var button_passive="unit-equipment__btn_passive",button_active="unit-equipment__btn_active",unit_passive="unit-equipment_passive",unit_active="unit-equipment_active";function getEquipmentName($equipment){var name=$equipment.find(".js-name").html()||"",i=name.indexOf("\u00ab"),j=name.indexOf("\u00bb");if(i!=-1&&j!=-1){name=name.substr(i+1,j-i-1)}return name}var MSG_OF_EMPTY="Пользоваться услугой Интерактивное ТВ можно только при наличии ТВ-приставки.</br>";if($baseEquipments.size()>1){var texts=[];$baseEquipments.each(function(){var $this=$(this);if(!$this.data("is-fake")){texts.push("ТВ-приставку &laquo;"+getEquipmentName($this)+"&raquo;")}});MSG_OF_EMPTY+="Вам необходимо выбрать "+texts.join(texts.length<=2?" либо ":", либо ")+"."}function getCount($equipments){var count=0;$equipments.has("input.js-equipment-toggle:checked").each(function(){count+=utils.toInt($(this).find(".js-count").text())||1});return count}function trimCounts($equipments,max){$equipments.has("input.js-equipment-toggle:checked").each(function(){var $equipment=$(this),$count=$equipment.find(".js-count"),old_count=$count.text()||1,count=Math.min(old_count,max);if(count==0){$equipment.find("input.js-equipment-toggle").data("force",true).iCheck("uncheck").data("force",false)}else{$count.text(count);if(old_count!=count){updatePrice($equipment)}}})}function getCandidate($equipments,$current,canRepeat,needLastCandidate){var $target=null;var $fakeEquipments=getFakeEquipments($equipments);$equipments=$equipments.not($fakeEquipments).push($fakeEquipments).not($current);if(needLastCandidate){$equipments=$($equipments.get().reverse())}$equipments.each(function(){$target=$(this);if($target.find("input.js-equipment-toggle").is(":checked")){return false}});return canRepeat?($target||$current.first()):($target||$())}function decrementCount($equipment){var $count=$equipment.find(".js-count"),count=$count.text()||1;if(--count==0){$equipment.find("input.js-equipment-toggle").data("force",true).iCheck("uncheck").data("force",false)}else{$count.text(count);updatePrice($equipment)}return count}function incrementCount($equipment){var $count=$equipment.find(".js-count"),count=$count.text()||1;var $switcher=$equipment.find("input.js-equipment-toggle");if(!$switcher.is(":checked")){$switcher.iCheck("check")}else{if(count<=MAX_COUNT){$count.text(++count);updatePrice($equipment)}}return count}function getFakeEquipments($equipments){return $equipments.filter(function(){return $(this).data("is-fake")})}function getSelectedFakeCount($equipments){return getFakeEquipments($equipments).has("input.js-equipment-toggle:checked").size()}function updateIncrementPossiblity($equipments,max){$equipments.has("input.js-equipment-toggle:checked").each(function(){var $equipment=$(this),isPossible=($equipment.find(".js-count").text()||1)<max;updateButtons($equipment.find(".js-plus"),isPossible)})}function updateButtons($buttons,isChecked){$buttons.toggleClass(button_passive,!isChecked).toggleClass(button_active,isChecked)}var baseCountListeners=[],isForceBaseCountUpdate=false;function raiseUpdateBaseCount(){if(isForceBaseCountUpdate){return}for(var i in baseCountListeners){baseCountListeners[i](getCount($baseEquipments))}}self.addBaseCountListener=function(callback){if(utils.isFunction(callback)){baseCountListeners.push(callback)}};$equipments.find("input.js-equipment-toggle").on("ifChanged",function(){var $switcher=$(this),isChecked=$switcher.is(":checked");$switcher.closest(".js-equipment").toggleClass(unit_passive,!isChecked).toggleClass(unit_active,isChecked)});self.getFirstBaseEquipmentId=function(isFake){return $baseEquipments.filter(function(){return isFake==utils.toBoolean($(this).data("is-fake"))}).first().data("id")};self.swapSingleBaseSelect=function(to,from){if(self.getBaseEquipmentCount()==1){var $to=$baseEquipments.filter('[data-id="'+to+'"]');var $from=$baseEquipments.has("input.js-equipment-toggle:checked");if(from&&($from.data("id")!=from)){return false}if($from.length&&$to.length){var $fromSwitcher=$from.find("input.js-equipment-toggle"),$toSwitcher=$to.find("input.js-equipment-toggle");if($fromSwitcher.is(":checked")){$fromSwitcher.data("force",true).iCheck("uncheck").data("force",false);$toSwitcher.data("force",true).iCheck("check").data("force",false);updateButtons($from.find(".js-minus, .js-plus"),false);updateButtons($to.find(".js-minus"),false);updateButtons($to.find(".js-plus"),true);basketSection.refreshBasket();return true}}}return false};self.setChecked=function(id,isChecked){var $switcher=$equipments.filter('[data-id="'+id+'"]').find("input.js-equipment-toggle");$switcher.iCheck(isChecked?"check":"uncheck")};self.resetSelection=function(){$optionEquipments.each(function(){self.setChecked($(this).data("id"),false)});self.setBaseEquipmentCount(1);self.swapSingleBaseSelect(self.getFirstBaseEquipmentId(true)||self.getFirstBaseEquipmentId(false))};function updatePrice($equipment){var $price=$equipment.find(".js-price"),$promo=$equipment.find(".js-promo-price"),$pay=$equipment.find("select.js-pay").find("option:selected"),isFee=$pay.data("is-fee");$price.toggleClass("cost-rub",!isFee);var price=(isFee?$pay.data("fee"):$pay.data("cost"))||0;var promo=(isFee?$pay.data("after-fee"):$pay.data("after-cost"))||0;var count=utils.toInt($equipment.find(".js-count").text())||1;if(params.monthRentAction&&$pay.val()==params.monthRentAction.actionSchemeId&&count>1){var $basePay=$equipment.find("select.js-pay").find('option[value="'+params.monthRentAction.baseSchemeId+'"]');price+=(count-1)*utils.toInt(isFee?$basePay.data("fee"):$basePay.data("cost"));promo+=(count-1)*utils.toInt(isFee?$basePay.data("after-fee"):$basePay.data("after-cost"))}else{price*=count;promo*=count}$price.text(Math.round(price/100)+($pay.data("suffix")||""));$promo.text(Math.round(promo/100))}$equipments.each(function(){var $equipment=$(this);$equipment.find("select.js-pay").change(function(){updatePrice($equipment)})});$baseEquipments.first().find("input.js-equipment-toggle").data("force",true).iCheck("check").data("force",false);updateIncrementPossiblity($baseEquipments.first(),MAX_COUNT-getSelectedFakeCount($baseEquipments));$baseEquipments.each(function(){var $equipment=$(this);$equipment.find("input.js-equipment-toggle").on("ifChanged",function(){var $switcher=$(this);var isChecked=$switcher.is(":checked"),count=getCount($baseEquipments);updateButtons($equipment.find(".js-minus, .js-plus"),isChecked);updateButtons($baseEquipments.has("input.js-equipment-toggle:checked").find(".js-minus"),count>1);if($switcher.data("force")){return}if(isChecked){if(count<=MAX_COUNT){updateIncrementPossiblity($optionEquipments,count);var maxCount=$equipment.data("is-fake")?MAX_COUNT:MAX_COUNT-getSelectedFakeCount($baseEquipments);if(count==maxCount){$baseEquipments.each(function(){updateIncrementPossiblity($(this),maxCount)})}raiseUpdateBaseCount()}else{decrementCount(getCandidate($baseEquipments,$equipment));updateIncrementPossiblity($baseEquipments,MAX_COUNT-getSelectedFakeCount($baseEquipments))}}else{if(count==0){utils.Notice(MSG_OF_EMPTY,"Внимание",function(){$baseEquipments.not(getFakeEquipments($baseEquipments)).first().find("input.js-equipment-toggle").iCheck("check");if(utils.isFunction(params.notSelectCallback)){params.notSelectCallback()}})}else{trimCounts($optionEquipments,count);updateIncrementPossiblity($baseEquipments,MAX_COUNT-getSelectedFakeCount($baseEquipments));updateIncrementPossiblity($optionEquipments,count);raiseUpdateBaseCount()}$equipment.find(".js-count").text("1");updatePrice($equipment)}});$equipment.find(".js-minus, .js-plus").click(function(){var $button=$(this);if($button.hasClass(button_passive)){return}var currentCount;if($button.is(".js-minus")){currentCount=decrementCount($equipment);var allCount=getCount($baseEquipments);trimCounts($optionEquipments,allCount);updateIncrementPossiblity($optionEquipments,allCount);raiseUpdateBaseCount()}else{currentCount=incrementCount($equipment);var allCount=getCount($baseEquipments);if(allCount>MAX_COUNT){decrementCount(getCandidate($baseEquipments,$equipment))}else{updateIncrementPossiblity($optionEquipments,allCount);raiseUpdateBaseCount()}}updateButtons($equipment.find(".js-minus"),currentCount>1);updateIncrementPossiblity($equipment,MAX_COUNT-getSelectedFakeCount($baseEquipments));basketSection.refreshBasket()})});$optionEquipments.each(function(){var $equipment=$(this);$equipment.find("input.js-equipment-toggle").on("ifChanged",function(){var $switcher=$(this),isChecked=$switcher.is(":checked");updateButtons($equipment.find(".js-minus, .js-plus"),isChecked);if(isChecked){updateIncrementPossiblity($equipment,getCount($baseEquipments))}else{$equipment.find(".js-count").text("1");updatePrice($equipment)}});$equipment.find(".js-minus, .js-plus").click(function(){var $button=$(this);if($button.hasClass(button_passive)){return}if($button.is(".js-minus")){if(decrementCount($equipment)>0){updateIncrementPossiblity($equipment,getCount($baseEquipments))}}else{incrementCount($equipment);updateIncrementPossiblity($equipment,getCount($baseEquipments))}basketSection.refreshBasket()})});self.setBaseEquipmentCount=function(count,needLastCandidate){isForceBaseCountUpdate=true;var delta=getCount($baseEquipments)-count;if(delta>0){var $equipment=$(),$equipments=$();for(var i=0;i<delta;i++){$equipment=getCandidate($baseEquipments,$equipments,true,needLastCandidate);decrementCount($equipment);$equipments.add($equipment)}var $selected=$baseEquipments.has("input.js-equipment-toggle:checked");updateButtons($selected.find(".js-plus"),true);updateButtons($baseEquipments.not($selected).find(".js-plus"),false);if(count==1){updateButtons($selected.find(".js-minus"),false)}}else{if(delta<0){var $equipment=$(),$equipments=$();for(var i=delta;i<0;i++){$equipment=getCandidate($baseEquipments,$equipments,true,needLastCandidate);if(($equipment.data("is-fictive")||$equipment.data("is-fake"))&&self.isSelect($equipment.data("id"))){$equipment=$baseEquipments.not($equipment).first()}incrementCount($equipment);$equipments.add($equipment)}var $selected=$baseEquipments.has("input.js-equipment-toggle:checked");updateIncrementPossiblity($selected,MAX_COUNT-getSelectedFakeCount($baseEquipments));if(count>1){updateButtons($selected.find(".js-minus"),true)}}}trimCounts($optionEquipments,count);updateIncrementPossiblity($optionEquipments,count);isForceBaseCountUpdate=false};self.getBaseEquipmentCount=function(){return getCount($baseEquipments)};self.getEquipmentInfos=function(isNotExtended,$filteredEquipments){var infos=[];($filteredEquipments||$equipments).filter(function(){return !(isNotExtended&&$(this).data("is-fictive"))}).has("input.js-equipment-toggle:checked").each(function(){var $equipment=$(this);var isFake=$equipment.data("is-fake");var $pay=$equipment.find("select.js-pay").find("option:selected");if($pay.size()==0&&isFake){$pay=$equipment}var count=utils.toInt($equipment.find(".js-count").text())||1,info={id:$equipment.data("overridden-id")||$equipment.data("id"),scheme:$pay.data("overridden-scheme")||$pay.val(),count:count};if(!isNotExtended){var isFee=$pay.data("is-fee");$.extend(info,{isFee:isFee,fee:$pay.data("fee")||0,cost:$pay.data("cost")||0,afterCost:$pay.data("after-cost")||0,label:$pay.data("short-name"),name:isFake?$equipment.data("name"):getEquipmentName($equipment),isOption:$equipment.data("is-option"),isFake:isFake,isFictive:$equipment.data("is-fictive"),linkedShpdOptionId:$equipment.data("linked-shpd-option-id")});if(params.monthRentAction&&$pay.val()==params.monthRentAction.actionSchemeId){var overriddenPrice=isFee?$pay.data("fee"):$pay.data("cost");if(count>1){var $basePay=$equipment.find("select.js-pay").find('option[value="'+params.monthRentAction.baseSchemeId+'"]');overriddenPrice+=(count-1)*utils.toInt(isFee?$basePay.data("fee"):$basePay.data("cost"))}info[isFee?"overriddenFee":"overriddenCost"]=overriddenPrice}}infos.push(info)});return infos};self.getEquipmentInfo=function(equipmentId){return self.getEquipmentInfos(false,$equipments.filter('[data-id="'+equipmentId+'"]'))[0]};self.getOrderDopInfo=function(){var infos=[];$equipments.has("input.js-equipment-toggle:checked").each(function(){var info=$(this).data("dopInfo");if(!utils.isEmpty(info)){infos.push(info)}});return infos.join("\r\n")};self.getOrderedEquipmentInfos=function(){return self.getEquipmentInfos(true)};self.getOptionEquipmentInfos=function(){return self.getEquipmentInfos(false,$optionEquipments)};self.getBaseEquipmentInfos=function(){return self.getEquipmentInfos(false,$baseEquipments)};$equipments.find("input.js-equipment-toggle").on("ifChanged",function(){if(!$(this).data("force")){basketSection.refreshBasket()}});$equipments.find("select.js-pay").change(function(){if(!$(this).data("force")){basketSection.refreshBasket()}});self.updatePrice=function($equipment){updatePrice($equipment)};self.isSelect=function(equipmentId){return $equipments.filter('[data-id="'+equipmentId+'"]').has("input.js-equipment-toggle:checked").size()>0};return self};configurators.bindMultiRoom=function($multiRoom,multirooms,equipmentSection,basketSection,params){var params=params||{};var MULTIROOM_MSG="Вам будет включена дополнительная услуга  &laquo;"+$multiRoom.find(".js-name").text()+"&raquo;",isMultiRoomForce=false;function getMultiRoomCount(){var strId=$multiRoom.find("select.js-sub-options").val();for(var i in multirooms){if(multirooms[i]==strId){return i}}return 1}if(!params.hasNotMultiRoomHandling){$multiRoom.find("select.js-sub-options").change(function(){if(!isMultiRoomForce&&$multiRoom.find("input.js-option-toggle").is(":checked")){if(equipmentSection.getBaseEquipmentCount()==1&&!multirooms[1]&&params.multiRoomIsRequired){return}if(!params.multiRoomDecrementHandling||equipmentSection.getBaseEquipmentCount()>getMultiRoomCount()){equipmentSection.setBaseEquipmentCount(getMultiRoomCount(),true);basketSection.refreshBasket()}}});$multiRoom.find("input.js-option-toggle").on("ifChanged",function(){if(isMultiRoomForce){return}var $switcher=$(this),isChecked=$switcher.is(":checked"),equipmentCount=equipmentSection.getBaseEquipmentCount(),multiRoomCount=getMultiRoomCount(),count;if(equipmentCount==1&&!multirooms[1]&&params.multiRoomIsRequired){return}if(!isChecked){if(equipmentCount==1){return}else{var $select=$multiRoom.find("select.js-sub-options");isMultiRoomForce=true;$select.val($select.find("option:first").val()).data("force",true).selectric("refresh").trigger("change").data("force",false);isMultiRoomForce=false;count=1}}else{if(isChecked&&equipmentCount<multiRoomCount){count=multiRoomCount}else{return}}equipmentSection.setBaseEquipmentCount(count);basketSection.refreshBasket()})}if(!params.hasNotEquipmentHandling){equipmentSection.addBaseCountListener(function(count){if(!$multiRoom.length){return}if(count==1&&!multirooms[1]&&params.multiRoomIsRequired){return}isMultiRoomForce=true;var $switcher=$multiRoom.find("input.js-option-toggle"),$select=$multiRoom.find("select.js-sub-options"),isChecked=$switcher.is(":checked"),firstStrId=$select.find("option:first").val();if(count>1){if(!isChecked){utils.Notice(MULTIROOM_MSG,"Внимание");$switcher.data("force",true).iCheck("check").data("force",false)}$select.val(multirooms[count]||"")}else{$switcher.data("force",true).iCheck("uncheck").data("force",false);$select.val(firstStrId)}$select.data("force",true).selectric("refresh").trigger("change").data("force",false);isMultiRoomForce=false})}};configurators.BaseServiceSection=function($section,basketSection,params){var $services=$section.find(".js-base-service");params=params||{};$section.find("input.js-base-service-select-toggle").iCheck("uncheck").on("ifChanged",function(){var isChecked=$(this).is(":checked");if(!isChecked){$services.find("input.js-base-service-toggle").data("force",true).iCheck("uncheck").data("force",false);basketSection.refreshBasket()}$section.find(".js-base-service").toggle(isChecked)});$services.find("input.js-base-service-toggle").iCheck("uncheck").on("ifChanged",function(){var $switcher=$(this);if(utils.isFunction(params.updateCallback)){params.updateCallback()}if(!$switcher.data("force")){basketSection.refreshBasket()}});var self={};function getBaseServices(){return $services.has("input.js-base-service-toggle:checked")}self.getBaseServiceCount=function(){return getBaseServices().size()||params.defaultBaseServiceCount||0};self.getBaseServiceNames=function(){var names=[];getBaseServices().each(function(){names.push($(this).find(".js-name").text())});return names};return self};configurators.FormSection=function($section,params){actions.tipsyInit();app.wi.bindTipsyUpdater($section.find(".js-check-address-tipsy"));params=params||{};var self={};function setCheckBoxEnabled($checkBox,disabled){$checkBox.prop("disabled",disabled).closest("label").toggleClass("is-disabled callback-form__label-inline_disabled-true",disabled)}$([{src:$section.find('[name="email"]'),trg:$section.find('[name="email-notify"]')},{src:$section.find('[name="phone"]'),trg:$section.find('[name="sms-notify"]')}]).each(function(i,item){item.src.bind("input",function(){setCheckBoxEnabled(item.trg,item.src.val().length==0)})});$section.find(".link-location").click(function(e){e.preventDefault();e.stopPropagation();var $city=$("#region-btn");$("html, body, .p-sideslide__inner").animate({scrollTop:0},400);$(".location-label").trigger("click")});self.getForm=function(){var form={};if($section.find('[name="first-name"],[name="last-name"]').size()==0){var fio=$.trim($section.find('[name="fio"]').val()).split(" ");if(fio.length==1){form.firstName=fio[0];form.lastName="";form.middleName=""}else{if(fio.length==2){form.firstName=fio[1];form.lastName=fio[0];form.middleName=""}else{form.lastName=fio[0];form.firstName=fio[1];form.middleName=fio[2]}}}else{form.firstName=$.trim($section.find('[name="first-name"]').val());form.middleName="";form.lastName=$.trim($section.find('[name="last-name"]').val())}var $callTime=$("#cart-tiletime :selected");var hf=$callTime.val();var ht=$callTime.data("hour-max");if(hf==-1){var hour=utils.getNowHour();if(hour<9||hour>=19){form.callTimeFrom=9;form.callTimeTill=10}else{form.callTimeFrom=hour+1;form.callTimeTill=hour+2}}else{form.callTimeFrom=hf;form.callTimeTill=ht}form.cellPhone=$section.find('[name="phone"]').val();form.email=$section.find('[name="email"]').val();form.notifyBySMS=($('[name="sms-notify"]').is(":checked"))?1:0;form.notifyByEmail=($('[name="email-notify"]').is(":checked"))?1:0;return form};self.getName=function(){return $.trim($section.find('[name="last-name"]').val())+" "+$.trim($section.find('[name="first-name"]').val())};self.clearOrderForm=function(){$section.find('[name="fio"],[name="first-name"],[name="last-name"],[name="phone"],[name="email"],[name="street"],[name="build"],[name="flat"]').val("").validatorFilter("reinit");$section.find('[name="sms-notify"],[name="email-notify"]').each(function(){setCheckBoxEnabled($(this).prop("checked",true),true)});$("#cart-date_connect").val("");$("#cart-time_connect").val(9).selectric("refresh");$("#cart-message_process").hide();$section.find(".address_message").hide();$("#cart-connect").hide();utils.resetSelectric($("#cart-tiletime"))};return self};configurators.openSuccessPopup=function(orderApi,response,afterClose,comment){var $success=$("#request-accepted");if($success.length==0){var popup_body="Здравствуйте, "+orderApi.getFIO()+" !</br>Ваша заявка на подключение зарегистрирована на № "+response.result.packetId+".</br>О ходе исполнения Вашей заявки Вы можете уточнить по тел.8 800 100 0 800 (звонок бесплатный).</br>Благодарим Вас за интерес и доверие, проявленные к нашим услугам.</br>С уважением, Ваш Ростелеком.";utils.Notice(popup_body,"Ваша заявка принята № "+response.result.packetId);return}$success.find(".js-order-id").text(response.result.packetId);$success.find(".js-order-fio").text(orderApi.getFIO());$success.find(".js-connect-comment").text(comment||"");$success.find(".js-bonus").unbind("click.stat").bind("click.stat",function(){if(window.isTest){utils.log("try send yaCounter12151939 with goal: pop_up_read_about_bonus")}else{if(window.yaCounter12151939){try{yaCounter12151939.reachGoal("pop_up_read_about_bonus")}catch(e){}}}if(window.isTest){utils.log("try send gaq with goal: pop_up & suffix: pop_up_read_about_bonus")}else{if(window._gaq){try{_gaq.push(["_trackEvent","pop_up","pop_up_read_about_bonus"])}catch(e){}}}});$.magnificPopup.open({items:{src:$success},type:"inline",callbacks:{afterClose:function(){if(utils.isFunction(afterClose)){afterClose()}if(window.isTest){utils.log("try send yaCounter12151939 with goal: pop_up_close")}else{if(window.yaCounter12151939){try{yaCounter12151939.reachGoal("pop_up_close")}catch(e){}}}if(window.isTest){utils.log("try send gaq with goal: pop_up & suffix: pop_up_close")}else{if(window._gaq){try{_gaq.push(["_trackEvent","pop_up","pop_up_close"])}catch(e){}}}}},closeBtnInside:false,showCloseBtn:false})};configurators.showErrorPopup=function(response){if(response.errorCode>100){utils.Notice(response.errorMsg+".<br>Справки по телефону 8 800 100 0 800.","ИЗВИНИТЕ, ВАШ ЗАКАЗ НЕ МОЖЕТ БЫТЬ ПРИНЯТ.")}else{utils.Notice("Сервис временно недоступен.<br>Справки по телефону 8 800 100 0 800.","ИЗВИНИТЕ, ВАШ ЗАКАЗ НЕ МОЖЕТ БЫТЬ ПРИНЯТ.")}};configurators.ConnectTimeBlock=function(params){params=params||{};if(params.visible){$("#cart-connect").show()}var self={};Date.prototype.addHours=function(h){this.setHours(this.getHours()+h);return this};self.onDateChange=function(selectedDate){var now=new Date();var $times=$("#cart-time_connect option");var isFirst=true;$times.each(function(){var sHour=$(this).data("hour-max");var _$thisTime=$(this);var date=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),selectedDate.getDate()).addHours(sHour);if(date.getTime()-now.getTime()<24*60*60*1000){_$thisTime.prop("disabled","disabled")}else{_$thisTime.prop("disabled",false);if(isFirst){isFirst=false;_$thisTime.prop("selected",true)}}});$("#cart-time_connect").selectric("refresh")};self.showWithDate=function(){$("#cart-connect").show();var $select=$("#cart-street,#cart-build,#cart-flat");if(!params.visible){$select.keypress(function(){$(".tipsy.tipsy-t").remove();$(window).trigger("affect-filters");$("#cart-connect").hide();$("#cart-date_connect").val("");$("#cart-time_connect").val(9).selectric("refresh");$("#cart-message_process").hide();$(".address_message").hide();$select.unbind("keypress")})}$("#cart-connect").trigger("onshow");var cache=$("#cart-date_connect").val();setInterval(function(){if($("#cart-date_connect").val()!==cache&&$("#cart-date_connect").val().length>0){cache=$("#cart-date_connect").val();self.onDateChange($.datepick.parseDate("dd M yyyy",cache))}},100)};self.getTabPart=function(){var tab={};if($("#cart-connect:visible").size()>0){tab.wishTime=$("#cart-time_connect :selected").data("hour-min");if($("#cart-date_connect").val()!==""){var mass_date=$("#cart-date_connect").val().split(" ");var month={"01":"Января","02":"Февраля","03":"Марта","04":"Апреля","05":"Мая","06":"Июня","07":"Июля","08":"Августа","09":"Сентября","10":"Октября","11":"Ноября","12":"Декабря"};tab.wishDate=mass_date[0]+".";for(var mm in month){if(mass_date[1]==month[mm]){tab.wishDate+=mm+"."}}tab.wishDate+=mass_date[2]}else{tab.wishDate=""}}else{tab.wishTime="";tab.wishDate=""}return tab};return self};configurators.bindFastOrderRelation=function(onDateChange,showWithDate,cookieName){var cookieName=cookieName||"create-order-state";var _this=this,isFastOrderValuesSet=false;var state=utils.deparam($.cookie(cookieName));if(state&&document.referrer==state.source&&state.target&&document.location.href.search(new RegExp(state.target.replace(/^\/[^\/]*/,"")+/($|\?.*)/.source))>0){$.each({"#cart-first-name":state.firstName,"#cart-last-name":state.lastName,"#cart-phone":state.phone,"#cart-email":state.email},function(selector,value){var $input=$(selector);if(!utils.isEmpty(value)){$input.val(value);$input.trigger("input").validatorFilter("validate").data("second",true)}});$("#cart-phone_state").find("input").prop("checked",utils.toBoolean(state.phoneState));$("#cart-email_state").find("input").prop("checked",utils.toBoolean(state.emailState));var currentAddress=app.addr.address_process(),previousAddress=state.address;if(currentAddress.region==previousAddress.region&&currentAddress.city==previousAddress.city&&currentAddress.cityId==previousAddress.cityId){var isFullAddress=true;$.each({"#cart-street":previousAddress.street,"#cart-build":previousAddress.house,"#cart-flat":previousAddress.flat},function(selector,value){var $input=$(selector);$input.val(value);if(!utils.isEmpty(value)){$input.val(value)}else{isFullAddress=false}});if(isFullAddress){app.addr.setSuggestablePartOfAddress(previousAddress);var previousDate=state.dateConnect,previousTime=state.timeConnect;$("#cart-connect").one("onshow",function(){if(app.addr.rules_try_count==1){var $time=$("#cart-time_connect");if(previousDate){var prevDateObj=$.datepick.parseDate("dd M yyyy",previousDate),nowDateObj=new Date();prevDateObj.setHours($time.find('option[value="'+previousTime+'"]').data("hour-max")||$time.find('option[data-hour-min="'+previousTime+'"]').data("hour-max")||0);if(ConnectTimeBlock.onDateChange&&prevDateObj.getTime()-nowDateObj.getTime()>=24*60*60*1000){ConnectTimeBlock.onDateChange(prevDateObj);$("#cart-date_connect").val(previousDate);$time.val(previousTime).selectric("refresh").trigger("change")}}}isFastOrderValuesSet=true});if(ConnectTimeBlock.showWithDate){app.addr.setFlat(ConnectTimeBlock.showWithDate);$("#cart-flat").trigger("input")}}else{isFastOrderValuesSet=true}}$(window).unload(function(){if(isFastOrderValuesSet){$.extend(state,{firstName:$("#cart-first-name").val(),lastName:$("#cart-last-name").val(),phone:$("#cart-phone").val(),phoneState:$("#cart-phone_state").find("input").is(":checked"),email:$("#cart-email").val(),emailState:$("#cart-email_state").find("input").is(":checked"),address:app.addr.address_process(),dateConnect:$("#cart-date_connect").val(),timeConnect:$("#cart-time_connect").val()});$.cookie(cookieName,$.param(state),{path:"/",domain:"."+domain})}})}};configurators.bindAsyncLogoLoading=function($onOverItems){if($onOverItems){$onOverItems.one("mouseover",function(){$(this).find("[data-desc]").each(function(){var $target=$($(this).data("desc")).find("[data-link]");$target.html($("<img/>").prop({src:$target.data("link")}))})})}};configurators.filterCommentsBy=function(params){params=params||{};var $contents=$(".js-content-section").filter(function(){var $this=$(this);if($this.hasClass("js-is-default")){return true}for(var key in params){if($this.is("[data-"+key+"]")){return true}}return false});$contents.hide();$contents.each(function(){var $this=$(this);var isVisible=false;for(var key in params){var targetValues=params[key]||[];targetValues=utils.isArray(targetValues)?targetValues:[targetValues];var values=($this.attr("data-"+key)||"").split(",");$.each(values,function(i,value){$.each(targetValues,function(j,targetValue){if(!utils.isEmpty(targetValue)){return !(isVisible=($.trim(value)==$.trim(targetValue)))}});return !isVisible});if(isVisible){break}}$this.toggle(isVisible)})};configurators.bindOptionEnableChange=function(optionSections,optionMap){function enable(optionId,isEnabled){for(var i in optionSections){var section=optionSections[i];section.setEnabled(optionId,isEnabled,true)}}$(optionSections).each(function(i,optionSection){$.each(optionMap,function(srcOptionId,trgOptionId){optionSection.addToggleListener(srcOptionId,function(isChecked){enable(trgOptionId,!isChecked)});if(optionSection.isSelect(srcOptionId)){enable(trgOptionId,false)}})})};configurators.callbackSuggest=function($popup,orderApi,sendCallback,sendAttributes){if($popup.size()==0){$popup=$("#content-callback-suggest")}var addrInfo=app.addr.address_process();$popup.find('[name="street"]').val(addrInfo.street);$popup.find('[name="build"]').val(addrInfo.house);$popup.find('[name="flat"]').val(addrInfo.flat);$popup.find('[name="fio"]').val(orderApi.getFIO());$popup.find("[name=phone]").val(orderApi.orderData.cellPhone);$popup.find("input.validator-filtered").validatorFilter("reinit");var hasStreet=!((adrMgr.other||adrMgr.selectedCity||{}).streetPresent==0);$popup.find('[name="street"]').validatorFilter("toggle",hasStreet).closest(".form-unit").toggle(hasStreet);$popup.find('[name="build"]').parents(".form-unit").last().toggleClass("width-50",!hasStreet).toggleClass("width-25",hasStreet);$.magnificPopup.open({items:{src:$popup},type:"inline",closeBtnInside:false,showCloseBtn:false});$popup.find(".js-city").unbind("click").bind("click",function(e){e.preventDefault();e.stopPropagation();$popup.magnificPopup("close");var $city=$(".location-label");$("html, body, .p-sideslide__inner").animate({scrollTop:0},400);if(!$city.hasClass("location-label_state-on")){$city.click()}});$popup.find(".filter-submit").unbind("click").bind("click",function(){var loaderId=$(this).attr("id");if(!utils.buttonLoader(loaderId)){return}orderApi.orderData.cellPhone=$popup.find('[name="phone"]').val();var fio=$.trim($popup.find('[name="fio"]').val()).split(" ");if(fio.length==1){orderApi.orderData.firstName=fio[0];orderApi.orderData.lastName="";orderApi.orderData.middleName=""}else{if(fio.length==2){orderApi.orderData.firstName=fio[1];orderApi.orderData.lastName=fio[0];orderApi.orderData.middleName=""}else{orderApi.orderData.lastName=fio[0];orderApi.orderData.firstName=fio[1];orderApi.orderData.middleName=fio[2]}}try{delete orderApi.orderData.params.is_quick_request}catch(error){}orderApi.send(function(data){if(utils.isset(data.isError)&&data.isError==0){$popup.magnificPopup("close")}sendCallback(data);utils.buttonUnLoader(loaderId)},sendAttributes||{},true)})};configurators.buildExclusionIdMap=function($section,jsClass,escapeOptionIds){jsClass=jsClass||"js-option";var allIds=$.map($section.find("."+jsClass),function(option){return $(option).data("str-id")});if(escapeOptionIds){allIds=utils.removeAll(escapeOptionIds,allIds)}var map={};for(var i in allIds){var ids=[];for(var j in allIds){if(i!=j){ids.push(allIds[j])}}map[allIds[i]]=ids}return map};(function(){$("#cart_city, .js-city").filter(function(){return utils.isEmpty($(this).attr("href"))}).add($(".js-append-param-change-city")).unbind("click").bind("click",function(){webutils.scrollTo($(".location-box"));$(".location-label").trigger("click")})})();$(document).on("changeCity",{},function(){var $input_active_tarrif=$("#profile-active_tariff");if($input_active_tarrif.size()>0){var isOrder_internet=docContext.urlPath=="/order_internet";var js_plan_name=isOrder_internet?".js-tariff-plan":".js-suggest";var js_attr=isOrder_internet?"data-tariff-id":"data-suggest-id";$(".js-page-swiper").find("input.js-connect-choice").on("change",function(){$("#profile-active_tariff").val($(".js-page-swiper").find("input.js-connect-choice").filter(":checked").parents(".swiper-slide").attr(js_attr))})}var $phone_state_check_box=$("#cart-phone_state > input[type=checkbox]");var $email_state_check_box=$("#cart-email_state > input[type=checkbox]");$phone_state_check_box.on("change",function(){changeInput($(this),$("input[name=profile-cart_phone]"))});$email_state_check_box.on("change",function(){changeInput($(this),$("input[name=profile-cart_email]"))});function changeInput($control_elem,$target){if($control_elem.is(":checked")){$target.val("true")}else{$target.val("false")}}if(!utils.isEmpty(docContext.profile)&&!utils.isEmpty(docContext.profile.customData)){var a=docContext.profile.customData;for(p in a){if(p=="profile-active_tariff"){$(".js-suggest[data-suggest-id="+a[p]+"]").find("label.js-connect-button").trigger("click");$(".js-tariff-plan[data-tariff-id="+a[p]+"]").find("label.js-connect-button").trigger("click")}if(p=="profile-cart_phone"){$phone_state_check_box.iCheck(a[p]==="false"?"uncheck":"check")}if(p=="profile-cart_email"){$email_state_check_box.iCheck(a[p]==="false"?"uncheck":"check")}}var massiCheck=[],massTextInput=[];var exclusion={"profile-viaplay":true,"profile-inputviaplay":true,"profile-hometel_val":true,"profile-hidden_iptv_device_standard":true,"profile-cart_phone":true,"profile-cart_email":true};for(p in docContext.profile.customData||utils.startsWith(p,"profile-radio_")){if(p in exclusion){continue}if(a[p]==="true"||a[p]==="false"){massiCheck.push({j_obj:$("input[name="+p+"]"),value:a[p]})}else{massTextInput.push({j_obj:$("[name="+p+"]"),value:a[p]})}}for(var i=0;massiCheck.length>i;i++){massiCheck[i].j_obj.iCheck(massiCheck[i].value==="true"?"check":"uncheck")}for(var i=0;massTextInput.length>i;i++){if(p=="profile-hidden_iptv_device_standard"){continue}if(massTextInput[i].j_obj.size()==0){continue}if(massTextInput[i].j_obj[0].tagName==="SELECT"){if(massTextInput[i].j_obj.find("[value="+massTextInput[i].value+"]").size()>0){massTextInput[i].j_obj.val(massTextInput[i].value)}}else{massTextInput[i].j_obj.val(massTextInput[i].value)}}$(".js-equipment").each(function(){var $this=$(this);$this.find("span.js-count").text($this.find("input[type=hidden].profile_garbage_class").val())});var MAX_DEVICE_STANDART="3";var span_iptv_device_standard="[name=profile-span_iptv_device_standard]";if($(span_iptv_device_standard).val()===MAX_DEVICE_STANDART){$(span_iptv_device_standard).siblings(".js-plus.unit-equipment__btn_active").removeClass("unit-equipment__btn_active").addClass("unit-equipment__btn_passive");$(span_iptv_device_standard).siblings(".js-minus.unit-equipment__btn_passive").removeClass("unit-equipment__btn_passive").addClass("unit-equipment__btn_active")}$("select").removeClass("opt-replased");$("select").selectric("refresh").trigger("change");for(var key in docContext.profile.customData){if(utils.isString(key)&&utils.startsWith(key,"profile-radio_")){var val=docContext.profile.customData[key];$('input[name="'+key+'"]').filter('[value="'+val+'"]').iCheck("check")}}a=docContext.profile;for(p in docContext.profile){if(typeof a[p]=="string"){if(p==="lastName"){name="last-name";$("[name="+name+"]").val(a[p])}if(p==="firstName"){name="first-name";$("[name="+name+"]").val(a[p])}if(p=="phone"){if(a[p].length>0){$("input[name=sms-notify]").prop("disabled",false)}}if(p=="email"){if(a[p].length>0){$("input[name=email-notify]").prop("disabled",false)}}$("[name="+p+"]").val(a[p])}}$(".location-label").on("click",function(){$(".js-count").each(function(){var $this=$(this);var $input_hidden=($this.siblings("input[type=hidden]"));if($input_hidden.hasClass("profile_garbage_class")){$input_hidden.val($this.text())}});var active_tarrif_id=parseURIGetVal("id");if(active_tarrif_id){$('<input  value="'+active_tarrif_id+'" class="profile_garbage_class" id="profile-active_id" name="profile-active_id" type="hidden">').insertAfter("#cart-email_state")}});function parseURIGetVal(val){var result="null",tmp=[];var items=location.search.substr(1).split("&");for(var index=0;index<items.length;index++){tmp=items[index].split("=");if(tmp[0]===val){result=decodeURIComponent(tmp[1])}}return result}$("#client_adrees_trgger").off("click").on("click",function(){webutils.scrollTo($(".location-box"));$(".location-label").trigger("click")});$(".js-showmore-link , .js-toggle-box").each(function(){var $this=$(this);var data=$this.data("href")||$this.data("togglebox");if($(data).find(":checked:not(:disabled)").size()>0){$this.trigger("click")}})}});