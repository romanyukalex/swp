var validatorFilter=(function($){var illegalLanguages={en:{regexp:/[\u0410-\u042F\u0430-\u044F\u0401\u0451]/gi,info:"Переключите язык ввода на ENG"},ru:{regexp:/[a-zA-Z]/gi,info:"Переключите язык ввода на RUS"}};var regexps={trimOuter:/^\s+|\s+$/gi,trimInner:/\s+/gi};var selectWrapperClasses=".selectric0-wrapper, .selectric1-wrapper, .selectric2-wrapper",selectClasses=".selectric0, .selectric1, .selectric2";var filters={};var placeholderIsSupported=("placeholder" in $("<input>")[0]);function self(filter){if(utils.isObject(filter)){create(filter);return null}return proxy(filter)}function create(filter){filter=$.extend({className:null,charset:null,validate:null,paste:true,trim:false,preLight:false,softPreLight:false,hasPrevent:false,language:null,multiLine:false,checkAlow:false},filter||{});if(!filter.className){return null}filter.regexp={};if(utils.isString(filter.charset)){filter.regexp.allowChars=new RegExp("["+filter.charset+"]","gi");filter.regexp.validChars=new RegExp("^["+filter.charset+"]+$","gi")}if(utils.isString(filter.validate)){if(filter.multiLine){filter.regexp.validValue=new RegExp(filter.validate,"gi")}else{filter.regexp.validValue=new RegExp("^"+filter.validate+"$","gi")}}return filters[filter.className]=filter}function proxy(name){var filter=filters[name];if(!filter){throw new Error("Filter "+name+" is not defined")}var proxy={};proxy.validate=function(value){return validate_value(filter,value)};proxy.appendTo=function(selector){$(selector).each(function(){append(this,name)})};return proxy}function append(target,name){var filter=filters[name];if(!filter){return false}var $this=$(target),flist=$this.data("validate-filters");if(!utils.isObject(flist)){$this.data("validate-filters",flist={})}flist[name]=filter;if(filter.preLight){$this.data("preLight",true)}if(filter.softPreLight){$this.data("softPreLight",true);softInvalidMsg=$this.data("soft-invalid-error")||$this.data("invalid-error");if(softInvalidMsg){$this.attr("data-soft-invalid-error",softInvalidMsg)}}if(filter.checkAllow){$this.data("checkAllow",true)}var iLangObj=illegalLanguages[filter.language];if(iLangObj){$this.data("illegal-language",iLangObj.regexp);$this.attr("data-language-error",iLangObj.info)}if(filter.hasPrevent){$this.data("hasPrevent",true)}return true}function remove(target,name){var $this=$(target),flist=$this.data("validate-filters");if(utils.isObject(flist)){delete flist[name]}}self.affect=function(context){var $context=$(context||document);for(var name in filters){$context.find("."+name).filter("input, select, textarea").each(function(){append(this,name)})}};self.changeEvents=["change","keypress","keyup","keydown","paste"];self.validateEvents=self.changeEvents.concat(["blur","focus"]);self.errorClass="input-error";self.getEventString=function(eventList,suffix){eventList=eventList||[];eventList=utils.isArray(eventList)?eventList:[eventList];suffix=suffix?"."+suffix:"";return $.map(eventList,function(event){return event+suffix}).join(" ")};var validateEventString=self.getEventString(self.validateEvents,"valid");function unbindField($field){$field.unbind(validateEventString).removeClass("not-typed empty invalid input-error").removeData("validate-filters preLight softPreLight checkAllow illegal-language").removeAttr("data-language-error");if($field.is(".filter-select")){$field.closest(selectWrapperClasses).find(".label").removeClass("input-error")}else{if($field.is(".js-input-datepick")&&window.initDatePick&&!$field.data("datepick")){$field.removeClass("is-datepick");initDatePick($field);$field.addClass("is-datepick")}}}self.unbind=function(){$(window).unbind("resize.valid");var $forms=$(".validate_form");$forms.find(".tipsy.js-valid").remove();$forms.each(function(){var $fields=$(this).find(".validator-filtered");$fields.each(function(){unbindField($(this))})})};function bindField($field){$field.on(validateEventString,callback);if($field.is(".js-input-datepick")&&window.initDatePick){$field.removeClass("is-datepick");(($field.data("datepick")||{}).options||{}).onSelect=function(){validateText($field);return true};$field.addClass("is-datepick")}}self.rebind=function(){self.unbind();self.affect();$(".validate_form").each(function(){var $form=$(this),$fields=$form.find(".validator-filtered").filter("input, select, textarea");$fields.each(function(){bindField($(this))})});$(".validate_form").find(".filter-submit").prop("disabled",false).removeClass("button-disabled")};self.additionalValidate=function($form,validateHandler){$form.data("additional-validate",validateHandler)};self.validateForm=function($form){var success=true,$filtered=$form.find(".validator-filtered").filter("input, select, textarea");$filtered.data("second",true);$filtered.each(function(){success=validate($(this))&&success});if(!success){var $first=$filtered.filter(".not-typed, .empty, .invalid, .input-error").first();if($first.is(".filter-select")){var $target=$first.closest(selectWrapperClasses).find(selectClasses);if($target.size()>0){$first.triggerHandler("focus");$(document.body).one("mousedown.valid",function(e){if(!$.contains($target[0],e.target||e.srcElement)){$form.find(".tipsy").hide()}})}}else{$first.trigger("focus")}$first.trigger("focus")}var validateHandler=$form.data("additional-validate");return success&&(!utils.isFunction(validateHandler)||validateHandler())};self.isAffected=false;$(window).on("affect-filters",function(){utils.log("validator affected");self.rebind();$(window).trigger("filters-is-affected");self.isAffected=true});$(window).trigger("affect-filters");$(window).on("load",function(){$(window).trigger("affect-filters")});function reinit(target){var $this=$(target);$this.removeClass("not-typed empty invalid input-error");if($this.is(".filter-select")){$this.closest(selectWrapperClasses).find(".label").removeClass("input-error");$("select.js-selectric0_with-default").selectric("refresh")}var $hint=$this.data("error-dialog");$this.removeData("second error-dialog-type error-options filter-options error-dialog continue-clear-empty clear-empty");if($hint){$(window).unbind("resize.valid",$hint.redraw);$hint.remove()}}$.fn.validatorFilter=function(action,value){switch(action){case"append":this.each(function(){append(this,value)});break;case"remove":this.each(function(){reinit(this);remove(this,value)});break;case"validate":this.each(function(){validate($(this).data("second",true))});break;case"reinit":this.each(function(){reinit(this)});break;case"on":this.each(function(){$(this).data("valid-off",false);reinit(this)});break;case"off":this.each(function(){$(this).data("valid-off",true);reinit(this)});break;case"unbind":this.each(function(){reinit(this);unbindField($(this))});break;case"bind":this.each(function(){bindField($(this))});break;case"filter-off":return this.filter(function(){return $(this).data("valid-off")});break;case"toggle":this.each(function(){$(this).data("valid-off",!value);reinit(this)});break}return this};self.isService=function(e){switch(e.which){case 0:case 8:case 9:case 10:case 13:case 16:case 17:case 18:return true;case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 46:return(e.type=="keydown"||e.type=="keyup");case 65:case 97:case 67:case 99:case 83:case 115:case 86:case 118:case 88:case 120:case 90:case 122:return e.ctrlKey}return false};self.isPasting=function(e){switch(e.which){case 45:return(e.type=="keydown"||e.type=="keyup")&&e.shiftKey;case 86:case 118:return e.ctrlKey}return false};self.isChanging=function(e){return self.isDeleting(e)||!self.isService(e)||self.isPasting(e)};self.isDeleting=function(e){switch(e.which){case 8:return true;case 46:return(e.type=="keydown"||e.type=="keyup")}return false};function fire($this,empty,success,softInvalid){var code=$this.data("validated");if(utils.isString(code)&&code.length>0){try{return eval(code)}catch(e){}}$this.data("error-options",{empty:empty,invalid:!success,"soft-invalid":softInvalid});return success}function validate_value(filter,value){if(filter.regexp.validValue){if(!value.match(filter.regexp.validValue)){return false}}else{if(filter.regexp.validChars){if(!value.match(filter.regexp.validChars)){return false}}}return true}self.isRequired=function($this){return $this.prop("required")||$this.attr("required")||$this.data("required")};function validateText($this){var value=(!placeholderIsSupported&&$this.val()===$this.attr("placeholder")?"":$this.val())||"",lightError=$this.data("second")||$this.data("preLight"),isSoftInvalidPossible=!$this.data("second")&&$this.data("softPreLight");$this.removeClass("not-typed empty invalid input-error");if(value.length==0){if(self.isRequired($this)){$this.addClass("not-typed empty");if(lightError){$this.addClass("input-error")}return fire($this,true,false,isSoftInvalidPossible)}return fire($this,false,true)}var flist=$this.data("validate-filters");if(!utils.isObject(flist)){return true}for(var name in flist){if(!validate_value(flist[name],value)){$this.addClass("not-typed invalid");if(lightError){$this.addClass("input-error")}return fire($this,false,false,isSoftInvalidPossible)}}return fire($this,false,true)}function validateSelect($this){var value=$this.val()||"",$label=$this.closest(selectWrapperClasses).find(".label");$this.removeClass("not-typed empty invalid");$label.removeClass("input-error");if(value.length==0||value==-1){$this.addClass("not-typed empty invalid");if($this.data("second")){$label.addClass("input-error")}return fire($this,true,false)}return fire($this,false,true)}function validateChbx($this){var success=true;$this.removeClass("not-typed empty invalid");$this.each(function(){if($(this).is(":checked")){success=true;return false}success=false});if(success){return fire($this,false,true)}else{$this.addClass("not-typed empty");return fire($this,true,false)}}function validate($this){if($this.data("valid-off")){return true}if($this.is(".filter-select")){return validateSelect($this)}else{if($this.is(".filter-chbx")){return validateChbx($this)}else{return validateText($this)}}}function checkLanguage($this,c){var iLangRe=$this.data("illegal-language"),flist=$this.data("validate-filters");if(iLangRe&&c.match(iLangRe)){$this.data("second",true);$this.data("filter-options",{empty:false,invalid:true,language:true,filter:true})}else{for(var name in flist){filter=flist[name];if(filter.regexp.allowChars&&!c.match(filter.regexp.allowChars)){if($this.data("checkAllow")){$this.data("second",true)}$this.data("filter-options",{empty:false,invalid:true,language:false,filter:true});break}}}}function callback(e){var $this=$(e.target),flist=$this.data("validate-filters");if(!utils.isObject(flist)){return true}switch(e.type){case"focus":if($this.data("second")){showError($this,{filter:false,focus:true})}break;case"paste":for(var name in flist){filter=flist[name];if(!filter.paste){return false}}break;case"keydown":$this.removeData("filter-options");if(self.isDeleting(e)&&$this.val().length==0&&self.isRequired($this)&&!$this.data("second")){if(!$this.data("continue-clear-empty")){$this.data("clear-empty",true);$this.data("continue-clear-empty",true)}else{$this.data("clear-empty",false)}}break;case"keyup":if(self.isChanging(e)){if($this.data("clear-empty")){$this.data("clear-empty",false)}else{validate($this);if($(this).data("hasPrevent")&&!self.isService(e)&&(max==null||$this.val().length<=max)){var c=$this.val().charAt(e.target.selectionStart-1);checkLanguage($this,c)}showError($this,$this.data("filter-options"));$this.data("continue-clear-empty",false)}}break;case"keypress":var max=$this.attr("maxlength");if(self.isChanging(e)&&(max==null||$this.val().length<max)){if(!self.isService(e)){var c=String.fromCharCode(e.charCode);checkLanguage($this,c)}}break;case"blur":var $dialog=$this.data("error-dialog");if($dialog){$dialog.hide()}if($this.data("second")){validate($this)}else{var options=$this.data("error-options");if(options&&(options.empty||options.invalid)){$this.data("second",true);validate($this)}}break;case"change":var value=$this.val()||"",flist=$this.data("validate-filters");if(value.length>0&&utils.isObject(flist)){for(var name in flist){var filter=flist[name];if(filter.trim){$this.val(value.replace(regexps.trimOuter,"").replace(regexps.trimInner," "));break}}}validate($this);showError($this,{filter:false});break}}var errorLevelFlow=["language","filter","empty","soft-invalid","invalid","focus"],errorDeftIndex=1000,errorNextIndex=errorDeftIndex;function showError($this,update){if($this.hasClass("is-datepick")){return}var $dialog=$this.data("error-dialog"),options=$.extend($this.data("error-options")||{},update),type=null,$form=$this.parents(".validate_form");$this.data("error-options",options);if(($this.data("second")||$this.data("preLight")||$this.data("softPreLight"))&&!$this.is(".filter-captcha")){$.each(errorLevelFlow,function(i,key){if(options[key]&&($this.attr("data-"+key+"-error")||$this.attr("data-invalid-"+key))){type=key;return false}})}if(!type){if($dialog){$dialog.hide()}$this.data("error-dialog-type",null);return}if(!$dialog){$dialog=$('<div class="tipsy tipsy-nw error js-valid" />').html('<div class="tipsy-arrow tipsy-arrow-n"></div><div class="tipsy-inner"></div>').css("zIndex",errorDeftIndex).click(function(e){$dialog.css("zIndex",++errorNextIndex)}).appendTo($form).hide();var $control;if($this.is(".filter-select")){$control=$this.closest(selectWrapperClasses)}else{$control=$this}$dialog.redraw=function(){var offset=$control.offset(),formOffset=$form.offset();$dialog.css({left:offset.left-formOffset.left,top:offset.top-formOffset.top+$control.outerHeight(false)})};$(window).bind("resize.valid",$dialog.redraw);$this.data("error-dialog",$dialog)}if($this.data("error-dialog-type")!=type){if(type=="language"||type=="filter"||type=="soft-invalid"||type=="empty"&&options["soft-invalid"]){$dialog.removeClass("error")}else{$dialog.addClass("error")}$this.data("error-dialog-type",type);$dialog.find(".tipsy-inner").html($this.attr("data-"+type+"-error")||$this.attr("data-invalid-"+type))}$dialog.redraw();$dialog.show();if($this.is(".filter-select")){var $control=$this.closest(selectWrapperClasses);$(document.body).one("mousedown.valid",function(e){if(!$.contains($control[0],e.target||e.srcElement)){$form.find(".tipsy").hide()}})}}self.createCustomInputHint=function($control,text,isError){var $form=$control.parents(".validate_form"),$dialog=$('<div class="tipsy tipsy-nw "'+(isError?"error":"tipsy-attention")+" />").html('<div class="tipsy-arrow tipsy-arrow-n"></div><div class="tipsy-inner">'+text+"</div>").css("zIndex",errorDeftIndex).click(function(e){$dialog.css("zIndex",++errorNextIndex)}).appendTo($form).hide();$dialog.redraw=function(){var offset=$control.offset(),formOffset=$form.offset();$dialog.css({left:offset.left-formOffset.left,top:offset.top-formOffset.top+$control.outerHeight(false)})};$(window).bind("resize.valid",$dialog.redraw);return $dialog};return self})(jQuery);validatorFilter({className:"filter-select"});validatorFilter({className:"filter-chbx"});validatorFilter({className:"filter-name",charset:"\\s\u0410-\u042F\u0430-\u044F\u0401\u0451\\-",trim:true,preLight:true,language:"ru"});validatorFilter({className:"filter-organization-name",charset:'\\s\u0410-\u042F\u0430-\u044F\u0401\u0451\\-,.""\\d',trim:true,preLight:true,language:"ru"});validatorFilter({className:"filter-simple-phone",charset:"\\d",validate:"\\d{10}",checkAllow:true});validatorFilter({className:"filter-address",charset:"\\s\\d.,;()\u0410-\u042F\u0430-\u044F\u0401\u0451\\/\\\\-",trim:true});validatorFilter({className:"filter-house",charset:"\\s\\d.,;()\u0410-\u042F\u0430-\u044F\u0401\u0451\\/\\\\-",trim:true});validatorFilter({className:"filter-number",charset:"\\d"});validatorFilter({className:"filter-decimal-number",charset:"\\d.",validate:"\\d+(\\.\\d+)?"});validatorFilter({className:"filter-money",charset:"\\d.",validate:"\\d+(\\.\\d{1,2})?"});validatorFilter({className:"filter-phone",charset:"\\d",validate:"[78]\\d{10}",checkAllow:true});validatorFilter({className:"filter-phone-short",charset:"\\d",validate:"\\d{7}",checkAllow:true});validatorFilter({className:"filter-phone-with-plus",charset:"\\u002B\\d",validate:"(8|\\+7)\\d{10}",checkAllow:true});validatorFilter({className:"filter-phone-mask",charset:"+\\d",validate:"/[7]\\(\\d{3}\\)\\-\\d{3}\\-\\d{2}\\-\\d{2}",checkAllow:true});validatorFilter({className:"filter-phone-sms",charset:"\\d",validate:"[7]\\d{10}",checkAllow:true});validatorFilter({className:"filter-home-phone",charset:"\\d",validate:"\\d{10,11}",checkAllow:true});validatorFilter({className:"filter-email",charset:"\\w\u0410-\u042F\u0430-\u044F\u0401\u0451\\-\\.@",validate:"[\u0410-\u042F\u0430-\u044F\u0401\u0451\\w\\.\\-]+@[\u0410-\u042F\u0430-\u044F\u0401\u0451\\w\\-\\.]+"});validatorFilter({className:"filter-login",charset:"\\w\\.\\-",validate:"[a-z][\\w\\.\\-]*",language:"en"});validatorFilter({className:"filter-captcha",charset:"\\w\\s",validate:"^\\w(.*?)"});validatorFilter({className:"filter-login-elk",charset:"\\w\\-\\.\\_",validate:"[a-z](?:[\\w\\-\\.\\_]*\\w)?",language:"en",preLight:true});validatorFilter({className:"filter-pass-elk",charset:"\\w!@#$%&*_^()+\\-:;,.",validate:"[\\w!@#$%&*_^()+\\-:;,.]{6,16}",language:"en",softPreLight:true});validatorFilter({className:"filter-trim-spaces",trim:true});validatorFilter({className:"filter-dont-paste",paste:false});validatorFilter({className:"filter-none"});validatorFilter({className:"filter-text",validate:"[a-zA-Z0-9]*"});validatorFilter({className:"filter-date"});validatorFilter({className:"filter-datetime"});validatorFilter({className:"filter-any",validate:".+",multiLine:true});validatorFilter({className:"filter-any-first-char",validate:".*[^\\s\n\r].*",multiLine:true});validatorFilter({className:"filter-english-name",charset:"\\s\\w\\-",trim:true,preLight:true,language:"en"});validatorFilter({className:"filter-english-organization-name",charset:'\\s\\w\\-,.""\\d',trim:true,preLight:true,language:"en"});validatorFilter({className:"filter-passport-series",charset:"\\d",validate:"\\d{4}",trim:true});validatorFilter({className:"filter-passport-number",charset:"\\d",validate:"\\d{6}",trim:true});validatorFilter({className:"filter-phys-inn",charset:"\\d",validate:"\\d{12}",trim:true});validatorFilter({className:"filter-corp-inn",charset:"\\d",validate:"\\d{10}",trim:true});validatorFilter({className:"filter-kpp",charset:"\\d",validate:"\\d{9}",trim:true});validatorFilter({className:"filter-bik",charset:"\\d",validate:"\\d{9}",trim:true});validatorFilter({className:"filter-3num",charset:"\\d",validate:"\\d{3}",trim:true});validatorFilter({className:"filter-6num",charset:"\\d",validate:"\\d{6}",trim:true});validatorFilter({className:"filter-8num",charset:"\\d",validate:"\\d{8}",trim:true});validatorFilter({className:"filter-def-search",language:"ru",charset:"\\s\u0410-\u042F\u0430-\u044F\u0401\u0451\\-\\+\\d\\w,",trim:true,preLight:true,hasPrevent:true});validatorFilter({className:"filter-pay-account",validate:"[^\\s]{0,64}",checkAllow:true,preLight:true});validatorFilter({className:"filter-pay-account-small",validate:"[^\\s]{0,12}",checkAllow:true});