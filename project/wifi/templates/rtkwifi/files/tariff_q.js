(function(){ConnectTimeBlock=(function(){var self={};Date.prototype.addHours=function(h){this.setHours(this.getHours()+h);return this};self.onDateChange=function(selectedDate){var now=new Date();var $times=$("#cart-time_connect option");var isFirst=true;$times.each(function(){var sHour=$(this).data("hour-max");var _$thisTime=$(this);var date=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),selectedDate.getDate()).addHours(sHour);if(date.getTime()-now.getTime()<24*60*60*1000){_$thisTime.prop("disabled","disabled")}else{_$thisTime.prop("disabled",false);if(isFirst){isFirst=false;_$thisTime.prop("selected",true)}}});$("#cart-time_connect").selectric("refresh")};self.showWithDate=function(){$("#cart-connect").show();var $select=$("#cart-street,#cart-build,#cart-flat");$select.keypress(function(){$(".tipsy.tipsy-t").remove();$(window).trigger("affect-filters");$("#cart-connect").hide();$("#cart-date_connect").val("");$("#cart-time_connect").val(9).selectric("refresh");$("#cart-message_process").hide();$select.unbind("keypress")});$("#cart-connect").trigger("onshow");var cache=$("#cart-date_connect").val();setInterval(function(){if($("#cart-date_connect").val()!==cache&&$("#cart-date_connect").val().length>0){cache=$("#cart-date_connect").val();self.onDateChange($.datepick.parseDate("dd M yyyy",cache))}},100)};self.getTabPart=function(){var tab={};if($("#cart-connect:visible").size()>0){tab.wishTime=$("#cart-time_connect :selected").data("hour-min");if($("#cart-date_connect").val()!==""){var mass_date=$("#cart-date_connect").val().split(" ");var month={"01":"Января","02":"Февраля","03":"Марта","04":"Апреля","05":"Мая","06":"Июня","07":"Июля","08":"Августа","09":"Сентября","10":"Октября","11":"Ноября","12":"Декабря"};tab.wishDate=mass_date[0]+".";for(var mm in month){if(mass_date[1]==month[mm]){tab.wishDate+=mm+"."}}tab.wishDate+=mass_date[2]}else{tab.wishDate=""}}else{tab.wishTime="";tab.wishDate=""}return tab};return self})();TariffOrderState={cookieName:"create-order-state"};TariffOrderState.bindFastOrderRelation=function(onDateChange,showWithDate){var _this=this,isFastOrderValuesSet=false;var state=utils.deparam($.cookie(_this.cookieName));if(state&&document.referrer==state.source&&state.target&&document.location.href.search(new RegExp(state.target.replace(/^\/[^\/]*/,"")+/($|\?.*)/.source))>0){$.each({"#cart-first-name":state.firstName,"#cart-last-name":state.lastName,"#cart-phone":state.phone,"#cart-email":state.email},function(selector,value){var $input=$(selector);if(!utils.isEmpty(value)){$input.val(value);$input.trigger("input").validatorFilter("validate").data("second",true)}});$("#cart-phone_state").find("input").prop("checked",utils.toBoolean(state.phoneState));$("#cart-email_state").find("input").prop("checked",utils.toBoolean(state.emailState));var currentAddress=app.addr.address_process(),previousAddress=state.address;if(currentAddress.region==previousAddress.region&&currentAddress.city==previousAddress.city&&currentAddress.cityId==previousAddress.cityId){var isFullAddress=true;$.each({"#cart-street":previousAddress.street,"#cart-build":previousAddress.house,"#cart-flat":previousAddress.flat},function(selector,value){var $input=$(selector);$input.val(value);if(!utils.isEmpty(value)){$input.val(value)}else{isFullAddress=false}});if(isFullAddress){app.addr.setSuggestablePartOfAddress(previousAddress);var previousDate=state.dateConnect,previousTime=state.timeConnect;$("#cart-connect").one("onshow",function(){if(app.addr.rules_try_count==1){var $time=$("#cart-time_connect");if(previousDate){var prevDateObj=$.datepick.parseDate("dd M yyyy",previousDate),nowDateObj=new Date();prevDateObj.setHours($time.find('option[value="'+previousTime+'"]').data("hour-max")||$time.find('option[data-hour-min="'+previousTime+'"]').data("hour-max")||0);if(ConnectTimeBlock.onDateChange&&prevDateObj.getTime()-nowDateObj.getTime()>=24*60*60*1000){ConnectTimeBlock.onDateChange(prevDateObj);$("#cart-date_connect").val(previousDate);$time.val(previousTime).selectric("refresh").trigger("change")}}}isFastOrderValuesSet=true});if(ConnectTimeBlock.showWithDate){app.addr.setFlat(ConnectTimeBlock.showWithDate);$("#cart-flat").trigger("input")}}else{isFastOrderValuesSet=true}}$(window).unload(function(){if(isFastOrderValuesSet){$.extend(state,{firstName:$("#cart-first-name").val(),lastName:$("#cart-last-name").val(),phone:$("#cart-phone").val(),phoneState:$("#cart-phone_state").find("input").is(":checked"),email:$("#cart-email").val(),emailState:$("#cart-email_state").find("input").is(":checked"),address:app.addr.address_process(),dateConnect:$("#cart-date_connect").val(),timeConnect:$("#cart-time_connect").val()});$.cookie(_this.cookieName,$.param(state),{path:"/",domain:"."+domain})}})}};TariffOrder=function(options){this.options=(typeof options!=="undefined")?options:{};this.choicePlan=null;this.choiceTariffId=null;this.showMode=null;this.orderPriority={141:2,218:6,219:4,223:10,224:8,229:1};this.klCode="";this.klRegion="";this.klLvl="";this.orderApi=null;this.init=function(){if(typeof window.adrMgr!=="undefined"){var city=(window.adrMgr.other||window.adrMgr.selectedCity);this.selectedCity=city;this.klCode=city.klCode;this.klRegion=city.klRegion;this.klLvl=city.klLvl}this.tagId=(typeof nodeTag!=="undefined")?parseInt(nodeTag):0;if($.inArray(this.tagId,[329,330,331,332])>-1){this.isCorrectPrice=true}this.showMode=(typeof this.options.mode!=="undefined")?this.options.mode:"partial";this.klCode=(typeof this.options.kl_code!=="undefined")?this.options.kl_code:this.klCode;this.klRegion=(typeof this.options.kl_region!=="undefined")?this.options.kl_region:this.klRegion;this.klLvl=(typeof this.options.kl_lvl!=="undefined")?this.options.kl_lvl:this.klLvl;if(this.options.id){this.choiceTariffId=parseInt(this.options.id)}else{this.choiceTariffId=0}if(this.options.tech){this.choiceTechId=parseInt(this.options.tech)}if(this.options.speed){this.choiceSpeed=parseInt(this.options.speed)}if(isNaN(this.choiceTariffId)){this.choiceTariffId=0}if(typeof app!=="undefined"){this.wc=new WebstoreCart();app.wi.cart=this.wc}app.wi.cart.reg_id=this.klRegion;app.wi.cart.addr_code=this.klCode;app.wi.cart.addr_level=this.klLvl;app.wi.cart.tag_id=(typeof this.options.tagid!=="undefined")?this.options.tagid:this.tagId;app.wi.cart.show_mode=this.showMode;app.wi.cart.tp_info=new TemplateClass("/tpls/tariff_info.hbs");app.wi.cart.tp_info.load();app.wi.cart.tp_cart=new TemplateClass("/tpls/tariff_cart.hbs");app.wi.cart.tp_cart.load();app.wi.cart.tp_tpl=new TemplateClass("/tpls/tariff_plan.hbs");app.wi.cart.tp_tpl.load();app.wi.cart.to_tpl=new TemplateClass("/tpls/tariff_option.hbs");app.wi.cart.to_tpl.load();app.wi.cart.td_tpl=new TemplateClass("/tpls/tariff_device.hbs");app.wi.cart.td_tpl.load();app.wi.cart.tod_tpl=new TemplateClass("/tpls/tariff_option_desc.hbs");app.wi.cart.tod_tpl.load();app.wi.cart.tbp_tpl=new TemplateClass("/tpls/tariff_basic_phone.hbs");app.wi.cart.tbp_tpl.load();this.loadTariffs()};this.declOfNum=function(number,titles){cases=[2,0,1,1,1,2];return titles[(number%100>4&&number%100<20)?2:cases[(number%10<5)?number%10:5]]};this.loadTariffs=function(){var _this=this;if(_this.tagId!=0){var pkg_summary="/pages/proxy.jsp?proxyType=agent&proxyMethod=GET&urlCode=pkg_summary&tag="+_this.tagId+"&addr_code="+app.wi.cart.addr_code+"&region="+app.wi.cart.reg_id;if(this.klLvl!=null&&this.klLvl!="null"){pkg_summary+="&addr_level="+this.klLvl}$.ajax(pkg_summary,{dataType:"json"}).done(function(data){if(utils.isEmpty(data)){_this.renderNotFoundMessage()}else{if(adrMgr.selectedRegion.klRegion==50&&_this.tagId==289){_this.tagId=312;data["312"]=data["289"];delete data["289"]}if([282,223,224,312].indexOf(_this.tagId)!==-1){_this.wc.dis_options.push("iptv_max")}_.each(data,function(section,tag){section.tag=parseInt(tag);section.order=(typeof _this.orderPriority[section.tag]!=="undefined")?_this.orderPriority[section.tag]:99});data=_.sortBy(data,function(section){return section.order});try{_.each(data,function(section){for(var i=0;i<section.tariffs.length;i++){section.tariffs[i].channelsCount=section.items[section.tariffs[i].id].channelsCount}})}catch(ex){}if(_this.choiceTariffId==0){var trfId=0;var trfLastId=0;var speed=0;var delta=100;var speedLast=0;_.each(data,function(section){_.each(section.tariffs,function(trf){trfLastId=trf.id;speed=(trf.speed/1024);if(delta>Math.abs(_this.choiceSpeed-speed)){delta=Math.abs(_this.choiceSpeed-speed);trfId=trf.id;speedLast=speed}else{if(speedLast<_this.choiceSpeed&&_this.choiceSpeed<speed){speedLast=speed;trfId=trf.id}}})});_this.choiceTariffId=(trfId!=0)?trfId:trfLastId}_.each(data,function(section){var tp=new TariffPlan({id:"tariff-plan-"+section.tag,"class":"swiper-slide",tpl:app.wi.cart.tp_tpl,data:{title:section.title,type:section.type,spec_icon:section.spec_icon,tag_id:section.tag,is_load:false,load_ch:false,addr_code:app.wi.cart.addr_code,addr_level:app.wi.cart.addr_level,reg_id:app.wi.cart.reg_id},tag_id:section.tag});_.each(section.tariffs,function(trf,idx){trf.ver=2;if(_this.choiceTariffId==0&&idx==0){_this.choiceTariffId=trf.id}if(_this.choiceTariffId==trf.id){_this.choicePlan=tp;tp.addTariff(trf)}});_this.wc.all_plans.push(tp)});_.each(_this.wc.all_plans,function(plan){plan.el.on("choice",function(e,plan){_this.wc.choicePlan(plan)});plan.el.on("choice_tariff",function(e,el,plan){var select=$(el.currentTarget);_this.wc.choiceTariff(plan,parseInt(select.val()))});plan.el.on("load",function(e){if([329,330,331,332].indexOf(_this.tagId)!==-1){var opt={title:"Мультискрин",alias:"multiscreen",altName:"multiscreen",mode:"option",fee:0,enabled:true,required:true,is_enable:true,is_visible:true,type:"iptv"};if(typeof _this.wc.plan.tariffs[0].services.iptv.options=="undefined"){_this.wc.plan.tariffs[0].services.iptv.options=[]}_this.wc.plan.tariffs[0].services.iptv.options.push(opt)}if([110,223,224,287,312,329,330,331,332].indexOf(_this.tagId)!==-1){var opt={title:"ТВ-онлайн на Zabava.ru",alias:"zabava_tv_online",altName:"zabava_tv_online",mode:"option",fee:0,enabled:true,required:true,is_enable:true,is_visible:true,type:"iptv"};if(typeof _this.wc.plan.tariffs[0].services.iptv.options=="undefined"){_this.wc.plan.tariffs[0].services.iptv.options=[]}_this.wc.plan.tariffs[0].services.iptv.options.push(opt)}_this.wc.renderOptions();_this.wc.updateOptions();_this.wc.initDefaultOptions();$(".js-showbox").on("click",function(e){var boxid=$(this).attr("href");if(boxid===undefined){boxid=$(this).attr("data-href")}$(boxid).removeClass("none-elem").addClass("is-visible");if(boxid=="#apack"){var link=$(e.currentTarget);if(link.hasClass("is_open")){$("#apack .config-choise").hide();$(boxid).addClass("none-elem").removeClass("is-visible");link.removeClass("is_open").html(link.attr("data-active-text"))}else{$("#apack .config-choise").show();link.addClass("is_open").html(link.attr("data-inactive-text"));$("#user-opts .page-ad-block").hide()}construct.resetHeight();$(this).hide()}})});plan.el.on("loadFail",function(e){if(!app.unloading){$("#tariffLoader").hide();utils.Notice("Произошла ошибка при загрузке информации о тарифных планах","Ошибка")}})});if(_this.tagId!=0){_.each(_this.wc.all_plans,function(plan){if(plan.data.tag_id==_this.tagId){_this.wc.choiceTariff(_this.choicePlan,_this.choiceTariffId,true);_this.choicePlan.el.on("loadDone",function(){_this.el.html("");if(_this.choicePlan.hasIptv&&_this.choicePlan.hasPhone&&_this.choicePlan.hasShpd){_this.showMode="3in1"}if(_this.choicePlan.hasIptv&&!_this.choicePlan.hasPhone&&!_this.choicePlan.hasShpd){_this.showMode="iptv"}if(_this.showMode=="iptv"){_this.choicePlan.showMode="iptv";_this.choicePlan.data.type="iptv";_this.choicePlan.data.title="Интерактивное ТВ"}if(_this.choicePlan.hasShpd){if($("#internet-1").length==0){app.wi.cart.tp_bo=new TemplateClass("/tpls/tariff_basic_options.hbs");app.wi.cart.tp_bo.load();_this.el.append(app.wi.cart.tp_bo.render({tag:_this.tagId}));if(_this.choicePlan.hasIptv==false){var t=new TemplateClass("/tpls/tariff_fake_device.hbs");t.load();_this.el.append(t.render({mono:true,isUral:mrf.isUral(adrMgr.selectedRegion.klRegion)}))}}}if(_this.choicePlan.hasIptv){var tpls=[];_this.isUral=mrf.isUral(adrMgr.selectedRegion.klRegion);if(typeof _this.isCorrectPrice==="undefined"){if(_this.choicePlan.hasShpd){tpls=["/tpls/tariff_basic_iptv.hbs","/tpls/tariff_add_iptv.hbs","/tpls/tariff_services.hbs","/tpls/tariff_fake_device.hbs","/tpls/tariff_devices.hbs","/tpls/tariff_subscribe.hbs"]}else{tpls=["/tpls/tariff_basic_iptv.hbs","/tpls/tariff_add_iptv.hbs","/tpls/tariff_services.hbs","/tpls/tariff_devices.hbs","/tpls/tariff_subscribe.hbs"]}}else{tpls=["/tpls/tariff_basic_iptv.hbs","/tpls/tariff_fake_device.hbs","/tpls/tariff_devices.hbs","/tpls/tariff_add_iptv.hbs","/tpls/tariff_add_devices.hbs","/tpls/tariff_services_multiscreen.hbs","/tpls/tariff_subscribe.hbs"]}_.each(tpls,function(tpl){var t=new TemplateClass(tpl);t.load();_this.el.append(t.render(_this))})}if(_this.choicePlan.hasPhone){utils.log("phone detected");_.each(["/tpls/tariff_basic_phone.hbs"],function(tpl){var t=new TemplateClass(tpl);t.load();_this.el.append(t.render({}));if(mrf.isSibir(adrMgr.selectedRegion.klRegion)){$("#tariff-phone").find(".index-ad-block_blue").html('<h1 class="content-head-24" style="margin-bottom: 21px;">100 минут<br>внутризоновых<br>и 100 минут междугородных звонков<br>в подарок!</h1>')}})}if(_this.showMode=="iptv"){}if(_this.showMode=="iptv"){if(typeof _this.options.isAction==="undefined"||(typeof _this.options.isAction!=="undefined"&&!_this.options.isAction)){var t=new TemplateClass("/tpls/tariff_iptv_forplay.hbs");t.load();_this.el.prepend(t.render({}));$(".modeplay-shpd,.modeplay-phone").on("ifChanged",function(e){_this.wc.choiceMode(e)})}}else{if(_this.choicePlan.hasShpd){var tariffInfo={};if(_this.choicePlan.tariffs[0].services.shpd.speed<1024){tariffInfo.speed=_this.choicePlan.tariffs[0].services.shpd.speed;tariffInfo.speedRange="kb"}else{tariffInfo.speed=(_this.choicePlan.tariffs[0].services.shpd.speed/1024);tariffInfo.speedRange="mb"}tariffInfo.fee=(_this.choicePlan.tariffs[0].services.shpd.fee/100);tariffInfo.afterFee=(_this.choicePlan.tariffs[0].services.shpd.afterFee/100);tariffInfo.isNewPrice=(tariffInfo.afterFee>tariffInfo.fee?true:false);tariffInfo.techId=_this.choicePlan.tariffs[0].services.shpd.techId;tariffInfo.techComment=_this.choicePlan.tariffs[0].services.shpd.techComment;tariffInfo.technology=_this.choicePlan.tariffs[0].services.shpd.technology;tariffInfo.ico=utils.getTariffSpeedIco(_this.choicePlan.tariffs[0].services.shpd.speed);tariffInfo.isVolga=mrf.isVt(adrMgr.selectedRegion.klRegion);tariffInfo.isUral=mrf.isUral(adrMgr.selectedRegion.klRegion);tariffInfo.isCenter=mrf.isCenter(adrMgr.selectedRegion.klRegion);tariffInfo.isSouth=mrf.isSouth(adrMgr.selectedRegion.klRegion);tariffInfo.isMO=(adrMgr.selectedRegion.klRegion==50?true:false);tariffInfo.channelsCount=_this.choicePlan.tariffs[0].channelsCount;tariffInfo.channelsCountTitle=_this.declOfNum(tariffInfo.channelsCount,["телеканал входит","телеканала входят","телеканалов входят"]);if(app.wi.cart.tag_id==287){tariffInfo.channelsCountTitle=_this.declOfNum(tariffInfo.channelsCount,["телеканала","телеканалов","телеканалов"])}tariffInfo.tag=app.wi.cart.tag_id;var opt=_this.choicePlan.tariffs[0].services.shpd.options;tariffInfo.isWiFi=false;for(var o in opt){if(opt[o].altName=="wi_fi_router"){tariffInfo.isWiFi=true}}if(mrf.isSibir(adrMgr.selectedRegion.klRegion)){tariffInfo.isSibir=true}if(app.wi.cart.tag_id==312){var tripleTpl=new TemplateClass("/tpls/tariff_info_triple.hbs");tripleTpl.load();tariffInfo.title="Оптимальный";if(app.wi.cart.tariff.title.toLowerCase().indexOf("максимальный")>=0){tariffInfo.title="Максимальный"}$(".p-section-header .c-wrap").append(tripleTpl.render(tariffInfo))}else{if(app.wi.cart.tariff.inPkg){var tripleTpl=new TemplateClass("/tpls/tariff_info_double.hbs");tripleTpl.load();tariffInfo.title=app.wi.cart.getTariffTitle(app.wi.cart.tariff);$(".p-section-header .c-wrap").append(tripleTpl.render(tariffInfo))}else{if(typeof _this.isCorrectPrice!=="undefined"&&_this.isCorrectPrice){var correctPriceTpl=new TemplateClass("/tpls/tariff_info_correct.hbs");correctPriceTpl.load();tariffInfo.title=app.wi.cart.getTariffTitle(app.wi.cart.tariff);if(adrMgr.selectedRegion.klRegion=="14"){tariffInfo.speed=(_this.choicePlan.tariffs[0].services.shpd.speed/1024);tariffInfo.speedRange="mb"}$(".p-section-header .c-wrap").append(correctPriceTpl.render(tariffInfo))}else{if(tariffInfo.technology.indexOf(1)>-1&&tariffInfo.technology.length>1){tariffInfo.isTwoTypesTech=true}else{tariffInfo.isTwoTypesTech=false}$(".p-section-header .c-wrap").append(app.wi.cart.tp_info.render(tariffInfo))}}}_this.orderApi=new OrderAPI(app.wi.cart.tag_id)}}$("#tariffLoader").hide();_this.renderCart();_this.floatCartFix();TariffOrderState.bindFastOrderRelation(ConnectTimeBlock.onDateChange,ConnectTimeBlock.showWithDate)})}})}}}).fail(function(){if(!app.unloading){$("#tariffLoader").hide();utils.Notice("Произошла ошибка при загрузке информации о тарифных планах","Ошибка")}})}};this.floatCartFix=function(){app.opts=$("#user-opts");app.basket=$("#basket");if(app.opts.length==0){app.opts=$(".init-module .p-section").eq(0)}$(window).on("scroll",function(){var elem=app.basket;var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();var cartIsVisible=(elemTop<=docViewBottom);var optIsTop=(docViewTop>=0);if(cartIsVisible){$("#float-cart").delMod("visible")}else{if(optIsTop){$("#float-cart").setMod("visible")}else{$("#float-cart").delMod("visible")}}});$("#float-cart").setMod("visible")};this.render=function(){var _this=this};this.renderCart=function(){var _this=this;if($("#basket").length==0){if(typeof AddressInfo!=="undefined"){app.addr=new AddressInfo()}_this.el.append(app.wi.cart.tp_cart.render());$("#float-basket-btn-link").click(function(){stat.basketClick()});_this.wc.el=$(".basket__data");_this.wc.el.on("change_blocks",function(){construct.resetHeight()});if(app.addr){app.addr.connect_form(this.selectedCity,ConnectTimeBlock.showWithDate);var cityName=this.selectedCity.name;$("#cart_city").val(cityName).attr("disabled","disabled");app.addr.bindAddressHint({mode:"callback"})}$(".p-section-basket").show();$(".js-mfp-close,.modal-form-close").on("click",function(){$.magnificPopup.close()});$("#cart-phone,#cart-email").bind("input",function(){var _this=$(this);var mass_check=["#cart-phone_state","#cart-email_state"];for(var el in mass_check){if(mass_check[el].indexOf(_this.attr("id"))>-1){if(_this.val().length>0){$(mass_check[el]).removeClass("callback-form__label-inline_disabled-true");$(mass_check[el]+" input").removeAttr("disabled")}else{$(mass_check[el]).addClass("callback-form__label-inline_disabled-true");$(mass_check[el]+" input").attr("disabled","disabled")}}}});$("#send_basket_data").click(function(){if(!utils.buttonLoader("send_basket_data")){return false}var order=app.wi.cart.getOrder();var frm=$("#basket .order-now");var orderApi=_this.orderApi;orderApi.clear();orderApi.orderData.cellPhone=frm.find('input[name="phone"]').val();orderApi.orderData.email=frm.find('input[name="email"]').val();orderApi.orderData.firstName=$.trim(frm.find('[name="first-name"]').val());orderApi.orderData.middleName="";orderApi.orderData.lastName=$.trim(frm.find('[name="last-name"]').val());if($("#phoneSelect").length){orderApi.orderData.dopInfo+=$("#phoneSelect option[value="+$("#phoneSelect").val()+"]").text()}orderApi.orderData.notifyBySMS=($("#cart-phone_state input").is(":checked"))?1:0;orderApi.orderData.notifyByEmail=($("#cart-email_state input").is(":checked"))?1:0;orderApi.tabs=order.tabs;orderApi.orderData.tabCount=order.tabs.length;orderApi.orderData.region=order.order.region;var $callTime=$("#cart-tiletime :selected");var hf=$callTime.val();var ht=$callTime.data("hour-max");if(hf==-1){var hour=utils.getNowHour();if(hour<9||hour>=19){orderApi.orderData.callTimeFrom=9;orderApi.orderData.callTimeTill=10}else{orderApi.orderData.callTimeFrom=hour+1;orderApi.orderData.callTimeTill=hour+2}}else{orderApi.orderData.callTimeFrom=hf;orderApi.orderData.callTimeTill=ht}_.each(orderApi.tabs,function(tab){if(typeof app.addr!=="undefined"){tab=app.addr.address_process(tab);if($("#cart-connect:visible").size()>0){tab.wishTime=$("#cart-time_connect :selected").data("hour-min");if($("#cart-date_connect").val()!==""){var mass_date=$("#cart-date_connect").val().split(" ");var month={"01":"Января","02":"Февраля","03":"Марта","04":"Апреля","05":"Мая","06":"Июня","07":"Июля","08":"Августа","09":"Сентября","10":"Октября","11":"Ноября","12":"Декабря"};tab.wishDate=mass_date[0]+".";for(var mm in month){if(mass_date[1]==month[mm]){tab.wishDate+=mm+"."}}tab.wishDate+=mass_date[2]}else{tab.wishDate=""}}else{tab.wishTime="";tab.wishDate=""}construct.utm_tag(tab)}});orderApi.sendStatUniversal("_click");if(typeof AddressInfo!=="undefined"){orderApi.techCapIds=app.addr.getTechCapIds()}orderApi.send(function(data){if(data.isError!==undefined&&data.isError===0){try{$.getScript(("https:"==document.location.protocol?"https://":"http://")+"config1.veinteractive.com/tags/76CE1CFF/B359/4669/BFCB/3D3B651B9A02/tag.js");$("#request-accepted").prepend('<img src="//drs2.veinteractive.com/DataReceiverService.asmx/Pixel?journeycode=76CE1CFF-B359-4669-BFCB-3D3B651B9A02" width="1" height="1"/>')}catch(error){}var result=data.result;var packetId=result.packetId;var servicesTitle="";var servicesNames=[];if(_this.choicePlan.hasShpd){servicesNames.push("Домашний Интернет")}if(_this.choicePlan.hasIptv){servicesNames.push("Интерактивное ТВ")}if(_this.choicePlan.hasPhone){servicesNames.push("Домашний телефон")}if(servicesNames.length==1){servicesTitle="услуги "+servicesNames[0]}if(servicesNames.length==2){servicesTitle="услуг "+servicesNames.join(" и ")}if(servicesNames.length==3){servicesTitle="услуг "+servicesNames[0]+", "+servicesNames[1]+" и "+servicesNames[2]}var name=$.trim(frm.find('[name="last-name"]').val())+" "+$.trim(frm.find('[name="first-name"]').val());$(".request-accepted__txt .request-accepted__fio").html(name);$(".request-accepted__txt .request-accepted__no").html(packetId);$(".request-accepted__txt .request-accepted__service").html(servicesTitle);$.magnificPopup.open({items:{src:"#request-accepted"},preloader:true,type:"inline",closeBtnInside:false,showCloseBtn:false,fixedContentPos:false},0);orderApi.sendStatUniversal("_done");if(ie_ver()){frm.find(".form-name-inp").val("").trigger("change");frm.find(".form-email-inp").val("").trigger("change");frm.find(".form-phone-inp").val("").trigger("change");frm.find(".form-street-inp").val("").trigger("change");frm.find(".form-build-inp").val("").trigger("change");frm.find(".form-flat-inp").val("").trigger("change")}clearForm()}else{if(!app.unloading){var msg=(data.errorMsg||data.message)+"<br>Справки по телефону 8 800 100 0 800";utils.Notice(msg,"Извините, Ваш заказ не может быть принят.")}}utils.buttonUnLoader("send_basket_data","Заказать")},{},true)});var $callTime=$("#cart-tiletime");if($callTime){var hour=(new Date()).getHours();$callTime.find("option").each(function(){$(this).removeAttr("selected");if($(this).data("hour-max")<=hour){$(this).text("завтра "+$(this).text());$(this).appendTo($callTime)}});$callTime.find("option:first").attr("selected","selected")}$(window).trigger("affect-filters")}};var clearForm=function(){$(".order-now input").filter('[type="text"], [type="tel"]').not(".selectric2-wrapper").not("#cart_city").each(function(){$(this).val("").trigger("change.placeholder")});$("#cart-phone_state,#cart-email_state").addClass("callback-form__label-inline_disabled-true");$("#cart-phone_state input,#cart-email_state input").prop("checked",true);$("#cart-phone_state input,#cart-email_state input").prop("disabled","disabled");$("#cart-time_call option:first").prop("selected","selected");$("selectric2-wrapper").selectric("refresh");$("#cart-connect").hide();$("#cart-message_process").hide();$(window).trigger("affect-filters")};this.renderNotFoundMessage=function(){var $loader=$("#tariffLoader");$loader.hide();var $p=$("<p />").prop("class","content-p-0 content-txt-14");$p.append("В данный момент для вашего региона недоступна информация по тарифным планам. Пожалуйста, попробуйте зайти на сайт позже или обратитесь за информацией по телефону 8-800-1000-800");$loader.parent().after($p);$(".p-section.p-section_bg-lightgray.p-section_bg-fadewhite").hide();$(".more-link.more-link_right-head.more-link_head-45").hide()}}})();