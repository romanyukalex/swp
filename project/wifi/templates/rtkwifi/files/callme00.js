(function(){var callme={};callme.elements={};callme.elements.formId="form_callme";callme.elements.captchaId="captcha_callme";callme.elements.themeListId="p-feedback__select-theme";callme.elements.serviceListId="p-feedback__select-serv";callme.elements.clientTypeListId="p-feedback__select-cat";callme.elements.startLinkId="feedback-link";callme.elements.sendBtnId="feedback-submit";callme.elements.fileLoadDivId="file-loader-div";callme.elements.fileLoadId="p-feedback__filepath";callme.elements.messageId="message";callme.elements.orderId="order_id";callme.elements.cityId="city";callme.text={};callme.text.success="Ваша заявка принята.</br>В ближайшее время с Вами свяжутся наши специалисты.</br>Благодарим Вас за интерес и доверие, проявленные к нашим услугам</br>С уважением, Ваш Ростелеком.";callme.text.fail='Уважаемые клиенты!</br> Проводится обновление сервиса приема заявок. На данный момент Вы можете подать заявку через нашу <a target="_blank" href="/service/contact_info/total_info/info_services">единую службу поддержки.</a></br> Приносим извинения за доставленные неудобства.';callme.getSaveElms=function(){if(this.saveList){return this.saveList}this.saveList=$("#"+callme.elements.formId).find(".js-save");return this.saveList};callme.loadThemes=function(){if(callme.themesLoaded){var $theme=$("#"+callme.elements.themeListId);resetSelectric($theme);return}$.ajax({url:"/pages/proxy.jsp?proxyType=mpz&urlCode=topic_claim&proxyMethod=GET",contentType:"application/json; charset=utf-8",dataType:"text json",data:{},async:true,cache:false,success:function(data){var res=data||{};if(!res.isError||res.isError===0){var topics20="";var otherTopic="";for(var i=0;i<res.result.length;i++){if(res.result[i].topicId==20){if(mrf.regionsMap.CENTER.indexOf(adrMgr.selectedRegion.klRegion)==-1){topics20+='<option value="'+res.result[i].topicId+'">'+res.result[i].topicName+"</option>"}}else{otherTopic+='<option value="'+res.result[i].topicId+'">'+res.result[i].topicName+"</option>"}}var $theme=$("#"+callme.elements.themeListId);$theme.html($theme.find("option").first());$theme.find("option").after(otherTopic+topics20);callme.themesLoaded=true;resetSelectric($theme)}}})};function _resetSelectric($select){$select.selectric("refresh");$select.val(-1);$select.selectric("refresh")}function resetSelectric($select){_resetSelectric($select);$select.validatorFilter("reinit");$select.selectric("destroy");_resetSelectric($select)}callme.compileService=function(){var $sevList=$("#"+callme.elements.serviceListId);try{if(docContext.isAuth&&!!docContext.userEKL){$("#p-feedback__input-name").val(docContext.userEKL.fio||"");if(docContext.userEKL.phone.length==11){$("#p-feedback__input-number").val(docContext.userEKL.phone.slice(1)||"")}$("#p-feedback__input-number2").val(docContext.userEKL.email||"");if(!utils.isEmpty(docContext.userEKL.city)){$("#city").val(docContext.userEKL.city)}$("#addr2").val(docContext.userEKL.street||"");$("#addr3").val(docContext.userEKL.house||"");$("#addr4").val(docContext.userEKL.flat||"")}}catch(error){}if(this.serviceCompiled){resetSelectric($sevList);var $form=$("#form_callme");var elems=[];if(docContext.isAuth){elems=$form.find('input[type="text"], input[type="tel"], textarea').not(".isAuth_not_clear")}else{elems=$form.find('input[type="text"], input[type="tel"], textarea')}elems.val("").trigger("change.placeholder").filter(".validator-filtered").validatorFilter("reinit");$form.find("select.validator-filtered").each(function(){resetSelectric($(this))});return}var html="";var servList=window.selected_services;var servData={isTv:{title:"Телевидение",id:"3"},isInet:{title:"Интернет",id:"2"},isMob:{title:"Мобильная связь",id:"4"},isPhone:{title:"Телефон",id:"1"},other:{title:"Прочие услуги",id:"12"}};if(servList){var defaultValue=null;for(var i=0;i<servList.length;i++){var srv=servData[servList[i]];if(srv){html+='<option value="'+srv.id+'">'+srv.title+"</option>";if(servList[i]==window.default_selected_service){defaultValue=srv.id}}}html+='<option value="12">Прочие услуги</option>';$sevList.find("option").after(html);resetSelectric($sevList);if(defaultValue){$sevList.val(defaultValue);$sevList.selectric("refresh")}}$("#"+callme.elements.captchaId).prop("src","//www."+docContext.properties.shortUrl+"/captcha.png?rnd"+Math.random());this.serviceCompiled=true};callme.sendOrder=function(){$("#"+callme.elements.messageId).hide();if(!utils.buttonLoader($("#"+callme.elements.sendBtnId)[0].id)){return false}var params={};var $fields=this.getSaveElms();for(var idx=0;idx<$fields.length;idx++){var field=$($fields[idx]);if(field.data("fieldname")){params[field.data("fieldname")]=field.val()}}params.serviceId=$("#"+callme.elements.serviceListId).val();params.clientType=$("#"+callme.elements.clientTypeListId).val();params.topicId=$("#"+callme.elements.themeListId).val();params.channelId=31;params.systemId=16;params.region=adrMgr.selectedRegion.klRegion;params.captcha=$("#callme__input-captcha").val();if(docContext.isAuth&&!!docContext.userEKL){params.loginELK=docContext.userEKL.login}utils.log(params);$.ajax({url:"/pages/proxy.jsp?proxyType=mpz&urlCode=sendmail&proxyMethod=POST",type:"POST",dataType:"json",async:true,cache:false,data:params,error:function(){utils.Notice("Сервис временно недоступен","Ошибка");utils.buttonUnLoader($("#"+callme.elements.sendBtnId)[0].id)},success:function(data){data=data||{};if(data.isError||!data.orderId){if(data.message){utils.Notice(data.message,"Обратная связь")}else{utils.Notice(callme.text.fail,"Обратная связь")}utils.buttonUnLoader($("#"+callme.elements.sendBtnId)[0].id);$("#"+callme.elements.captchaId).prop("src","//www."+docContext.properties.shortUrl+"/captcha.png?rnd"+Math.random())}else{stat.fixStat("feedback","done");if(window.docContext.callback_files){$("#"+callme.elements.orderId).val(data.orderId);var size=window.docContext.callback_files.length-1;$.each(window.docContext.callback_files,function(idx,val){$.ajax({url:"/pages/proxy.jsp?proxyType=mpz&urlCode=attach_file&proxyMethod=Other",type:"post",dataType:"json",async:true,cache:false,data:{filepath:val,upload:1,orderId:data.orderId},complete:function(){if(idx==size){utils.buttonUnLoader($("#"+callme.elements.sendBtnId)[0].id);callme.clear();utils.Notice(callme.text.success,"Обратная связь");window.docContext.callback_files=[]}}})})}else{utils.Notice(callme.text.success,"Обратная связь");utils.buttonUnLoader($("#"+callme.elements.sendBtnId)[0].id);callme.clear()}}}})};callme.clear=function(){$("#"+callme.elements.captchaId).prop("src","//www."+docContext.properties.shortUrl+"/captcha.png?rnd"+Math.random());var $fields=this.getSaveElms();for(var idx=0;idx<$fields.length;idx++){var field=$($fields[idx]);field.val("").trigger("change.placeholder").validatorFilter("reinit")}var $servType=$("#"+callme.elements.serviceListId);resetSelectric($servType);var $clientType=$("#"+callme.elements.clientTypeListId);$clientType.val(window.docContext.isB2B?2:1);$clientType.selectric("refresh");$clientType.validatorFilter("reinit");$clientType.trigger("change");var $themeType=$("#"+callme.elements.themeListId);resetSelectric($themeType);$(".file-upload_complete").find(".file-upload__stop").trigger("click");$(".file-upload__stop").parent().not(".permanent").remove();window.fileCnt=0;window.fileSize=0;$("#callme__input-captcha").val("");$(".p-feedback__close").trigger("click");$(".file-upload__info-in").trigger("click");$("#"+callme.elements.fileLoadId).removeData("finame")};callme.bind=function(){$("#feedback-link").click(function(){stat.fixStat("feedback","open");callme.compileService();callme.loadThemes();var $clientType=$("#"+callme.elements.clientTypeListId);$clientType.selectric("refresh");$("#"+callme.elements.captchaId).prop("src","//www."+docContext.properties.shortUrl+"/captcha.png?rnd"+Math.random());if(!!docContext.userEKL){}try{var city="";if(docContext.userEKL&&!utils.isEmpty(docContext.userEKL.city)){city=docContext.userEKL.city}else{if(adrMgr.other){$("#"+callme.elements.cityId).val(adrMgr.other.name)}else{$("#"+callme.elements.cityId).val(adrMgr.selectedCity.name)}}$("#"+callme.elements.cityId).val(city)}catch(error){}$("#p-feedback__select-cat").off("change").on("change",function(){if($(this).val()=="1"){$("#p-feedback__org-name").validatorFilter("off").prop("disabled",true).parent().hide().val("")}else{$("#p-feedback__org-name").validatorFilter("on").prop("disabled",false).parent().show().val("")}});if(window.docContext.isB2B){$("#p-feedback__select-cat").val("2").trigger("change").selectric("refresh")}else{$("#p-feedback__select-cat").val("1").trigger("change").selectric("refresh")}try{(function(n){var l=window.location,a=l.hostname.split(".");a.splice(a.length-2,2);window[n]=(a.length?"/"+a.join("/"):"")+l.pathname+escape(l.search)})("sz");var RndNum4NoCash=Math.round(Math.random()*1000000000);var ar_Tail="unknown";if(document.referrer){ar_Tail=escape(document.referrer)}$("#feedback").append('<img src="'+("https:"==document.location.protocol?"https:":"http:")+"//ad.adriver.ru/cgi-bin/rle.cgi?sid=201976&bt=55&pz=0&sz="+sz+"&rnd="+RndNum4NoCash+"&tail256="+ar_Tail+'" border=0 width=1 height=1>')}catch(error){}});$("#"+callme.elements.sendBtnId).off("click").on("click",function(){return callme.clickSendBtn()})};callme.clickSendBtn=function(){stat.fixStat("feedback","send");callme.sendOrder();return false};var isFastOpen=false;$("#feedback-link").one("click",function(){isFastOpen=true});$(window).one("filters-is-affected",function(){callme.bind();if(isFastOpen){$("#feedback-link").trigger("click")}isFastOpen=false});$("#captcha_reload_callme").on("click",function(){$("#"+callme.elements.captchaId).prop("src","//www."+docContext.properties.shortUrl+"/captcha.png?rnd"+Math.random())});$(function(){var formTele2={};departureAddress=["","/mobile","/b2b/mobile","/b2bcorp/mobile"];formTele2.garbage_class="js-mail-order-field";formTele2.tele2_garbage_simple_id=["p-feedback__input-name","p-feedback__input-number","callme__input-captcha","p-feedback__textarea-message","callme__input-captcha","user_email"];formTele2.replaice_id=[["p-feedback__input-number2","user_email"],["form_callme","mailOrderForm_fb"],["feedback-submit","mailOrderFormSend_fb"]];formTele2.save_js_delete_te2_form=$(".js_delete_tele2_form").html();var $options_select_serv=$("#p-feedback__select-serv").html();var $options_select_theme=$("#p-feedback__select-theme").html();function InitSelectFeedbackForm(){$options_select_serv=$("#p-feedback__select-serv").html();$options_select_theme=$("#p-feedback__select-theme").html()}$("select#p-feedback__select-serv").on("change",function(){if($("#p-feedback__select-serv").val()=="4"&&mrf.isUral(adrMgr.selectedCity.klRegion)){InitSelectFeedbackForm();changeForm();$(".p-feedback__close").on("click",function(){var $feed_back=$("#feedback");$feed_back.find("div.js-replace_feedback1").html("");$feed_back.find(".js-replace_feedback2").html("");change_id(1);$feed_back.find("."+formTele2.garbage_class).removeClass(formTele2.garbage_class);$(".js_delete_tele2_form").html(formTele2.save_js_delete_te2_form);$("#p-feedback__select-serv").html($options_select_serv);$("#p-feedback__select-theme").html($options_select_theme);$("select#p-feedback__select-serv").on("change",function(){if($("#p-feedback__select-serv").val()=="4"&&mrf.isUral(adrMgr.selectedCity.klRegion)){InitSelectFeedbackForm();changeForm()}});$("#"+callme.elements.sendBtnId).off("click").on("click",function(){return callme.clickSendBtn()})})}});function changeForm(){addFormTele2Html();$(".js_delete_tele2_form").html("");change_id(0);addClassMailTo();new orderMail("#mailOrderForm_fb","#mailOrderFormSend_fb","#feedBackType")}function addFormTele2Html(){var mail_garbage_class="js-mail-order-field";var js_replace='<input type="hidden" id="feedBackType" name="mailOrderType" value="feedback" /><input type="hidden" id="fileName" name="fileName" class="fileName '+mail_garbage_class+'" /><input type="hidden" id="client_type_tele2" name="client_type_tele2" class="redisKey '+mail_garbage_class+'" />';$("#feedback").find("div.js-replace_feedback1").html(js_replace);var client_type_val_select=$("#p-feedback__select-cat").val();$("#client_type_tele2").val(encodeClientType(client_type_val_select));var messageTele2='Вы можете оставить сообщение на&nbsp;сайте <a href=" http://tele2.ru" target="_blank">Tele2</a>, на&nbsp;форме обратной связи или позвонив по&nbsp;телефону на&nbsp;короткий номер ';var tele2NumberPhone=["611","636"];messageTele2=messageTele2+tele2NumberPhone[+client_type_val_select-1];var index_adress=0;for(var i=0;i<departureAddress.length;i++){if(window.location.pathname.indexOf(departureAddress[i],0)>=0){index_adress=i}}js_replace=' <input type="hidden" type="text" id="departure_address" name="departure_address" class="departure_address js-mail-order-field" value='+departureAddress[index_adress]+' /><div class="p-feedback__row"><p class="content-p-0 content-txt-14">'+messageTele2+'</p><!--<p id="message" class="callback-form__addr-available" style="display:none;margin:15px 0px;">Сервис временно недоступен</p>--></div>';$("#feedback").find(".js-replace_feedback2").html(js_replace)}function encodeClientType(select_val){var arr_value_client_type=["","Частный клиент","Юридическое лицо"];return arr_value_client_type[+select_val]}function addClassMailTo(){var garbage_class="js-mail-order-field";var tele2_garbage_simple_id=formTele2.tele2_garbage_simple_id;for(var i=0;i<tele2_garbage_simple_id.length;i++){$("#"+tele2_garbage_simple_id[i]).addClass(garbage_class)}}function change_id(index_change){$("#feedback-submit").off("click");var replaice_id=formTele2.replaice_id;var index_switch=index_change=="0"?1:0;for(var i=0;i<replaice_id.length;i++){$("#"+replaice_id[i][index_change]).attr("id",replaice_id[i][index_switch])}var name=["p-feedback__input-number","user_email"];$("#"+replaice_id[0][index_switch]).attr("name",name[index_switch])}})})();